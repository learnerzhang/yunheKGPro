var g=(C,b,u)=>new Promise((v,w)=>{var p=o=>{try{f(u.next(o))}catch(l){w(l)}},i=o=>{try{f(u.throw(o))}catch(l){w(l)}},f=o=>o.done?v(o.value):Promise.resolve(o.value).then(p,i);f((u=u.apply(C,b)).next())});import{u as O,_ as W}from"./useForm-Hn6EoxrV.js";import"./BasicForm.vue_vue_type_style_index_0_lang-qpF-DMKT.js";import{_ as Z}from"./index-CPBX9QO_.js";import{f as q}from"./fulltext.data-DFqo9yUk.js";import{a as H,B as J}from"./index-dXxTZxnK.js";import{u as Q,c as X}from"./task-BVRZM_E3.js";import{g as Y,a as ee}from"./file-CcanAzse.js";import{ah as te}from"./entry/index-B-McypeI-1739345778478.js";import{ac as _,av as D,j as ae}from"./antd-DuSlDOy9.js";import{d as se,f as c,c as oe,u as s,Z as d,a4 as M,a5 as k,k as m,$ as n,a8 as y,_ as h,G as le,F as re,a7 as ne,a3 as P,a9 as ie}from"./vue-7EN2lk9e.js";const ce={class:"flex"},de={class:"w-1/3"},ue={class:"p-2 border-1 border-gray-200 border-t-0 h-80 overflow-y-auto"},ve={key:1},fe={class:"flex-1"},ge={class:"text-center p-2 bg-gray-100 border-1 border-l-0 border-gray-200 relative"},me={class:"p-2 px-6 border-1 border-gray-200 border-l-0 border-t-0 h-80 overflow-y-auto"},he={key:0,class:"w-full"},pe=["title"],_e={class:"text-gray-400 !text-sm h-8 leading-8 pt-1.5"},ke={key:1},Pe=se({__name:"CreateUpdateModal",emits:["success","register"],setup(C,{emit:b}){const u=b,v=c(!0),p=te().getUserInfo;let i=null;const f=c(null),o=c([]),l=c([]),x=c(["0"]),a=c([]),I=c(!1),E=c(!1),F=e=>{e.target.checked?a.value=l.value.map(r=>r.id):a.value=[],E.value=!1},L=e=>{const{value:t}=e.target;e.target.checked?a.value.push(t):a.value=a.value.filter(r=>r!==t),E.value=a.value.length>0&&a.value.length<l.value.length,I.value=a.value.length===l.value.length},R=oe(()=>s(v)?"编辑任务":"新增任务"),[T,{resetFields:N,setFieldsValue:U,validate:A}]=O({labelWidth:120,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:q,showActionButtonGroup:!1}),[V,{setModalProps:S,closeModal:G}]=H(e=>g(this,null,function*(){N(),o.value=[],l.value=[],a.value=[],x.value=["0"],S({confirmLoading:!1}),v.value=!!(e!=null&&e.isUpdate),s(v)&&(i=e.record,U({name:i.name,desc:i.desc}),a.value=i.kg_doc||[]),$(),B()})),B=e=>g(this,null,function*(){const{data:t=[]}=(yield Y({cid:e,page:1,pageSize:99999}))||{};l.value=t||[]}),$=()=>g(this,null,function*(){const e=(yield ee())||{},t=[{id:"0",name:"文档目录",children:(e==null?void 0:e.tabctt)||[]}];o.value=t}),j=e=>{x.value=e;const t=e[0]==0?void 0:e[0];B(t)};function K(){return g(this,null,function*(){try{let e=yield A();if(!a.value.length){ae.error("请选择任务数据来源");return}S({confirmLoading:!0}),s(v)?(e.user_id=p.userId,e.doc_ids=a.value.join(","),e.task_id=i.id,yield Q(e)):(e.user_id=p.userId,e.taskType=2,e.doc_ids=a.value.join(","),i=yield X(e)),G(),u("success")}finally{S({confirmLoading:!1})}})}return(e,t)=>(d(),M(s(J),ie(e.$attrs,{onRegister:s(V),showFooter:"",title:R.value,width:"1000px",onOk:K}),{default:k(()=>[m(s(W),{onRegister:s(T)},{doc_ids:k(()=>[n("div",ce,[n("div",de,[t[1]||(t[1]=n("div",{class:"text-center p-2 bg-gray-100 border-1 border-gray-200"},"文档列表",-1)),n("div",ue,[o.value.length>0?(d(),M(s(Z),{key:0,ref_key:"treeRef",ref:f,selectedKeys:x.value,defaultExpandLevel:2,clickRowToExpand:!1,treeData:o.value,fieldNames:{key:"id",title:"name"},onSelect:j,renderIcon:e.createIcon},null,8,["selectedKeys","treeData","renderIcon"])):y("",!0),o.value.length===0?(d(),h("div",ve,[m(s(_),{class:"mt-30",image:s(_).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):y("",!0)])]),n("div",fe,[n("div",ge,[m(s(D),{checked:I.value,"onUpdate:checked":t[0]||(t[0]=r=>I.value=r),indeterminate:E.value,onChange:F,class:"absolute top-2 left-6"},{default:k(()=>t[2]||(t[2]=[n("span",null,"全选",-1)])),_:1},8,["checked","indeterminate"]),t[3]||(t[3]=le(" 文档名称 "))]),n("div",me,[l.value.length>0?(d(),h("div",he,[(d(!0),h(re,null,ne(l.value,(r,z)=>(d(),h("div",{class:"w-full flex",key:z},[m(s(D),{class:"h-8 leading-8 flex-1 overflow-hidden",value:r.id,checked:a.value.includes(r.id),onChange:L},{default:k(()=>[n("span",{title:r.title},P(r.title),9,pe)]),_:2},1032,["value","checked"]),n("div",_e,P(r.kg_ctt),1)]))),128))])):y("",!0),l.value.length===0?(d(),h("div",ke,[m(s(_),{class:"mt-30",image:s(_).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):y("",!0)])])])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Pe as _};
