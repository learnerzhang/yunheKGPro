var v=(R,k,u)=>new Promise((d,w)=>{var g=s=>{try{m(u.next(s))}catch(r){w(r)}},o=s=>{try{m(u.throw(s))}catch(r){w(r)}},m=s=>s.done?d(s.value):Promise.resolve(s.value).then(g,o);m((u=u.apply(R,k)).next())});import{u as $,_ as A}from"./useForm-DGjywljk.js";import"./BasicForm.vue_vue_type_style_index_0_lang-DeNCmJ5N.js";import{_ as K}from"./index-CAJtQUpX.js";import{f as j}from"./import.data-DhkZBgAz.js";import{a as z,B as O}from"./index-cSGZvoEm.js";import{u as W,c as Z,l as q}from"./task-DgLXztvm.js";import{g as H,a as J}from"./file-CwdbWB1Z.js";import{ah as Q}from"./entry/index-CMbP4qrD-1735889696146.js";import{ac as p,ap as X,aL as Y,j as ee}from"./antd-DuSlDOy9.js";import{d as te,f,c as ae,u as a,Z as c,a4 as E,a5 as _,k as y,$ as i,a8 as h,_ as b,F as se,a7 as oe,a3 as D,a9 as re}from"./vue-7EN2lk9e.js";const le={class:"flex"},ie={class:"w-1/3"},de={class:"p-2 border-1 border-gray-200 border-t-0 h-80 overflow-y-auto"},ne={key:1},ce={class:"flex-1"},ue={class:"p-2 px-6 border-1 border-gray-200 border-l-0 border-t-0 h-80 overflow-y-auto"},fe=["title"],me={class:"text-gray-400 !text-sm h-8 leading-8 pt-1.5"},ve={key:1},Ee=te({__name:"CreateUpdateModal",emits:["success","register"],setup(R,{emit:k}){const u=k,d=f(!0),g=Q().getUserInfo;let o=null;const m=f(null),s=f([]),r=f([]),n=f(""),S=f(["0"]),L=ae(()=>a(d)?"编辑任务":"新增任务"),[M,{resetFields:P,setFieldsValue:F,validate:T}]=$({labelWidth:120,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:j,showActionButtonGroup:!1}),[C,{setModalProps:x,closeModal:N}]=z(e=>v(this,null,function*(){var t;P(),s.value=[],r.value=[],n.value="",S.value=["0"],x({confirmLoading:!1}),d.value=!!(e!=null&&e.isUpdate),a(d)&&(o=e.record,F({name:o.name,desc:o.desc}),n.value=((t=o.kg_doc)==null?void 0:t[0])||""),U(),B()})),B=e=>v(this,null,function*(){const{data:t=[]}=(yield H({cid:e,page:1,pageSize:99999}))||{},l=t.findIndex(I=>I.id==n.value);l>-1&&t.unshift(t.splice(l,1)[0]),r.value=t||[]}),U=()=>v(this,null,function*(){const e=(yield J())||{},t=[{id:"0",name:"文档目录",children:(e==null?void 0:e.tabctt)||[]}];s.value=t}),G=e=>{S.value=e;const t=e[0]==0?void 0:e[0];B(t)};function V(){return v(this,null,function*(){try{let e=yield T();if(!n.value){ee.error("请选择任务数据来源");return}x({confirmLoading:!0}),a(d)?(e.user_id=g.userId,e.doc_ids=String(n.value),e.task_id=o.id,yield W(e)):(e.user_id=g.userId,e.taskType=0,e.doc_ids=String(n.value),o=yield Z(e),o&&(yield q({task_id:o.id,force:0}))),N(),u("success")}finally{x({confirmLoading:!1})}})}return(e,t)=>(c(),E(a(O),re(e.$attrs,{onRegister:a(C),showFooter:"",title:L.value,width:"1000px",onOk:V}),{default:_(()=>[y(a(A),{onRegister:a(M)},{doc_ids:_(()=>[i("div",le,[i("div",ie,[t[1]||(t[1]=i("div",{class:"text-center p-2 bg-gray-100 border-1 border-gray-200"},"文档列表",-1)),i("div",de,[s.value.length>0?(c(),E(a(K),{key:0,ref_key:"treeRef",ref:m,selectedKeys:S.value,defaultExpandLevel:2,clickRowToExpand:!1,treeData:s.value,fieldNames:{key:"id",title:"name"},onSelect:G,renderIcon:e.createIcon,disabled:d.value},null,8,["selectedKeys","treeData","renderIcon","disabled"])):h("",!0),s.value.length===0?(c(),b("div",ne,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])]),i("div",ce,[t[2]||(t[2]=i("div",{class:"text-center p-2 bg-gray-100 border-1 border-l-0 border-gray-200"},"文档名称",-1)),i("div",ue,[r.value.length>0?(c(),E(a(X),{key:0,disabled:d.value,value:n.value,"onUpdate:value":t[0]||(t[0]=l=>n.value=l),class:"w-full"},{default:_(()=>[(c(!0),b(se,null,oe(r.value,(l,I)=>(c(),b("div",{class:"flex-1 flex",key:I},[y(a(Y),{class:"h-8 leading-8 flex-1 overflow-hidden",value:l.id},{default:_(()=>[i("span",{title:l.title},D(l.title),9,fe)]),_:2},1032,["value"]),i("div",me,D(l.kg_ctt),1)]))),128))]),_:1},8,["disabled","value"])):h("",!0),r.value.length===0?(c(),b("div",ve,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])])])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Ee as _};
