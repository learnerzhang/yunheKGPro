var E=Object.defineProperty;var C=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var M=(t,n,a)=>n in t?E(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,I=(t,n)=>{for(var a in n||(n={}))Z.call(n,a)&&M(t,a,n[a]);if(C)for(var a of C(n))K.call(n,a)&&M(t,a,n[a]);return t};var g=(t,n,a)=>new Promise((c,u)=>{var x=p=>{try{d(a.next(p))}catch(f){u(f)}},m=p=>{try{d(a.throw(p))}catch(f){u(f)}},d=p=>p.done?c(p.value):Promise.resolve(p.value).then(x,m);d((a=a.apply(t,n)).next())});import{u as R,_ as k}from"./useForm-aNhbSFae.js";import{_ as Q}from"./BasicForm.vue_vue_type_style_index_0_lang-BdxNsio9.js";import{ah as X,an as ee}from"./entry/index-gwXb_KLU-1735894345864.js";import{n as te,ah as ae,a9 as se}from"./antd-DuSlDOy9.js";import{u as B,a as ne,d as oe,b as le,c as ie,e as re}from"./model-Ceew6pBK.js";import{l as de,d as ue,f as F,c as pe,u as o,Z as P,a4 as q,a5 as y,k as b,$ as V,a8 as D,_ as ce,a3 as me,G as fe,a9 as be}from"./vue-7EN2lk9e.js";import{a as he,B as ge}from"./index-C6GdxVlT.js";import{u as ye,_ as _e}from"./useTable-dUUy5G55.js";import"./TableImg.vue_vue_type_style_index_0_lang-B8XoVYjR.js";const ve=[{label:"string",value:"string"},{label:"integer",value:"integer"},{label:"number",value:"number"},{label:"array",value:"array"},{label:"object",value:"object"},{label:"file",value:"file"},{label:"json",value:"json"}],we=[{label:"启用中",value:1},{label:"停用中",value:0}],Te=[{title:"模型编码",dataIndex:"no",width:100},{title:"模型名称",dataIndex:"name",width:180},{title:"模型描述",dataIndex:"desc",width:300},{title:"模型能力",dataIndex:"function",width:180},{title:"版本号",dataIndex:"version",width:100},{title:"更新时间",dataIndex:"update_time",width:160,customRender:({record:t})=>te(t.update_time).format("YYYY-MM-DD HH:mm")},{title:"模型管理者",dataIndex:"user_name",width:100},{title:"是否启用",dataIndex:"activate",width:120,fixed:"right",customRender:({record:t})=>(Reflect.has(t,"pendingStatus")||(t.pendingStatus=!1),de(ae,{checked:t.activate==1,checkedChildren:"",unCheckedChildren:"",loading:t.pendingStatus,onChange(n){t.pendingStatus=!0;const a=n?"1":"0";B({mid:t.id,activate:a,user_id:t.user_id}).then(()=>{t.activate=a}).finally(()=>{t.pendingStatus=!1})}}))}],Ne=[{field:"keyword",label:"",component:"Input",componentProps:{placeholder:"关键词模糊查询"},colProps:{span:6}},{field:"function",label:"",component:"Select",componentProps:{placeholder:"按模型能力查询",options:[]},colProps:{span:4}},{field:"activate",label:"",component:"Select",componentProps:{placeholder:"按启用状态查询",options:we},colProps:{span:4}}],Ie=[{field:"name",label:"模型名称",required:!0,component:"Input",colProps:{span:12}},{field:"version",label:"版本号",required:!0,component:"Input",colProps:{span:12}},{field:"desc",label:"模型描述",required:!0,component:"InputTextArea",componentProps:{autoSize:{minRows:2}},colProps:{span:24}},{field:"user_name",label:"模型管理者",required:!0,component:"Input",componentProps:{disabled:!0},colProps:{span:12}},{field:"function",label:"模型能力",required:!0,component:"Select",colProps:{span:12},componentProps:{options:[]}}],Pe=[{field:"req_type",label:"请求方式",required:!0,component:"RadioGroup",defaultValue:1,componentProps:{options:[{label:"get",value:1},{label:"post",value:0}]},colProps:{span:12}},{field:"url",label:"接口地址",required:!0,component:"Input",colProps:{span:12}},{label:"请求参数",field:"params",required:!1,slot:"params"}],xe=[{title:"参数名称",dataIndex:"name",width:100,editable:!1,edit:!0,editRule:!0,editComponent:"Input"},{title:"参数说明",dataIndex:"desc",width:180,editable:!1,edit:!0,editRule:!1,editComponent:"Input"},{title:"数据类型",dataIndex:"type",width:150,editable:!1,edit:!0,editComponent:"Select",editRule:!0,editComponentProps:{options:ve}},{title:"默认值",dataIndex:"default",width:100,editable:!1,edit:!0,editRule:!1,editComponent:"Input"},{title:"是否必填",dataIndex:"necessary",width:80,editable:!1,edit:!0,editComponent:"Checkbox",editValueMap:t=>t?"是":"否"}],Se={key:0,class:"-mt-6 mb-4 pl-1 text-red-700 text-left"},Ce={class:"text-center -mt-3"},Oe=ue({__name:"CreateUpdateModal",emits:["success","register"],setup(t,{emit:n}){const a=n,c=F(!0),u=F(""),m=X().getUserInfo;let d=null;const p=pe(()=>o(c)?"编辑模型":"新增模型"),[f,{resetFields:$,setFieldsValue:S,validate:A,updateSchema:T}]=R({labelWidth:90,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:Ie,showActionButtonGroup:!1}),[N,{resetFields:O,setFieldsValue:j,validate:U}]=R({labelWidth:90,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:Pe,showActionButtonGroup:!1}),[G,{getDataSource:_,setTableData:h}]=ye({title:"",dataSource:[],columns:xe,useSearchForm:!1,showTableSetting:!1,bordered:!0,showIndexColumn:!0,pagination:!1,scroll:{y:1e3},actionColumn:{width:60,title:"操作",dataIndex:"action"}});function L(e,l){return g(this,null,function*(){e.id&&(yield oe({pid:e.id}));const r=_();r.splice(l,1),h(r)})}function Y(){const e=_();e.push({name:"",desc:"",type:"",default:"",necessary:!1}),h(e)}const[H,{setModalProps:v,closeModal:J}]=he(e=>g(this,null,function*(){$(),O(),h([]),v({confirmLoading:!1}),c.value=!!(e!=null&&e.isUpdate);const l=e.modelFunctionOpts||[];if(T([{field:"function",componentProps:{options:l}}]),o(c)){d=e.record;const r=yield ne({mid:d.id});h(r||[]),S(I({},e.record)),j(I({},e.record))}else S({user_name:m.realName,version:"V1.0"})}));function W(){return g(this,null,function*(){try{let e=yield A(),l=yield U();const r=_();u.value="";for(let i=0;i<r.length;i++){const s=r[i];if(!s.name){u.value=`序号为 ${i+1} 的参数项的参数名称不能为空`;return}if(!s.type){u.value=`序号为 ${i+1} 的参数项的参数类型不能为空`;return}const w=r.findIndex(z=>z.name==s.name);if(w>-1&&w!=i){u.value=`序号为 ${i+1}和 序号为 ${w+1}的参数项的参数名称重复`;return}}if(v({confirmLoading:!0}),o(c)){e.mid=d.id,e.user_id=m.userId,e.req_type=l.req_type,e.url=l.url,delete e.user_name,yield B(e);const i=r.map(s=>({mid:d.id,pid:s.id,name:s.name,desc:s.desc,type:s.type,default:s.default,necessary:s.necessary?1:0}));yield le({data:JSON.stringify({data:i})})}else{e.user_id=m.userId,e.req_type=l.req_type,e.url=l.url,delete e.user_name,d=yield ie(e);const i=r.map(s=>({mid:d.id,pid:s.id,name:s.name,desc:s.desc,type:s.type,default:s.default,necessary:s.necessary?1:0}));yield re({data:JSON.stringify({data:i})})}J(),a("success")}finally{v({confirmLoading:!1})}})}return(e,l)=>(P(),q(o(ge),be(e.$attrs,{onRegister:o(H),showFooter:"",title:p.value,width:"1000px",onOk:W}),{default:y(()=>[b(o(k),{onRegister:o(f)},null,8,["onRegister"]),b(o(se)),l[1]||(l[1]=V("div",{class:"text-gray-900 font-bold mb-4"},"模型接口",-1)),b(o(k),{onRegister:o(N)},{params:y(()=>[b(o(_e),{onRegister:o(G)},{bodyCell:y(({column:r,index:i,record:s})=>[r.key==="action"?(P(),q(o(Q),{key:0,actions:[{label:"移除",color:"error",popConfirm:{title:"是否确认移除",placement:"left",confirm:L.bind(null,s,i)}}]},null,8,["actions"])):D("",!0)]),_:1},8,["onRegister"]),u.value?(P(),ce("div",Se,me(u.value),1)):D("",!0),V("div",Ce,[b(o(ee),{type:"link",onClick:Y},{default:y(()=>l[0]||(l[0]=[fe("+ 新增一项")])),_:1})])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Oe as _,Te as c,we as m,Ne as s};
