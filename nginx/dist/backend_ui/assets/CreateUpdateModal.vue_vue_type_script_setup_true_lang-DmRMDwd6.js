var v=(R,k,u)=>new Promise((d,w)=>{var g=s=>{try{m(u.next(s))}catch(o){w(o)}},n=s=>{try{m(u.throw(s))}catch(o){w(o)}},m=s=>s.done?d(s.value):Promise.resolve(s.value).then(g,n);m((u=u.apply(R,k)).next())});import{u as A,_ as K}from"./useForm-aNhbSFae.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BdxNsio9.js";import{_ as j}from"./index-BneN3eq6.js";import{f as z}from"./auto.data-Dv4FHeTE.js";import{a as O,B as W}from"./index-C6GdxVlT.js";import{u as Z,c as q}from"./task-DJafqcAW.js";import{g as H,a as J}from"./file-ahny2sb3.js";import{ah as Q}from"./entry/index-gwXb_KLU-1735894345864.js";import{ac as p,ap as X,aL as Y,j as D}from"./antd-DuSlDOy9.js";import{d as ee,f,c as te,u as a,Z as c,a4 as E,a5 as _,k as y,$ as i,a8 as h,_ as b,F as ae,a7 as se,a3 as L,a9 as oe}from"./vue-7EN2lk9e.js";const re={class:"flex"},le={class:"w-1/3"},ie={class:"p-2 border-1 border-gray-200 border-t-0 h-80 overflow-y-auto"},de={key:1},ne={class:"flex-1"},ce={class:"p-2 px-6 border-1 border-gray-200 border-l-0 border-t-0 h-80 overflow-y-auto"},ue=["title"],fe={class:"text-gray-400 !text-sm h-8 leading-8 pt-1.5"},me={key:1},Ie=ee({__name:"CreateUpdateModal",emits:["success","register"],setup(R,{emit:k}){const u=k,d=f(!0),g=Q().getUserInfo;let n=null;const m=f(null),s=f([]),o=f([]),r=f(""),S=f(["0"]),M=te(()=>a(d)?"编辑图谱":"新增图谱"),[P,{resetFields:F,setFieldsValue:T,validate:C}]=A({labelWidth:120,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:z,showActionButtonGroup:!1}),[N,{setModalProps:x,closeModal:U}]=O(e=>v(this,null,function*(){var t;F(),s.value=[],o.value=[],r.value="",S.value=["0"],x({confirmLoading:!1}),d.value=!!(e!=null&&e.isUpdate),a(d)&&(n=e.record,T({name:n.name,desc:n.desc}),r.value=((t=n.kg_doc)==null?void 0:t[0])||""),G(),B()})),B=e=>v(this,null,function*(){const{data:t=[]}=(yield H({cid:e,page:1,pageSize:99999}))||{},l=t.findIndex(I=>I.id==r.value);l>-1&&t.unshift(t.splice(l,1)[0]),o.value=t||[]}),G=()=>v(this,null,function*(){const e=(yield J())||{},t=[{id:"0",name:"文档目录",children:(e==null?void 0:e.tabctt)||[]}];s.value=t}),V=e=>{S.value=e;const t=e[0]==0?void 0:e[0];B(t)};function $(){return v(this,null,function*(){try{let e=yield C();if(!r.value){D.error("请选择图谱数据来源");return}if(r.value){D.success("接口未提供");return}x({confirmLoading:!0}),a(d)?(e.user_id=g.userId,e.doc_ids=String(r.value),e.task_id=n.id,yield Z(e)):(e.user_id=g.userId,e.taskType=1,e.doc_ids=String(r.value),n=yield q(e)),U(),u("success")}finally{x({confirmLoading:!1})}})}return(e,t)=>(c(),E(a(W),oe(e.$attrs,{onRegister:a(N),showFooter:"",title:M.value,width:"1000px",onOk:$}),{default:_(()=>[y(a(K),{onRegister:a(P)},{doc_ids:_(()=>[i("div",re,[i("div",le,[t[1]||(t[1]=i("div",{class:"text-center p-2 bg-gray-100 border-1 border-gray-200"},"文档列表",-1)),i("div",ie,[s.value.length>0?(c(),E(a(j),{key:0,ref_key:"treeRef",ref:m,selectedKeys:S.value,defaultExpandLevel:2,clickRowToExpand:!1,treeData:s.value,fieldNames:{key:"id",title:"name"},onSelect:V,renderIcon:e.createIcon,disabled:d.value},null,8,["selectedKeys","treeData","renderIcon","disabled"])):h("",!0),s.value.length===0?(c(),b("div",de,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])]),i("div",ne,[t[2]||(t[2]=i("div",{class:"text-center p-2 bg-gray-100 border-1 border-l-0 border-gray-200"},"文档名称",-1)),i("div",ce,[o.value.length>0?(c(),E(a(X),{key:0,disabled:d.value,value:r.value,"onUpdate:value":t[0]||(t[0]=l=>r.value=l),class:"w-full"},{default:_(()=>[(c(!0),b(ae,null,se(o.value,(l,I)=>(c(),b("div",{class:"flex-1 flex",key:I},[y(a(Y),{class:"h-8 leading-8 flex-1 overflow-hidden",value:l.id},{default:_(()=>[i("span",{title:l.title},L(l.title),9,ue)]),_:2},1032,["value"]),i("div",fe,L(l.kg_ctt),1)]))),128))]),_:1},8,["disabled","value"])):h("",!0),o.value.length===0?(c(),b("div",me,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])])])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Ie as _};
