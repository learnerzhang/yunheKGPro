var v=(R,k,u)=>new Promise((i,w)=>{var g=s=>{try{m(u.next(s))}catch(o){w(o)}},d=s=>{try{m(u.throw(s))}catch(o){w(o)}},m=s=>s.done?i(s.value):Promise.resolve(s.value).then(g,d);m((u=u.apply(R,k)).next())});import{u as $,_ as A}from"./useForm-D6frmkhD.js";import"./BasicForm.vue_vue_type_style_index_0_lang-Cztz7x8L.js";import{_ as K}from"./index-BX9C0oMS.js";import{f as j}from"./auto.data-DKQ64pUM.js";import{a as z,B as O}from"./index-CfGFDaHn.js";import{u as W,c as Z}from"./task-DcEDGTPl.js";import{g as q,a as H}from"./file-GySG776O.js";import{ah as J}from"./entry/index-BcL7-Cog-1735891856356.js";import{ac as p,ap as Q,aL as X,j as Y}from"./antd-DuSlDOy9.js";import{d as ee,f,c as te,u as a,Z as c,a4 as E,a5 as _,k as y,$ as l,a8 as h,_ as b,F as ae,a7 as se,a3 as D,a9 as oe}from"./vue-7EN2lk9e.js";const re={class:"flex"},le={class:"w-1/3"},ie={class:"p-2 border-1 border-gray-200 border-t-0 h-80 overflow-y-auto"},de={key:1},ne={class:"flex-1"},ce={class:"p-2 px-6 border-1 border-gray-200 border-l-0 border-t-0 h-80 overflow-y-auto"},ue=["title"],fe={class:"text-gray-400 !text-sm h-8 leading-8 pt-1.5"},me={key:1},Ie=ee({__name:"CreateUpdateModal",emits:["success","register"],setup(R,{emit:k}){const u=k,i=f(!0),g=J().getUserInfo;let d=null;const m=f(null),s=f([]),o=f([]),n=f(""),S=f(["0"]),L=te(()=>a(i)?"编辑任务":"新增任务"),[M,{resetFields:P,setFieldsValue:F,validate:T}]=$({labelWidth:120,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:j,showActionButtonGroup:!1}),[C,{setModalProps:x,closeModal:N}]=z(e=>v(this,null,function*(){var t;P(),s.value=[],o.value=[],n.value="",S.value=["0"],x({confirmLoading:!1}),i.value=!!(e!=null&&e.isUpdate),a(i)&&(d=e.record,F({name:d.name,desc:d.desc}),n.value=((t=d.kg_doc)==null?void 0:t[0])||""),U(),B()})),B=e=>v(this,null,function*(){const{data:t=[]}=(yield q({cid:e,page:1,pageSize:99999}))||{},r=t.findIndex(I=>I.id==n.value);r>-1&&t.unshift(t.splice(r,1)[0]),o.value=t||[]}),U=()=>v(this,null,function*(){const e=(yield H())||{},t=[{id:"0",name:"文档目录",children:(e==null?void 0:e.tabctt)||[]}];s.value=t}),G=e=>{S.value=e;const t=e[0]==0?void 0:e[0];B(t)};function V(){return v(this,null,function*(){try{let e=yield T();if(!n.value){Y.error("请选择任务数据来源");return}x({confirmLoading:!0}),a(i)?(e.user_id=g.userId,e.doc_ids=String(n.value),e.task_id=d.id,yield W(e)):(e.user_id=g.userId,e.taskType=1,e.doc_ids=String(n.value),d=yield Z(e)),N(),u("success")}finally{x({confirmLoading:!1})}})}return(e,t)=>(c(),E(a(O),oe(e.$attrs,{onRegister:a(C),showFooter:"",title:L.value,width:"1000px",onOk:V}),{default:_(()=>[y(a(A),{onRegister:a(M)},{doc_ids:_(()=>[l("div",re,[l("div",le,[t[1]||(t[1]=l("div",{class:"text-center p-2 bg-gray-100 border-1 border-gray-200"},"文档列表",-1)),l("div",ie,[s.value.length>0?(c(),E(a(K),{key:0,ref_key:"treeRef",ref:m,selectedKeys:S.value,defaultExpandLevel:2,clickRowToExpand:!1,treeData:s.value,fieldNames:{key:"id",title:"name"},onSelect:G,renderIcon:e.createIcon,disabled:i.value},null,8,["selectedKeys","treeData","renderIcon","disabled"])):h("",!0),s.value.length===0?(c(),b("div",de,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])]),l("div",ne,[t[2]||(t[2]=l("div",{class:"text-center p-2 bg-gray-100 border-1 border-l-0 border-gray-200"},"文档名称",-1)),l("div",ce,[o.value.length>0?(c(),E(a(Q),{key:0,disabled:i.value,value:n.value,"onUpdate:value":t[0]||(t[0]=r=>n.value=r),class:"w-full"},{default:_(()=>[(c(!0),b(ae,null,se(o.value,(r,I)=>(c(),b("div",{class:"flex-1 flex",key:I},[y(a(X),{class:"h-8 leading-8 flex-1 overflow-hidden",value:r.id},{default:_(()=>[l("span",{title:r.title},D(r.title),9,ue)]),_:2},1032,["value"]),l("div",fe,D(r.kg_ctt),1)]))),128))]),_:1},8,["disabled","value"])):h("",!0),o.value.length===0?(c(),b("div",me,[y(a(p),{class:"mt-30",image:a(p).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):h("",!0)])])])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{Ie as _};
