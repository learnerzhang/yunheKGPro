var N=(D,E,i)=>new Promise((b,g)=>{var y=o=>{try{r(i.next(o))}catch(a){g(a)}},s=o=>{try{r(i.throw(o))}catch(a){g(a)}},r=o=>o.done?b(o.value):Promise.resolve(o.value).then(y,s);r((i=i.apply(D,E)).next())});import{d as q,f as p,o as J,Z as v,_ as C,k as u,a5 as d,u as l,B as k,G as h,a3 as Q,a4 as M,$ as w,a8 as B,y as x,l as _}from"./vue-7EN2lk9e.js";import{_ as U}from"./index-CAJtQUpX.js";import{an as $}from"./entry/index-CMbP4qrD-1735889696146.js";import{g as X,a as Y,b as ee,d as te}from"./graph-Bie93KbO.js";import{M as ae,A as le,B as K,D as ne,w as se,ai as I,aj as re,j as m,ak as oe}from"./antd-DuSlDOy9.js";const ie={class:"m-4 mr-0 bg-white folder-tree"},de=["onMouseenter","onMouseleave"],ye=q({name:"EntityTree",__name:"FolderTree",emits:["select"],setup(D,{emit:E}){const i=E,[b,g]=ae.useModal();let y=p(""),s=p(""),r=p("");const o=p(null),a=p(null),S=p([]),P=()=>N(this,null,function*(){const e=(yield X({page:1,pageSize:9999}))||{},t=[{id:"0",name:"根实体类",disabled:!0,children:(e==null?void 0:e.data)||[]}];S.value=t,t[0].children.length>0&&(r.value=t[0].children[0].id,i("select",r.value),x(()=>{a.value.setSelectedKeys([r.value])})),x(()=>{a.value.expandAll(!0),a.value.filterByLevel(2)})});J(()=>{P()});const R=()=>document.getElementById("temp-folder-tree-wrapper"),A=e=>{r.value=e[0],i("select",e[0])};let c=p("");const V=e=>{const t=e.target.value;c.value=t},L=e=>{if(s.value){m.error("存在未保存的数据，请先保存或取消");return}const t=a.value.getExpandedKeys();t.includes(e.id)||a.value.setExpandedKeys([...t,e.id]),s.value="add",c.value="",x(()=>{a.value.insertNodeByKey({parentKey:e.id,node:{name:"",id:"add",parent_id:e.id},push:"unshift"}),x(()=>{o.value.focus()})})},T=e=>N(this,null,function*(){if(!c.value){m.error("实体类名称不能为空");return}if(e.id!="add")yield Y({name:c.value,sid:e.id}),a.value.updateNodeByKey(e.id,{id:e.id,name:c.value}),a.value.setSelectedKeys([e.id]),r.value=e.id,s.value="",i("select",e.id);else{const t=yield ee({name:c.value});a.value.updateNodeByKey(e.id,{id:t.id,name:t.name,parent_id:t.parent_id}),a.value.setSelectedKeys([t.id]),r.value=t.id,s.value="",i("select",t.id)}}),O=e=>{if(s.value){m.error("存在未保存的数据，请先保存或取消");return}b.confirm({title:"你确定删除该实体类吗?",icon:_(oe),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:_($,{type:"danger",class:"pl-2 pr-2"},"确认删除"),cancelText:_($,{type:"default",class:"pl-2 pr-2"},"取消"),onOk(){te({sid:e.id}).then(()=>{a.value.deleteNodeByKey(e.id),r.value==e.id&&i("select",void 0)}).catch(t=>{})},onCancel(){}})},j=e=>{if(s.value){m.error("存在未保存的数据，请先保存或取消");return}s.value=e.id,c.value=e.name,x(()=>{o.value.focus()})},z=e=>{s.value="",e.id=="add"&&a.value.deleteNodeByKey("add")},F=e=>e.id=="0"?null:"ant-design:codepen-outlined",G=e=>{y.value=e.id},H=()=>{y.value=""},W=()=>{m.info("暂未实现导入功能")},Z=()=>{m.info("暂未实现导出功能")};return(e,t)=>(v(),C("div",ie,[u(l(U),{title:"实体类",ref_key:"treeRef",ref:a,toolbar:"",importable:"",exportable:"",search:"",defaultExpandAll:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:S.value,fieldNames:{key:"id",title:"name"},onSelect:A,onImport:W,onExport:Z,renderIcon:F},{title:d(n=>[l(s)===n.id?(v(),C("div",{key:0,class:"flex",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[u(l(le),{ref_key:"inputRef",ref:o,value:l(c),onClick:t[0]||(t[0]=k(()=>{},["stop"])),onChange:t[1]||(t[1]=f=>V(f)),onPressEnter:()=>T(n)},null,8,["value","onPressEnter"]),u(l(K),{type:"link",class:"p-0 pl-3",onClick:k(f=>T(n),["stop"])},{default:d(()=>t[4]||(t[4]=[h("保存")])),_:2},1032,["onClick"]),u(l(K),{type:"link",class:"p-0 pl-2",onClick:k(f=>z(n),["stop"])},{default:d(()=>t[5]||(t[5]=[h("取消")])),_:2},1032,["onClick"])])):(v(),C("div",{key:1,onMouseenter:()=>G(n),onMouseleave:()=>H(n),class:"flex-1 flex"},[u(l(K),{type:"link",class:"p-0 flex-1 text-gray-900 text-left !hover:text-blue-700"},{default:d(()=>[h(Q(n.name),1)]),_:2},1024),l(y)===n.id?(v(),C("div",{key:0,class:"absolute right-0 pr-2",onClick:t[3]||(t[3]=k(()=>{},["stop"])),id:"temp-folder-tree-wrapper"},[u(l(ne),{placement:"bottomRight",getPopupContainer:R},{overlay:d(()=>[u(l(se),null,{default:d(()=>[n.id=="0"?(v(),M(l(I),{key:"1",onClick:f=>L(n)},{default:d(()=>t[6]||(t[6]=[w("span",{class:"text-blue-700"},"新增实体",-1)])),_:2},1032,["onClick"])):B("",!0),n.id!="0"?(v(),M(l(I),{key:"2",onClick:f=>j(n)},{default:d(()=>t[7]||(t[7]=[w("span",{class:"text-blue-700"},"编辑",-1)])),_:2},1032,["onClick"])):B("",!0),n.id!="0"?(v(),M(l(I),{key:"3",onClick:f=>O(n)},{default:d(()=>t[8]||(t[8]=[w("span",{class:"text-red-500"},"删除",-1)])),_:2},1032,["onClick"])):B("",!0)]),_:2},1024)]),default:d(()=>[u(l(re),{class:"text-lg mt-2 font-bold text-gray-900"})]),_:2},1024)])):B("",!0)],40,de))]),_:1},8,["treeData"]),u(l(g))]))}});export{ye as _};
