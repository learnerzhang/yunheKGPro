var w=(h,B,f)=>new Promise((g,r)=>{var N=a=>{try{u(f.next(a))}catch(i){r(i)}},_=a=>{try{u(f.throw(a))}catch(i){r(i)}},u=a=>a.done?g(a.value):Promise.resolve(a.value).then(N,_);u((f=f.apply(h,B)).next())});import{d as W,Y,f as p,o as Z,Z as v,_ as C,k as n,a5 as d,u as s,B as y,G as E,a4 as R,ad as J,a8 as k,a3 as Q,$ as X,y as b,l as I}from"./vue-7EN2lk9e.js";import{_ as ee}from"./index-CAJtQUpX.js";import{an as $}from"./entry/index-CMbP4qrD-1735889696146.js";import{g as te,a as ae,b as le,d as se}from"./graph-Bie93KbO.js";import{u as oe}from"./index-cSGZvoEm.js";import{_ as ne}from"./UpdateEntityStyleModal.vue_vue_type_script_setup_true_lang-mprA28DA.js";import{M as re,A as ie,B as K,b9 as de,D as ue,w as ce,ai as pe,aj as fe,j as x,ak as me}from"./antd-DuSlDOy9.js";const ve={class:"m-4 mr-0 bg-white folder-tree"},ye=["onMouseenter","onMouseleave"],Ee=W({name:"EntityTree",__name:"FolderTree",props:{showNodeColor:{type:Boolean,default:!1}},emits:["select","success"],setup(h,{emit:B}){const f=Y(),{currentRoute:g}=f,r=B,[N,_]=re.useModal();let u=p(""),a=p(""),i=p("");const S=p(null),o=p(null),M=p([]),T=()=>w(this,null,function*(){const e=(yield te({page:1,pageSize:1e3,taskId:g.value.query.id}))||{},t=[{id:"0",name:"全部实体类",children:(e==null?void 0:e.data)||[]}];M.value=t,b(()=>{o.value.expandAll(!0),o.value.filterByLevel(2)})});Z(()=>{T()});const P=()=>document.getElementById("temp-folder-tree-wrapper"),V=e=>{i.value=e[0];const t=M.value[0].children.find(l=>l.id==e[0]);r("select",t)};let c=p("");const A=e=>{const t=e.target.value;c.value=t},ke=e=>{if(a.value){x.error("存在未保存的数据，请先保存或取消");return}const t=o.value.getExpandedKeys();t.includes(e.id)||o.value.setExpandedKeys([...t,e.id]),a.value="add",c.value="",b(()=>{o.value.insertNodeByKey({parentKey:e.id,node:{name:"",id:"add",parent_id:e.id},push:"unshift"}),b(()=>{S.value.focus()})})},D=e=>w(this,null,function*(){if(!c.value){x.error("实体类名称不能为空");return}if(e.id!="add")yield ae({name:c.value,sid:e.id}),o.value.updateNodeByKey(e.id,{id:e.id,name:c.value}),o.value.setSelectedKeys([e.id]),i.value=e.id,a.value="",r("select",e.id);else{const t=yield le({name:c.value});o.value.updateNodeByKey(e.id,{id:t.id,name:t.name,parent_id:t.parent_id}),o.value.setSelectedKeys([t.id]),i.value=t.id,a.value="",r("select",t.id)}}),xe=e=>{if(a.value){x.error("存在未保存的数据，请先保存或取消");return}N.confirm({title:"你确定删除该实体类吗?",icon:I(me),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:I($,{type:"danger",class:"pl-2 pr-2"},"确认删除"),cancelText:I($,{type:"default",class:"pl-2 pr-2"},"取消"),onOk(){se({sid:e.id}).then(()=>{o.value.deleteNodeByKey(e.id),i.value==e.id&&r("select",void 0)}).catch(t=>{})},onCancel(){}})},[z,{openModal:O}]=oe(),L=e=>{O(!0,{record:e,isUpdate:!0})},j=e=>{o.value.updateNodeByKey(e.id,{id:e.id,name:e.name,size:e.size,color:e.color}),r("success",e)},q=e=>{a.value="",e.id=="add"&&o.value.deleteNodeByKey("add")},F=e=>{u.value=e.id},G=()=>{u.value=""},H=()=>{x.info("暂未实现导入功能")},U=()=>{x.info("暂未实现导出功能")};return(e,t)=>(v(),C("div",ve,[n(s(ee),{title:"实体类",ref_key:"treeRef",ref:o,toolbar:"",importable:"",exportable:"",search:"",defaultExpandAll:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:M.value,fieldNames:{key:"id",title:"name"},onSelect:V,onImport:H,onExport:U},{title:d(l=>[s(a)===l.id?(v(),C("div",{key:0,class:"flex",onClick:t[2]||(t[2]=y(()=>{},["stop"]))},[n(s(ie),{ref_key:"inputRef",ref:S,value:s(c),onClick:t[0]||(t[0]=y(()=>{},["stop"])),onChange:t[1]||(t[1]=m=>A(m)),onPressEnter:()=>D(l)},null,8,["value","onPressEnter"]),n(s(K),{type:"link",class:"p-0 pl-3",onClick:y(m=>D(l),["stop"])},{default:d(()=>t[4]||(t[4]=[E("保存")])),_:2},1032,["onClick"]),n(s(K),{type:"link",class:"p-0 pl-2",onClick:y(m=>q(l),["stop"])},{default:d(()=>t[5]||(t[5]=[E("取消")])),_:2},1032,["onClick"])])):(v(),C("div",{key:1,onMouseenter:()=>F(l),onMouseleave:()=>G(l),class:"flex-1 flex"},[n(s(K),{type:"link",class:"p-0 flex-1 text-gray-900 text-left !hover:text-blue-700"},{default:d(()=>[l.id!="0"?(v(),R(s(de),{key:0,style:J({color:h.showNodeColor?l.color:""})},null,8,["style"])):k("",!0),E(" "+Q(l.name),1)]),_:2},1024),s(u)===l.id&&l.id!="0"&&h.showNodeColor?(v(),C("div",{key:0,class:"absolute right-0 pr-2",onClick:t[3]||(t[3]=y(()=>{},["stop"])),id:"temp-folder-tree-wrapper"},[n(s(ue),{placement:"bottomRight",getPopupContainer:P},{overlay:d(()=>[n(s(ce),null,{default:d(()=>[k("",!0),l.id!="0"?(v(),R(s(pe),{key:"2",onClick:m=>L(l)},{default:d(()=>t[7]||(t[7]=[X("span",{class:"text-blue-700"},"编辑预览样式",-1)])),_:2},1032,["onClick"])):k("",!0),k("",!0)]),_:2},1024)]),default:d(()=>[n(s(fe),{class:"text-lg mt-2 font-bold text-gray-900"})]),_:2},1024)])):k("",!0)],40,ye))]),_:1},8,["treeData"]),n(s(_)),n(ne,{onRegister:s(z),onSuccess:j},null,8,["onRegister"])]))}});export{Ee as _};
