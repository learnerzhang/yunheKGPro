var M=(D,B,d)=>new Promise((k,x)=>{var N=r=>{try{l(d.next(r))}catch(c){x(c)}},m=r=>{try{l(d.throw(r))}catch(c){x(c)}},l=r=>r.done?k(r.value):Promise.resolve(r.value).then(N,m);l((d=d.apply(D,B)).next())});import{d as Z,f as p,o as q,Z as f,_ as C,k as o,a5 as i,u as a,B as y,G as b,a3 as z,$ as w,a4 as $,a8 as I,y as g,l as E}from"./vue-7EN2lk9e.js";import{_ as J}from"./index-BX9C0oMS.js";import{ah as Q,an as F}from"./entry/index-BcL7-Cog-1735891856356.js";import{j as X,u as Y,l as ee,m as te}from"./temp-CMAOzxLB.js";import{M as ae,A as le,B as h,D as se,w as re,ai as K,aj as ne,j as _,ak as oe}from"./antd-DuSlDOy9.js";const ie={class:"m-4 mr-0 bg-white folder-tree"},de=["onMouseenter","onMouseleave"],ye=Z({name:"FolderTree",__name:"FolderTree",emits:["select"],setup(D,{emit:B}){const d=B,k=Q(),[x,N]=ae.useModal();let m=p(""),l=p(""),r=p("");const c=p(null),n=p(null),S=p([]),P=()=>M(this,null,function*(){const e=(yield X())||{},t=[{id:"0",name:"模板目录",children:(e==null?void 0:e.tabctt)||[]}];S.value=t,g(()=>{n.value.expandAll(!0),n.value.filterByLevel(2)})});q(()=>{P()});const R=()=>document.getElementById("temp-folder-tree-wrapper"),A=e=>{r.value=e[0],d("select",e[0])};let u=p("");const V=e=>{const t=e.target.value;u.value=t},j=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}const t=n.value.getExpandedKeys();t.includes(e.id)||n.value.setExpandedKeys([...t,e.id]),l.value="add",u.value="",g(()=>{n.value.insertNodeByKey({parentKey:e.id,node:{name:"",id:"add",parent_id:e.id},push:"unshift"}),g(()=>{c.value.focus()})})},T=e=>M(this,null,function*(){if(!u.value){_.error("文件夹名称不能为空");return}if(e.id!="add")yield Y({user_id:k.getUserInfo.userId,name:u.value,id:e.id}),n.value.updateNodeByKey(e.id,{id:e.id,name:u.value,parent_id:e.parent_id}),n.value.setSelectedKeys([e.id]),r.value=e.id,l.value="",d("select",e.id);else{const t=yield ee({parent_id:e.parent_id,name:u.value,user_id:k.getUserInfo.userId});n.value.updateNodeByKey(e.id,{id:t.id,name:t.name,parent_id:t.parent_id}),n.value.setSelectedKeys([t.id]),r.value=t.id,l.value="",d("select",t.id)}}),L=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}x.confirm({title:"你确定删除该目录吗?",icon:E(oe),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:E(F,{type:"danger",class:"pl-2 pr-2"},"确认删除"),cancelText:E(F,{type:"default",class:"pl-2 pr-2"},"取消"),onOk(){te({id:e.id}).then(()=>{n.value.deleteNodeByKey(e.id),r.value==e.id&&d("select",void 0)}).catch(t=>{})},onCancel(){}})},O=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}l.value=e.id,u.value=e.name,g(()=>{c.value.focus()})},U=e=>{l.value="",e.id=="add"&&n.value.deleteNodeByKey("add")},G=()=>"ant-design:folder-outlined",H=e=>{m.value=e.id},W=()=>{m.value=""};return(e,t)=>(f(),C("div",ie,[o(a(J),{title:"应用模板",ref_key:"treeRef",ref:n,defaultExpandAll:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:S.value,fieldNames:{key:"id",title:"name"},onSelect:A,renderIcon:G},{title:i(s=>[a(l)===s.id?(f(),C("div",{key:0,class:"flex",onClick:t[2]||(t[2]=y(()=>{},["stop"]))},[o(a(le),{ref_key:"inputRef",ref:c,value:a(u),onClick:t[0]||(t[0]=y(()=>{},["stop"])),onChange:t[1]||(t[1]=v=>V(v)),onPressEnter:()=>T(s)},null,8,["value","onPressEnter"]),o(a(h),{type:"link",class:"p-0 pl-3",onClick:y(v=>T(s),["stop"])},{default:i(()=>t[4]||(t[4]=[b("保存")])),_:2},1032,["onClick"]),o(a(h),{type:"link",class:"p-0 pl-2",onClick:y(v=>U(s),["stop"])},{default:i(()=>t[5]||(t[5]=[b("取消")])),_:2},1032,["onClick"])])):(f(),C("div",{key:1,onMouseenter:()=>H(s),onMouseleave:()=>W(s),class:"flex-1 flex"},[o(a(h),{type:"link",class:"p-0 flex-1 text-gray-900 text-left !hover:text-blue-700"},{default:i(()=>[b(z(s.name),1)]),_:2},1024),a(m)===s.id?(f(),C("div",{key:0,class:"absolute right-0 pr-2",onClick:t[3]||(t[3]=y(()=>{},["stop"])),id:"temp-folder-tree-wrapper"},[o(a(se),{placement:"bottomRight",getPopupContainer:R},{overlay:i(()=>[o(a(re),null,{default:i(()=>[o(a(K),{key:"1",onClick:v=>j(s)},{default:i(()=>t[6]||(t[6]=[w("span",{class:"text-blue-700"},"新增子目录",-1)])),_:2},1032,["onClick"]),s.id!="0"?(f(),$(a(K),{key:"2",onClick:v=>O(s)},{default:i(()=>t[7]||(t[7]=[w("span",{class:"text-blue-700"},"编辑",-1)])),_:2},1032,["onClick"])):I("",!0),s.id!="0"?(f(),$(a(K),{key:"3",onClick:v=>L(s)},{default:i(()=>t[8]||(t[8]=[w("span",{class:"text-red-500"},"删除",-1)])),_:2},1032,["onClick"])):I("",!0)]),_:2},1024)]),default:i(()=>[o(a(ne),{class:"text-lg mt-2 font-bold"})]),_:2},1024)])):I("",!0)],40,de))]),_:1},8,["treeData"]),o(a(N))]))}});export{ye as _};
