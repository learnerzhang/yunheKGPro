var M=(I,N,i)=>new Promise((b,k)=>{var m=r=>{try{u(i.next(r))}catch(a){k(a)}},n=r=>{try{u(i.throw(r))}catch(a){k(a)}},u=r=>r.done?b(r.value):Promise.resolve(r.value).then(m,n);u((i=i.apply(I,N)).next())});import{d as Z,f as p,o as q,Z as v,_ as x,k as d,a5 as o,u as l,B as y,G as _,a3 as z,a4 as w,$ as E,a8 as C,y as g,l as h}from"./vue-7EN2lk9e.js";import{_ as J}from"./index-BneN3eq6.js";import{an as S}from"./entry/index-gwXb_KLU-1735894345864.js";import{a as Q,b as U,d as X,e as Y}from"./tag-t-ySJcDI.js";import{M as ee,A as te,B as K,D as ae,w as le,ai as D,aj as se,j as B,ak as ne}from"./antd-DuSlDOy9.js";const re={class:"m-4 mr-0 bg-white folder-tree"},oe=["onMouseenter","onMouseleave"],fe=Z({name:"FolderTree",__name:"FolderTree",emits:["select"],setup(I,{emit:N}){const i=N,[b,k]=ee.useModal();let m=p(""),n=p(""),u=p("");const r=p(null),a=p(null),T=p([]),F=()=>M(this,null,function*(){const e=(yield Q())||{},t=[{id:"0",name:"标签目录",children:(e==null?void 0:e.data)||[]}];T.value=t,g(()=>{a.value.expandAll(!0),a.value.filterByLevel(2)})});q(()=>{F()});const P=()=>document.getElementById("temp-folder-tree-wrapper"),R=e=>{u.value=e[0],i("select",e[0])};let c=p("");const A=e=>{const t=e.target.value;c.value=t},V=e=>{if(n.value){B.error("存在未保存的数据，请先保存或取消");return}const t=a.value.getExpandedKeys();t.includes(e.id)||a.value.setExpandedKeys([...t,e.id]),n.value="add",c.value="",g(()=>{a.value.insertNodeByKey({parentKey:e.id,node:{name:"",id:"add",parent_id:e.id},push:"unshift"}),g(()=>{r.value.focus()})})},$=e=>M(this,null,function*(){if(!c.value){B.error("文件夹名称不能为空");return}if(e.id!="add")yield U({name:c.value,tabtag_id:e.id}),a.value.updateNodeByKey(e.id,{id:e.id,name:c.value}),a.value.setSelectedKeys([e.id]),u.value=e.id,n.value="",i("select",e.id);else{const t=yield X({name:c.value});a.value.updateNodeByKey(e.id,{id:t.id,name:t.name,parent_id:t.parent_id}),a.value.setSelectedKeys([t.id]),u.value=t.id,n.value="",i("select",t.id)}}),L=e=>{if(n.value){B.error("存在未保存的数据，请先保存或取消");return}b.confirm({title:"你确定删除该目录吗?",icon:h(ne),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:h(S,{type:"danger",class:"pl-2 pr-2"},"确认删除"),cancelText:h(S,{type:"default",class:"pl-2 pr-2"},"取消"),onOk(){Y({id:e.id}).then(()=>{a.value.deleteNodeByKey(e.id),u.value==e.id&&i("select",void 0)}).catch(t=>{})},onCancel(){}})},O=e=>{if(n.value){B.error("存在未保存的数据，请先保存或取消");return}n.value=e.id,c.value=e.name,g(()=>{r.value.focus()})},j=e=>{n.value="",e.id=="add"&&a.value.deleteNodeByKey("add")},G=()=>"ant-design:folder-outlined",H=e=>{m.value=e.id},W=()=>{m.value=""};return(e,t)=>(v(),x("div",re,[d(l(J),{title:"标签目录",ref_key:"treeRef",ref:a,toolbar:"",search:"",defaultExpandAll:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:T.value,fieldNames:{key:"id",title:"name"},onSelect:R,renderIcon:G},{title:o(s=>[l(n)===s.id?(v(),x("div",{key:0,class:"flex",onClick:t[2]||(t[2]=y(()=>{},["stop"]))},[d(l(te),{ref_key:"inputRef",ref:r,value:l(c),onClick:t[0]||(t[0]=y(()=>{},["stop"])),onChange:t[1]||(t[1]=f=>A(f)),onPressEnter:()=>$(s)},null,8,["value","onPressEnter"]),d(l(K),{type:"link",class:"p-0 pl-3",onClick:y(f=>$(s),["stop"])},{default:o(()=>t[4]||(t[4]=[_("保存")])),_:2},1032,["onClick"]),d(l(K),{type:"link",class:"p-0 pl-2",onClick:y(f=>j(s),["stop"])},{default:o(()=>t[5]||(t[5]=[_("取消")])),_:2},1032,["onClick"])])):(v(),x("div",{key:1,onMouseenter:()=>H(s),onMouseleave:()=>W(s),class:"flex-1 flex"},[d(l(K),{type:"link",class:"p-0 flex-1 text-gray-900 text-left !hover:text-blue-700"},{default:o(()=>[_(z(s.name),1)]),_:2},1024),l(m)===s.id?(v(),x("div",{key:0,class:"absolute right-0 pr-2",onClick:t[3]||(t[3]=y(()=>{},["stop"])),id:"temp-folder-tree-wrapper"},[d(l(ae),{placement:"bottomRight",getPopupContainer:P},{overlay:o(()=>[d(l(le),null,{default:o(()=>[s.id=="0"?(v(),w(l(D),{key:"1",onClick:f=>V(s)},{default:o(()=>t[6]||(t[6]=[E("span",{class:"text-blue-700"},"新增子目录",-1)])),_:2},1032,["onClick"])):C("",!0),s.id!="0"?(v(),w(l(D),{key:"2",onClick:f=>O(s)},{default:o(()=>t[7]||(t[7]=[E("span",{class:"text-blue-700"},"编辑",-1)])),_:2},1032,["onClick"])):C("",!0),s.id!="0"?(v(),w(l(D),{key:"3",onClick:f=>L(s)},{default:o(()=>t[8]||(t[8]=[E("span",{class:"text-red-500"},"删除",-1)])),_:2},1032,["onClick"])):C("",!0)]),_:2},1024)]),default:o(()=>[d(l(se),{class:"text-lg mt-2 font-bold"})]),_:2},1024)])):C("",!0)],40,oe))]),_:1},8,["treeData"]),d(l(k))]))}});export{fe as _};
