var b=(D,B,d)=>new Promise((k,x)=>{var N=n=>{try{l(d.next(n))}catch(c){x(c)}},m=n=>{try{l(d.throw(n))}catch(c){x(c)}},l=n=>n.done?k(n.value):Promise.resolve(n.value).then(N,m);l((d=d.apply(D,B)).next())});import{d as Z,f as p,o as q,Z as v,_ as C,k as o,a5 as i,u as a,B as y,G as M,a3 as z,$ as w,a4 as $,a8 as I,y as g,l as h}from"./vue-7EN2lk9e.js";import{_ as J}from"./index-CAJtQUpX.js";import{ah as Q,an as F}from"./entry/index-CMbP4qrD-1735889696146.js";import{a as X,u as Y,c as ee,b as te}from"./file-CwdbWB1Z.js";import{M as ae,A as le,B as E,D as se,w as re,ai as K,aj as ne,j as _,ak as oe}from"./antd-DuSlDOy9.js";const ie={class:"m-4 mr-0 bg-white folder-tree"},de=["onMouseenter","onMouseleave"],ye=Z({name:"FilesTree",__name:"FolderTree",emits:["select"],setup(D,{emit:B}){const d=B,k=Q(),[x,N]=ae.useModal();let m=p(""),l=p(""),n=p("");const c=p(null),r=p(null),S=p([]),P=()=>b(this,null,function*(){const e=(yield X())||{},t=[{id:"0",name:"文档目录",children:(e==null?void 0:e.tabctt)||[]}];S.value=t,g(()=>{r.value.expandAll(!0),r.value.filterByLevel(2)})});q(()=>{P()});const R=()=>document.getElementById("file-folder-tree-wrapper"),A=e=>{d("select",e[0])};let u=p("");const L=e=>{const t=e.target.value;u.value=t},V=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}const t=r.value.getExpandedKeys();t.includes(e.id)||r.value.setExpandedKeys([...t,e.id]),l.value="add",u.value="",g(()=>{r.value.insertNodeByKey({parentKey:e.id,node:{name:"",id:"add",parent_id:e.id},push:"unshift"}),g(()=>{c.value.focus()})})},T=e=>b(this,null,function*(){if(!u.value){_.error("文件夹名称不能为空");return}if(e.id!="add")yield Y({user_id:k.getUserInfo.userId,name:u.value,id:e.id}),r.value.updateNodeByKey(e.id,{id:e.id,name:u.value,parent_id:e.parent_id}),r.value.setSelectedKeys([e.id]),n.value=e.id,l.value="",d("select",e.id);else{const t=yield ee({parent_id:e.parent_id,name:u.value,user_id:k.getUserInfo.userId});r.value.updateNodeByKey(e.id,{id:t.id,name:t.name,parent_id:t.parent_id}),r.value.setSelectedKeys([t.id]),n.value=t.id,l.value="",d("select",t.id)}}),O=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}x.confirm({title:"你确定删除该目录吗?",icon:h(oe),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:h(F,{type:"danger",class:"pl-2 pr-2"},"确认删除"),cancelText:h(F,{type:"default",class:"pl-2 pr-2"},"取消"),confirmLoading:!1,onOk(){te({id:e.id}).then(()=>{r.value.deleteNodeByKey(e.id),n.value==e.id&&d("select",void 0)}).catch(t=>{})},onCancel(){}})},U=e=>{if(l.value){_.error("存在未保存的数据，请先保存或取消");return}l.value=e.id,u.value=e.name,g(()=>{c.value.focus()})},j=e=>{l.value="",e.id=="add"&&r.value.deleteNodeByKey("add")},G=()=>"ant-design:folder-outlined",H=e=>{m.value=e.id},W=()=>{m.value=""};return(e,t)=>(v(),C("div",ie,[o(a(J),{title:"文档目录",ref_key:"treeRef",ref:r,toolbar:"",search:"",defaultExpandAll:"",treeWrapperClassName:"h-[calc(100%-35px)] overflow-auto",clickRowToExpand:!1,treeData:S.value,fieldNames:{key:"id",title:"name"},onSelect:A,renderIcon:G},{title:i(s=>[a(l)===s.id?(v(),C("div",{key:0,class:"flex",onClick:t[2]||(t[2]=y(()=>{},["stop"]))},[o(a(le),{ref_key:"inputRef",ref:c,value:a(u),onClick:t[0]||(t[0]=y(()=>{},["stop"])),onChange:t[1]||(t[1]=f=>L(f)),onPressEnter:()=>T(s)},null,8,["value","onPressEnter"]),o(a(E),{type:"link",class:"p-0 pl-3",onClick:y(f=>T(s),["stop"])},{default:i(()=>t[4]||(t[4]=[M("保存")])),_:2},1032,["onClick"]),o(a(E),{type:"link",class:"p-0 pl-2",onClick:y(f=>j(s),["stop"])},{default:i(()=>t[5]||(t[5]=[M("取消")])),_:2},1032,["onClick"])])):(v(),C("div",{key:1,onMouseenter:()=>H(s),onMouseleave:()=>W(s),class:"flex-1 flex"},[o(a(E),{type:"link",class:"p-0 flex-1 text-gray-900 text-left !hover:text-blue-700"},{default:i(()=>[M(z(s.name),1)]),_:2},1024),a(m)===s.id?(v(),C("div",{key:0,class:"absolute right-0 pr-2",onClick:t[3]||(t[3]=y(()=>{},["stop"])),id:"file-folder-tree-wrapper"},[o(a(se),{placement:"bottomRight",getPopupContainer:R},{overlay:i(()=>[o(a(re),null,{default:i(()=>[o(a(K),{key:"1",onClick:f=>V(s)},{default:i(()=>t[6]||(t[6]=[w("span",{class:"text-blue-700"},"新增子目录",-1)])),_:2},1032,["onClick"]),s.id!="0"?(v(),$(a(K),{key:"2",onClick:f=>U(s)},{default:i(()=>t[7]||(t[7]=[w("span",{class:"text-blue-700"},"编辑",-1)])),_:2},1032,["onClick"])):I("",!0),s.id!="0"?(v(),$(a(K),{key:"3",onClick:f=>O(s)},{default:i(()=>t[8]||(t[8]=[w("span",{class:"text-red-500"},"删除",-1)])),_:2},1032,["onClick"])):I("",!0)]),_:2},1024)]),default:i(()=>[o(a(ne),{class:"text-lg mt-2 font-bold"})]),_:2},1024)])):I("",!0)],40,de))]),_:1},8,["treeData"]),o(a(N))]))}});export{ye as _};
