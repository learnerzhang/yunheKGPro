var f=(t,a,r)=>new Promise((i,c)=>{var p=s=>{try{n(r.next(s))}catch(d){c(d)}},u=s=>{try{n(r.throw(s))}catch(d){c(d)}},n=s=>s.done?i(s.value):Promise.resolve(s.value).then(p,u);n((r=r.apply(t,a)).next())});import{u as I,_ as b}from"./useForm-DGjywljk.js";import"./BasicForm.vue_vue_type_style_index_0_lang-DeNCmJ5N.js";import{ab as P,al as S,am as y,n as R,an as B}from"./antd-DuSlDOy9.js";import{g as M}from"./tag-Tp0Cxjuf.js";import{a as k,e as v}from"./file-CwdbWB1Z.js";import{l as m,d as L,f as z,c as A,u as o,Z as U,a4 as C,a5 as D,k as H,a9 as T}from"./vue-7EN2lk9e.js";import{a as Y,B as $}from"./index-cSGZvoEm.js";import{ah as O}from"./entry/index-CMbP4qrD-1735889696146.js";const Q=[{title:"标题名称",dataIndex:"title",width:300},{title:"标签",dataIndex:"tags",width:200,align:"left",customRender:({record:t})=>m(S,{wrap:!0,size:["small","small"],align:"center"},{default:()=>t==null?void 0:t.tag_list.map(a=>m(P,{color:"processing"},a.name))})},{title:"类型",dataIndex:"type",width:100},{title:"大小",dataIndex:"size",width:100,customRender:({record:t})=>{const a=t.size/1024;return a<1024?`${a==0?"0":a.toFixed(2)}KB`:`${(a/1024).toFixed(2)}MB`}},{title:"推荐指数",dataIndex:"star",width:150,customRender:({record:t})=>m(y,{value:t.star||0,disabled:!0})},{title:"所属目录",dataIndex:"kg_ctt",width:120},{title:"上传人",dataIndex:"kg_user",width:100},{title:"更新时间",dataIndex:"update_time",width:140,customRender:({record:t})=>R(t.update_time).format("YYYY-MM-DD HH:mm")}],j=[{field:"title",label:"文档名称",required:!0,component:"Input",componentProps:{disabled:!0},colProps:{span:24}},{field:"ctt_id",label:"所属目录",required:!0,component:"ApiTreeSelect",componentProps:{api:k,labelField:"name",valueField:"id",resultField:"tabctt",params:{page:1,pageSize:1e3},showCheckedStrategy:"SHOW_ALL",dropdownStyle:{maxHeight:"400px",overflow:"auto"},placeholder:"请选择目录",treeDefaultExpandAll:!0,treeIcon:()=>m(B,{class:"mr-2"})},colProps:{span:24}},{field:"tagids",label:"标签",component:"ApiSelect",componentProps:{api:M,mode:"tags",labelField:"name",valueField:"id",resultField:"data",params:{page:1,pageSize:1e3}},colProps:{span:24}},{field:"star",label:"推荐指数",component:"Rate",colProps:{span:24}}],X=L({__name:"UpdateModal",emits:["success","register"],setup(t,{emit:a}){const r=a,i=z(!0),c=O();let p=null;const u=A(()=>(o(i),"编辑文档标签")),[n,{resetFields:s,setFieldsValue:d,validate:_}]=I({labelWidth:90,layout:"vertical",rowProps:{gutter:20},baseColProps:{span:24},schemas:j,showActionButtonGroup:!1}),[h,{setModalProps:g,closeModal:w}]=Y(e=>f(this,null,function*(){s(),g({confirmLoading:!1}),i.value=!!(e!=null&&e.isUpdate),o(i)&&(p=e.record,d({title:e.record.title,tagids:e.record.tagids||[],ctt_id:e.record.ctt_id,star:e.record.star}))}));function x(){return f(this,null,function*(){var e;try{let l=yield _();if(g({confirmLoading:!0}),o(i)){const F={tagids:(e=l==null?void 0:l.tagids)==null?void 0:e.join(","),doc_id:p.id,user_id:c.getUserInfo.userId,ctt_id:l.ctt_id,star:l.star};yield v(F)}w(),r("success")}finally{g({confirmLoading:!1})}})}return(e,l)=>(U(),C(o($),T(e.$attrs,{onRegister:o(h),showFooter:"",title:u.value,width:"500px",onOk:x}),{default:D(()=>[H(o(b),{onRegister:o(n)},null,8,["onRegister"])]),_:1},16,["onRegister","title"]))}});export{X as _,Q as c};
