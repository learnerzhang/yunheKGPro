var M=(N,w,f)=>new Promise((d,v)=>{var h=b=>{try{k(f.next(b))}catch(I){v(I)}},R=b=>{try{k(f.throw(b))}catch(I){v(I)}},k=b=>b.done?d(b.value):Promise.resolve(b.value).then(h,R);k((f=f.apply(N,w)).next())});import{g as we,h as Ne,e as Re,i as ze}from"./rule-Ct2F4qWd.js";import{P as Oe}from"./index-Fa5FDUAc.js";import{X as ue,c as Ue,an as he}from"./entry/index-gwXb_KLU-1735894345864.js";import{F as z}from"./FormBorder-B3cKGDVh.js";import{f as p,e as X,c as se,o as de,a6 as Ie,Z as s,_ as T,ad as ye,$ as j,ab as ke,G as _,F as A,a7 as L,a4 as m,a5 as o,a8 as x,g as De,y as be,p as G,d as je,w as Se,k as i,u as t,a3 as Q,Y as xe}from"./vue-7EN2lk9e.js";import{D as oe,w as ie,ai as S,bk as re,Q as Y,O as q,A as te,T as $e,f as _e,ae as Ee,af as ee,V as Ke,U as ge,ag as Ve,a9 as We,ac as Te,j as me}from"./antd-DuSlDOy9.js";import"./useContentViewHeight-DsKchgvx.js";import"./useWindowSizeFn-CiLeeFbn.js";import"./onMountedOrActivated-8STL9zTa.js";const He={name:"TreeChartNode",props:{node:{type:Object}},setup(N){const w=p(null),f=De();f&&(w.value=f.uid);const d=f.parent,v=p(null),h=X("nodeKey",null),R=X("childrenKey",null),k=X("lineOffset",null),b=X("lineColor",null),I=X("lineWidth",null),U=X("transition",null),$=X("rerender",null),O=p({transition:`all ${U}s`,left:"0px",top:"0px"}),D=p({transition:`all ${U}s`}),J=p({}),V=p({startX:0,startY:0,midX:0,midY:0,endX:0,endY:0}),E=p(0),H=p(0),K=p(0),g=p(0),r=p(!0),c=p([]),P=se(()=>Math.max(K.value,E.value)),ce=se(()=>H.value+g.value),pe=se(()=>{const u=V.value;return`M${u.startX-22||0},${u.startY||0}C${u.midX||0},${u.midY||0},${u.midX-4||0},${u.midY||0},${u.endX-12||0},${u.endY||0}`}),fe=(u,C)=>{u&&(c.value[C]=u)},Z=u=>(typeof u=="boolean"&&(r.value=u,$()),r.value),W=()=>new Promise(u=>{a(),be(()=>{n(),be(()=>{setTimeout(()=>{e(),u()},U*1e3)})})}),a=()=>{var u,C;v.value&&(E.value=(u=v.value.getBoundingClientRect())==null?void 0:u.height,H.value=(C=v.value.getBoundingClientRect())==null?void 0:C.width,K.value=0,g.value=0,c.value&&c.value.length>0?c.value.forEach(F=>{K.value+=F.blockHeight,F.blockWidth>g.value&&(g.value=F.blockWidth)}):K.value=E.value)},e=()=>{if(!v.value||d.type.name!=="TreeChartNode")return;const u=d.vnode.el.getBoundingClientRect(),C=v.value.getBoundingClientRect();D.value={height:Math.max(u.top+u.height,C.top+C.height)-Math.min(u.top,C.top)+"px",top:Math.min(0,u.top-C.top)+"px",left:u.left-C.left+22+"px",width:u.width+C.width+12+"px"};const F=u.width+k,le=C.height/2+Math.max(0,C.top-u.top),B=u.width-k,ae=u.top-C.top+u.height/2+Math.max(0,C.top-u.top);V.value={startX:F,startY:le,midX:B,midY:le,endX:B,endY:ae}},l=()=>{c.value&&c.value.length>0&&c.value.forEach(u=>{u.render()})},n=()=>{let u=0;const{elHeight:C=0,elWidth:F=0,subtreeHeight:le=0,childrenRefs:B=[]}=d.setupState;if(d.type.name==="TreeChartNode"){O.value.left=F+10+"px";let ae=0;if(B)for(let ve=0;ve<(B==null?void 0:B.length);ve++){const ne=B[ve];if((ne==null?void 0:ne.componentUid)===(w==null?void 0:w.value))break;ae+=ne.blockHeight}u+=ae-(le-C)/2}u+=(P.value-E.value)/2,O.value.top=u+"px"},y=()=>{},Ce=(u,C)=>h===void 0?C:typeof h=="function"?h(u):u[h];return de(()=>{W()}),{componentUid:w,childrenKey:R,lineColor:b,lineWidth:I,treeChartNodeRef:v,style:O,styleOfSvg:D,styleOfNode:J,pathOfSvg:V,elHeight:E,elWidth:H,subtreeHeight:K,subtreeWidth:g,visibleChildren:r,childrenRefs:c,blockHeight:P,blockWidth:ce,d:pe,childrenVisible:Z,render:W,calSize:a,drawLine:e,renderChildren:l,locate:n,collect:y,getNodeKey:Ce,getChildrenRef:fe}}},Be=["stroke-width","stroke","d"],Me={key:0,class:"an-treechart-node__children"};function qe(N,w,f,d,v,h){const R=Ie("TreeChartNode",!0);return s(),T("div",{class:"an-treechart-node",ref:"treeChartNodeRef",style:ye(d.style)},[(s(),T("svg",{class:"an-treechart-node__line",width:"100%",height:"100%",style:ye(d.styleOfSvg),version:"1.1",xmlns:"http://www.w3.org/2000/svg"},[j("path",{fill:"none","stroke-width":d.lineWidth,stroke:d.lineColor,d:d.d},null,8,Be)],4)),ke(N.$slots,"default",{node:f.node,childrenVisible:d.childrenVisible},()=>[w[0]||(w[0]=_("EMPTY"))],!0),d.visibleChildren&&f.node[d.childrenKey]&&f.node[d.childrenKey].length>0?(s(),T("div",Me,[(s(!0),T(A,null,L(f.node[d.childrenKey],(k,b)=>(s(),m(R,{ref_for:!0,ref:I=>d.getChildrenRef(I,b),key:d.getNodeKey(k,b),node:k,elWidth:d.elWidth,elHeight:d.elHeight},{default:o(({node:I,childrenVisible:U})=>[ke(N.$slots,"default",{node:I,childrenVisible:U},void 0,!0)]),_:2},1032,["node","elWidth","elHeight"]))),128))])):x("",!0)],4)}const Ye=ue(He,[["render",qe],["__scopeId","data-v-d62933b8"]]),Fe={name:"TreeChart",components:{TreeChartNode:Ye},props:{data:Object,nodeKey:{type:Function,required:!0},childrenKey:{type:String,default:"children"},lineColor:{type:String,default:"#666"},lineOffset:{type:Number,default:20},lineWidth:{type:Number,default:2},transition:{type:Number,default:0}},setup(N){const w=p({}),f=p(null),d=p(null);G("nodeKey",N.nodeKey),G("childrenKey",N.childrenKey),G("lineColor",N.lineColor),G("lineOffset",N.lineOffset),G("lineWidth",N.lineWidth),G("transition",N.transition);const v=p(0),h=()=>{v.value+=1},R=()=>{h(),be(()=>{k(),h()})},k=()=>{f.value&&(f.value.render(),w.value={width:f.value.blockWidth+"px",height:f.value.blockHeight+"px"})};return de(()=>{k()}),{style:w,rootRef:f,rerender:R,render:k,treeChartRef:d,forceUpdateKey:v}}};function Xe(N,w,f,d,v,h){const R=Ie("tree-chart-node");return s(),T("div",{class:"an-treechart",style:ye(d.style),ref:"treeChartRef"},[f.data&&Object.keys(f.data).length!==0?(s(),m(R,{key:d.forceUpdateKey,ref:"rootRef",node:f.data},{default:o(({node:k,childrenVisible:b})=>[ke(N.$slots,"default",{node:k,childrenVisible:b},void 0,!0)]),_:3},8,["node"])):x("",!0)],4)}const Ae=ue(Fe,[["render",Xe],["__scopeId","data-v-6f9eab47"]]),Le={id:"tree-container"},Je={class:"my-tree-node",style:{background:"#F7F7F9"}},Pe={key:0},Ge={key:1},Qe=["title"],Ze={key:2},et={key:0,class:"flex items-center"},tt={key:1,class:"flex items-center"},lt=["title"],at={key:2,class:"flex items-center"},nt=["title"],ot={key:3},it=je({name:"DecisionTree",__name:"DecisionTree",props:{rulesTarget:{type:String,require:!0,default:""},rulesValue:{type:String,required:!0,default:""},editDecisionTree:{type:Object,default:()=>({})}},emits:["sendTreeData"],setup(N,{expose:w,emit:f}){function d(a,e=null,l=0){return a.parent=e,a.index=l,a.children&&a.children.forEach((n,y)=>{d(n,a,y)}),a}function v(a){delete a.index,delete a.parent,delete a.isRoot,delete a.judge,delete a.attrValue}function h(a){return a.map(e=>{v(e),e.conditionInfos&&e.conditionInfos.length>0&&e.conditionInfos.map(l=>{Object.keys(l).forEach(n=>{l[n]=l[n]===void 0?"":l[n]})}),e.children&&e.children.length>0&&h(e.children)}),a}function R(a,e,l){return a.forEach(n=>{k(n.parent,e.parent)&&n.index===e.index&&(n.judge=!0,n.conditionInfos[1].judgeType=l),n.children&&n.children.length>0&&R(n.children,e,l)}),a}function k(a,e){if(a===e)return!0;let l=Object.getOwnPropertyNames(a),n=Object.getOwnPropertyNames(e);if(l.length!==n.length)return!1;for(let y in a)if(e.hasOwnProperty(y)){if(typeof a[y]=="object"){if(!k(a[y],e[y]))return!1}else if(a[y]!==e[y])return!1}else return!1;return!0}function b(a){return a.children&&a.children.length>0&&a.children.forEach(e=>{e.type==="condition"&&e.conditionInfos[1].value?e.judge=!0:e.type==="condition"&&!e.conditionInfos[1].value&&(e.judge=!1),e.children&&e.children.length>0&&b(e)}),a}const I=f,U=N,$=se(()=>U.rulesValue),O=p(null),D=p(d({isRoot:!0,type:"root",children:[],attrValue:""})),J=p([]),V=p([]),E=p([{operator:">",label:"大于"},{operator:">=",label:"大于等于"},{operator:"=",label:"等于"},{operator:"<",label:"小于"},{operator:"<=",label:"小于等于"}]),H=p([{id:"&",label:"且"},{id:"|",label:"或"}]),K=p(!0);Se(()=>U.editDecisionTree,a=>{K.value&&a&&(D.value=b(d(a)),D.value.isRoot=!0,D.value.attrValue=""),K.value=!1},{immediate:!0,deep:!0});const g=(a,e)=>{a.id=e.id,a.valueType=e.valueType,a.children=[]},r=()=>{const a=_e(D.value);v(a),a.children&&a.children.length>0&&(a.children=h(a.children)),I("sendTreeData",a)},c=(a,e)=>{R(D.value.children,a,e),a.conditionInfos[1].valueType="int",O.value.rerender()},P=a=>{let e=[];return a.children.forEach(l=>{e.push(l.type)}),!e.some(l=>l==="action")},ce=a=>a.children.length===0,pe=()=>M(this,null,function*(){const a=yield we({type:2,page:1,pageSize:1e4});J.value=a.data;let e=_e(a.data);V.value=e.filter(l=>{if(l.valueType!="boolean")return l.id=l.id.toString(),l})}),fe=a=>{a.children.forEach((e,l)=>{e.index=l})},Z=a=>{a.parent.children.splice(a.index,1),fe(a.parent),O.value.rerender()},W=(a,e,l)=>{a.children||(a.children=[]),a.type==="root"&&a.children.push({children:[],type:"attr",id:void 0,parent:a,index:a.children.length}),a.type==="attr"&&a.children.push({children:[],conditionInfos:[{connect:"&",operator:a.valueType=="boolean"?"=":void 0,value:void 0,valueType:a.valueType,judgeType:l},{connect:void 0,operator:void 0,value:void 0,valueType:void 0,judgeType:void 0}],type:"condition",parent:a,index:a.children.length,judge:!1}),a.type==="condition"&&(e==="attr"?a.children.push({children:[],id:void 0,type:e,parent:a,index:a.children.length}):e==="action"&&a.children.push({type:e,parent:a,index:a.children.length,value:""})),O.value.rerender()};return de(()=>M(this,null,function*(){yield pe(),O.value.rerender()})),w({consoleTree:r}),(a,e)=>(s(),T("div",Le,[i(Ae,{ref_key:"treechart",ref:O,data:D.value,"children-key":"children","line-color":"#E8E9EB","line-width":1,"line-offset":20,transition:0,"node-key":l=>l.attrValue},{default:o(({node:l})=>[j("div",Je,[l.type==="root"?(s(),T("div",Pe,[e[2]||(e[2]=j("p",{class:"mpks-decision-tree-line-root"},null,-1)),e[3]||(e[3]=j("span",{class:"mpks-decision-tree-text-root mpks-common-gap-right"},"根节点",-1)),i(t(oe),{trigger:"hover",size:"small",placement:"bottomLeft",arrow:""},{overlay:o(()=>[i(t(ie),{"append-to-body":!1},{default:o(()=>[i(t(S),{onClick:n=>W(l)},{default:o(()=>e[1]||(e[1]=[_("添加条件指标")])),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[i(t(re),{class:"text-gray-900 text-lg ml-2 font-bold"})]),_:2},1024)])):x("",!0),l.type==="attr"?(s(),T("div",Ge,[e[8]||(e[8]=j("p",{class:"mpks-decision-tree-line-attr"},null,-1)),i(t(z),null,{default:o(()=>[i(t(Y),{value:l.id,"onUpdate:value":n=>l.id=n,filterable:"",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-attr",placeholder:"请选择条件指标","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[(s(!0),T(A,null,L(J.value,(n,y)=>(s(),m(t(q),{key:y,value:n.id,onClick:Ce=>g(l,n)},{default:o(()=>[j("span",{title:n.zhName},Q(n.zhName),9,Qe)]),_:2},1032,["value","onClick"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),i(t(oe),{trigger:"hover",size:"small",placement:"bottomLeft",arrow:""},{overlay:o(()=>[i(t(ie),{"append-to-body":!1},{default:o(()=>[l.valueType=="boolean"?(s(),m(t(S),{key:0,onClick:n=>W(l,"condition","input")},{default:o(()=>e[4]||(e[4]=[_("添加布尔值判断条件")])),_:2},1032,["onClick"])):x("",!0),l.valueType&&l.valueType!="boolean"?(s(),m(t(S),{key:1,onClick:n=>W(l,"condition","input")},{default:o(()=>e[5]||(e[5]=[_("添加数值判断条件")])),_:2},1032,["onClick"])):x("",!0),l.valueType&&l.valueType!="boolean"?(s(),m(t(S),{key:2,onClick:n=>W(l,"condition","select")},{default:o(()=>e[6]||(e[6]=[_("添加指标比对判断条件")])),_:2},1032,["onClick"])):x("",!0),i(t(S),{onClick:n=>Z(l)},{default:o(()=>e[7]||(e[7]=[_("删除该节点")])),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[i(t(re),{class:"text-gray-900 text-lg ml-2 font-bold"})]),_:2},1024)])):x("",!0),l.type==="condition"?(s(),T("div",Ze,[e[16]||(e[16]=j("p",{class:"mpks-decision-tree-line-judge"},null,-1)),l.conditionInfos[0].valueType=="boolean"?(s(),T("div",et,[i(t(z),{class:"ml-2"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[0].value,"onUpdate:value":n=>l.conditionInfos[0].value=n,filterable:"",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-condition !w-22",placeholder:"判断符","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[i(t(q),{value:1},{default:o(()=>e[9]||(e[9]=[_("是")])),_:1}),i(t(q),{value:0},{default:o(()=>e[10]||(e[10]=[_("否")])),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)])):x("",!0),l.conditionInfos[0].valueType!="boolean"?(s(),T("div",tt,[i(t(z),{class:"inline-block"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[0].operator,"onUpdate:value":n=>l.conditionInfos[0].operator=n,filterable:"",placeholder:"判断符",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-condition","popper-class":"mpks-select-popper","popper-append-to-body":!1,"allow-clear":""},{default:o(()=>[(s(!0),T(A,null,L(E.value,(n,y)=>(s(),m(t(q),{key:y,value:n.operator},{default:o(()=>[_(Q(n.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l.conditionInfos[0].judgeType==="input"?(s(),m(t(z),{key:0,class:"inline-block ml-2"},{default:o(()=>[i(t(te),{value:l.conditionInfos[0].value,"onUpdate:value":n=>l.conditionInfos[0].value=n,type:"text",size:"middle",class:"mpks-add-rules-judge-input mpks-common-gap-right",placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1024)):l.conditionInfos[0].judgeType==="select"?(s(),m(t(z),{key:1,class:"ml-2"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[0].value,"onUpdate:value":n=>l.conditionInfos[0].value=n,filterable:"",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-attr",placeholder:"选择要比较的指标","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[(s(!0),T(A,null,L(V.value,(n,y)=>(s(),m(t(q),{key:y,value:n.id},{default:o(()=>[j("span",{title:n.zhName},Q(n.zhName),9,lt)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):x("",!0)])):x("",!0),j("div",null,[l.judge?(s(),m(t(z),{key:0,class:"ml-2"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[1].connect,"onUpdate:value":n=>l.conditionInfos[1].connect=n,filterable:"",placeholder:"连接符",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-connect","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[(s(!0),T(A,null,L(H.value,(n,y)=>(s(),m(t(q),{key:y,value:n.id},{default:o(()=>[_(Q(n.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):x("",!0)]),l.judge?(s(),T("div",at,[i(t(z),{class:"ml-2"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[1].operator,"onUpdate:value":n=>l.conditionInfos[1].operator=n,filterable:"",placeholder:"判断符",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-condition","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[(s(!0),T(A,null,L(E.value,(n,y)=>(s(),m(t(q),{key:y,value:n.operator},{default:o(()=>[_(Q(n.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l.conditionInfos[1].judgeType==="input"?(s(),m(t(z),{key:0,class:"ml-2"},{default:o(()=>[i(t(te),{value:l.conditionInfos[1].value,"onUpdate:value":n=>l.conditionInfos[1].value=n,type:"text",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-input",placeholder:"请输入"},null,8,["value","onUpdate:value"])]),_:2},1024)):l.conditionInfos[1].judgeType==="select"?(s(),m(t(z),{key:1,class:"ml-2"},{default:o(()=>[i(t(Y),{value:l.conditionInfos[1].value,"onUpdate:value":n=>l.conditionInfos[1].value=n,filterable:"",placeholder:"选择要比较的指标",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-attr","popper-class":"mpks-select-popper","popper-append-to-body":!1},{default:o(()=>[(s(!0),T(A,null,L(V.value,(n,y)=>(s(),m(t(q),{key:y,value:n.id},{default:o(()=>[j("span",{title:n.zhName},Q(n.zhName),9,nt)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):x("",!0)])):x("",!0),i(t(oe),{trigger:"hover",size:"small",placement:"bottomLeft",arrow:""},{overlay:o(()=>[i(t(ie),{"append-to-body":!1},{default:o(()=>[P(l)?(s(),m(t(S),{key:0,onClick:n=>W(l,"attr")},{default:o(()=>e[11]||(e[11]=[_("添加条件指标")])),_:2},1032,["onClick"])):x("",!0),ce(l)?(s(),m(t(S),{key:1,onClick:n=>W(l,"action")},{default:o(()=>e[12]||(e[12]=[_("添加规则目标")])),_:2},1032,["onClick"])):x("",!0),!l.judge&&l.conditionInfos[0].valueType!="boolean"?(s(),m(t(S),{key:2,onClick:n=>c(l,"input")},{default:o(()=>e[13]||(e[13]=[_("添加同级数值判断")])),_:2},1032,["onClick"])):x("",!0),!l.judge&&l.conditionInfos[0].valueType!="boolean"?(s(),m(t(S),{key:3,onClick:n=>c(l,"select")},{default:o(()=>e[14]||(e[14]=[_("添加同级指标比对判断")])),_:2},1032,["onClick"])):x("",!0),i(t(S),{onClick:n=>Z(l)},{default:o(()=>e[15]||(e[15]=[_("删除该节点")])),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[i(t(re),{class:"text-gray-900 text-lg ml-2 font-bold"})]),_:2},1024)])):x("",!0),l.type==="action"?(s(),T("div",ot,[e[18]||(e[18]=j("p",{class:"mpks-decision-tree-line-action"},null,-1)),i(t(z),{title:$.value},{default:o(()=>[i(t(te),{value:$.value,"onUpdate:value":e[0]||(e[0]=n=>$.value=n),size:"mini",type:"text",placeholder:"请输入规则目标",class:"mpks-common-gap-right mpks-add-rules-action-input"},null,8,["value"])]),_:1},8,["title"]),i(t($e),{effect:"light",placement:"top",content:l.value,disabled:l.value.length<=11,"popper-class":"mpks-decision-tree-tooltip"},{default:o(()=>[i(t(z),{class:"ml-2"},{default:o(()=>[i(t(te),{value:l.value,"onUpdate:value":n=>l.value=n,type:"text",size:"mini",class:"mpks-common-gap-right mpks-add-rules-judge-select-attr",placeholder:"请输入值"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1032,["content","disabled"]),i(t(oe),{trigger:"hover",size:"small",placement:"bottomLeft",arrow:""},{overlay:o(()=>[i(t(ie),{"append-to-body":!1},{default:o(()=>[i(t(S),{onClick:n=>Z(l)},{default:o(()=>e[17]||(e[17]=[_("删除该节点")])),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[i(t(re),{class:"text-gray-900 text-lg ml-2 font-bold"})]),_:2},1024)])):x("",!0)])]),_:1},8,["data","node-key"])]))}}),rt=ue(it,[["__scopeId","data-v-fb52a293"]]),st={class:"bg-light-50 p-12 pl-20 pr-20 pb-30 flex-1 overflow-y-auto"},ut={class:"flex"},dt={class:"flex"},ct={class:"flex-1 overflow-x-auto pb-4"},pt={class:"text-center absolute bottom-0 right-0 left-0 w-full py-8 border-t-1 border-gray-200 z-10 bg-light-50"},ft=je({name:"TempUploadComponent",__name:"config",setup(N){const w=Ue(),{currentRoute:f}=xe(),d=xe(),v=t(f);let h=p({rule_id:v.query.id||void 0,action_id:void 0,name:"",desc:""});const R=()=>M(this,null,function*(){const{id:g}=v.query,r=(yield Re({id:g}))||{};h.value={rule_id:v.query.id||void 0,action_id:(r==null?void 0:r.action_id)||void 0,name:(r==null?void 0:r.name)||"",desc:(r==null?void 0:r.desc)||""},O.value=r!=null&&r.content?JSON.parse(r==null?void 0:r.content):null});de(()=>M(this,null,function*(){yield D(),v.query.id&&R()}));const k=p(null),b=p(""),I=p([]),U=p([]),$=p({}),O=p(null),D=()=>M(this,null,function*(){const g=yield Ne({page:1,pageSize:1e4});U.value=g.data.map(r=>r.action_id),yield E()}),J=g=>{$.value=g},V=g=>{I.value.map(r=>{r.value===g&&(b.value=r.label)})},E=()=>M(this,null,function*(){var r;const g=yield we({type:1,page:1,pageSize:1e4});I.value=_e(((r=g==null?void 0:g.data)==null?void 0:r.map(c=>({label:c.zhName,value:c.id})))||[]),I.value=I.value.filter(c=>!U.value.includes(c.value)),v.query&&v.query.id&&g.data.map(c=>{c.id==v.query.actionId&&(b.value=c.zhName,I.value.push({value:c.id,label:c.zhName}))})}),H=(g="publish")=>M(this,null,function*(){const{action_id:r,name:c,desc:P}=h.value;if(!r){me.error("请选择规则目标");return}if(!c){me.error("请填写规则名称");return}k.value.consoleTree(),$.value||me.error("请配置规则内容"),yield ze({rule_id:v.query.id||void 0,name:c,desc:P||"",content:$.value?$.value:{},action_id:r||"",status:g==="publish"?1:0}),d.push({path:"/rule-manage/rule"})}),K=()=>{w("/rule-manage/rule")};return(g,r)=>(s(),m(t(Oe),{contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:o(()=>[j("div",st,[i(t(Ee),{layout:"vertical"},{default:o(()=>[i(t(ee),null,{default:o(()=>[j("div",ut,[r[4]||(r[4]=j("div",{class:"w-40 font-bold text-lg label-name"},"规则基本信息",-1)),i(t(Ke),{gutter:20,class:"flex-1"},{default:o(()=>[i(t(ge),{span:12},{default:o(()=>[i(t(ee),{label:"规则目标"},{default:o(()=>[i(t(z),null,{default:o(()=>[i(t(Y),{value:t(h).action_id,"onUpdate:value":r[0]||(r[0]=c=>t(h).action_id=c),options:I.value,onChange:V,placeholder:"请选择规则目标"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),i(t(ge),{span:12},{default:o(()=>[i(t(ee),{label:"规则名称"},{default:o(()=>[i(t(z),null,{default:o(()=>[i(t(te),{value:t(h).name,"onUpdate:value":r[1]||(r[1]=c=>t(h).name=c),placeholder:"请输入规则名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),i(t(ge),{span:24},{default:o(()=>[i(t(ee),{label:"规则说明"},{default:o(()=>[i(t(z),null,{default:o(()=>[i(t(Ve),{value:t(h).desc,"onUpdate:value":r[2]||(r[2]=c=>t(h).desc=c),"auto-size":{minRows:1,maxRows:5},placeholder:"请输入规则说明"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),i(t(We),{class:"mb-10"}),i(t(ee),null,{default:o(()=>[j("div",dt,[r[5]||(r[5]=j("div",{class:"w-40 font-bold text-lg label-name"},"规则内容",-1)),j("div",ct,[t(h).action_id?(s(),m(t(rt),{key:0,ref_key:"decisionTree",ref:k,"rules-value":b.value,"rules-target":String(t(h).action_id),"edit-decision-tree":O.value,onSendTreeData:J},null,8,["rules-value","rules-target","edit-decision-tree"])):(s(),m(t(Te),{key:1,class:"mt-20",description:"请先选择规则目标",image:t(Te).PRESENTED_IMAGE_SIMPLE},null,8,["image"]))])])]),_:1})]),_:1}),j("div",pt,[i(t(he),{type:"primary",class:"mr-4 w-30",onClick:r[3]||(r[3]=c=>H("publish"))},{default:o(()=>r[6]||(r[6]=[_("保存并发布")])),_:1}),i(t(he),{type:"default",class:"mr-4 w-30",onClick:H},{default:o(()=>r[7]||(r[7]=[_("保存")])),_:1}),i(t(he),{type:"default",class:"w-30",onClick:K},{default:o(()=>r[8]||(r[8]=[_("取消")])),_:1})])])]),_:1}))}}),Tt=ue(ft,[["__scopeId","data-v-f3694c1b"]]);export{Tt as default};
