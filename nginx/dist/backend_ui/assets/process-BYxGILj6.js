var re=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var A=(v,u,r)=>u in v?re(v,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[u]=r,O=(v,u)=>{for(var r in u||(u={}))ce.call(u,r)&&A(v,r,u[r]);if(q)for(var r of q(u))pe.call(u,r)&&A(v,r,u[r]);return v},F=(v,u)=>ue(v,de(u));var m=(v,u,r)=>new Promise((P,M)=>{var k=o=>{try{y(r.next(o))}catch(_){M(_)}},l=o=>{try{y(r.throw(o))}catch(_){M(_)}},y=o=>o.done?P(o.value):Promise.resolve(o.value).then(k,l);y((r=r.apply(v,u)).next())});import{d as ve,Y as me,f,o as fe,Z as i,a4 as g,a5 as d,$ as n,k as c,u as s,G as C,a8 as p,a3 as R,_ as b,F as ge,a7 as ke,B as _e,y as U,l as K}from"./vue-7EN2lk9e.js";import{_ as he}from"./model-title-bg-Bo7fDO4t.js";import{P as ye}from"./index-Fa5FDUAc.js";import{an as S,X as be}from"./entry/index-gwXb_KLU-1735894345864.js";import{u as V,_ as Q}from"./useTable-dUUy5G55.js";import"./TableImg.vue_vue_type_style_index_0_lang-B8XoVYjR.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BdxNsio9.js";import{b as xe,e as we,f as Ce,l as Se,p as Te,h as Ie}from"./task-DJafqcAW.js";import{g as Re}from"./model-Ceew6pBK.js";import{i as Pe,s as Me,l as ze,a as Be}from"./auto.data-DKQ64pUM.js";import{M as Ee,bh as $e,aE as De,V as Oe,U as Fe,ad as Ke,ah as j,aR as Le,ac as G,aF as Ne,aN as qe,aM as Ae,ay as Ue,bi as Ve,W as L,j as W,ak as Qe}from"./antd-DuSlDOy9.js";import"./useContentViewHeight-DsKchgvx.js";import"./useWindowSizeFn-CiLeeFbn.js";import"./onMountedOrActivated-8STL9zTa.js";import"./useForm-aNhbSFae.js";import"./FormBorder-B3cKGDVh.js";import"./index-C6GdxVlT.js";import"./sortable.esm-BEDva30o.js";import"./index-Bv_21ZiX.js";import"./useSortable-Cwu1FJTc.js";import"./download-DrMjnooB.js";import"./index-K2-6QmFf.js";import"./copyTextToClipboard-CeRVlT3D.js";const je={class:"bg-light-50 p-4 mb-4 flex"},Ge={class:"flex-1 text-right pt-2"},We={key:1,class:"bg-light-50 p-4 pb-1 flex flex-col"},He={class:"flex align-center justify-center mb-4"},Xe=["title"],Ye={class:"version"},Ze={class:"flex"},Je={class:"flex-1"},et={class:"flex mt-1"},tt=["title"],at={class:"flex mt-1"},st={class:"flex-1"},lt={key:0,class:"text-right"},ot={key:1,class:"mb-12"},it=["onClick"],nt={key:4,class:"bg-light-50 p-20"},rt={key:5,class:"bg-light-50 p-20"},ut={key:6,class:"bg-light-50 p-20"},dt=ve({name:"KgProductImportProcessComponent",__name:"process",setup(v){const[u,r]=Ee.useModal(),P=me(),{currentRoute:M}=P,k=f(0),l=f({}),y=f([]),o=f(Pe),_=f(""),B=f(0),w=f(!1),x=f(""),E=f([]),T=f({page:1,pageSize:12,activate:1}),N=f(0),H=()=>m(this,null,function*(){const t=yield Re(s(T));E.value=t.data||[],N.value=t.total||0}),[X,{reload:Y,getDataSource:Z}]=V({api:xe,columns:Me,beforeFetch:t=>F(O({},t),{pageSize:99999,taskId:l.value.id}),afterFetch:t=>(B.value=t.length,t.map(e=>(e.replaceId="",e)),t),useSearchForm:!1,showTableSetting:!0,bordered:!0,showIndexColumn:!0,immediate:!1}),[J,{reload:ee,getSelectRowKeys:te}]=V({title:"最终入库数据",api:we,columns:ze,beforeFetch:t=>F(O({},t),{taskId:l.value.id,docId:l.value.kg_doc_id}),fetchSetting:{listField:"data"},useSearchForm:!1,showTableSetting:!0,bordered:!0,showIndexColumn:!0,immediate:!1,rowKey:"id",showSelectionBar:!0,rowSelection:{type:"checkbox"}}),$=()=>m(this,null,function*(){const t=yield Ce({taskid:M.value.query.id});l.value=t||{},w.value=!1,U(()=>m(this,null,function*(){_.value="",k.value=-1,o.value.map(e=>(e.status="",e)),(t==null?void 0:t.task_status)==0&&(k.value=0,o.value[0].status="process",H()),(t==null?void 0:t.task_status)==1&&(k.value=0,o.value[0].status="process",_.value="模型生产任务执行中，请耐心等待。"),(t==null?void 0:t.task_status)==2&&(k.value=0,o.value[0].status="finish"),(t==null?void 0:t.task_status)==3&&(k.value=1,o.value[0].status="finish",o.value[1].status="process",_.value="比对任务执行中，请耐心等待。"),(t==null?void 0:t.task_status)==4&&(k.value=1,o.value[0].status="finish",o.value[1].status="finish",yield Y()),(t==null?void 0:t.task_status)==5&&(k.value=2,o.value[0].status="finish",o.value[1].status="finish",o.value[2].status="finish")}))});fe(()=>{$()});const ae=()=>m(this,null,function*(){if(!x.value){W.error("请选择模型");return}yield Se({task_id:l.value.id,model_id:x.value,force:0}),$()});let I=[];const se=()=>m(this,null,function*(){if(l.value.task_status==2&&(yield Te({task_id:l.value.id}),D()),l.value.task_status==4&&!w.value){I=[],Z().forEach(e=>{e.replaceId&&I.push(e.replaceId)}),I=Array.from(new Set(I)),w.value=!0,U(()=>m(this,null,function*(){ee()}));return}if(l.value.task_status==4&&w.value){let t=te();t=Array.from(new Set(t)),u.confirm({title:`你选择了${t.length}条数据，你确定入库吗?`,icon:K(Qe),okButtonProps:{class:"p-0 border-0 bg-transparent"},cancelButtonProps:{class:"p-0 border-0 bg-transparent"},okText:K(S,{type:"primary",class:"pl-2 pr-2"},"确认入库"),cancelText:K(S,{type:"default",class:"pl-2 pr-2"},"取消"),confirmLoading:!1,onOk:()=>m(this,null,function*(){yield Ie({task_id:l.value.id,qa_ids:t,replace_qa_ids:I}),D()}),onCancel(){}})}}),D=()=>m(this,null,function*(){yield $()}),le=()=>m(this,null,function*(){yield D(),W.success("获取最新状态成功")}),oe=t=>{const e=t.key,a=y.value.indexOf(e),h=[...y.value];a>-1?h.splice(a,1):h.push(e),y.value=h},ie=(t,e)=>m(this,null,function*(){const{id:a}=e;t.replaceId=t.replaceId===a?"":a}),ne=t=>{t.id===x.value?x.value="":x.value=t.id};return(t,e)=>(i(),g(s(ye),{title:l.value.name,content:l.value.desc},{default:d(()=>[n("div",null,[n("div",je,[c(s($e),{current:k.value,type:"navigation",class:"w-1/2",responsive:!1,items:o.value},null,8,["current","items"]),n("div",Ge,[l.value.task_status==0?(i(),g(s(S),{key:0,disabled:!x.value,type:"primary",size:"large",class:"w-32 mr-4",onClick:e[0]||(e[0]=a=>ae())},{default:d(()=>e[7]||(e[7]=[C(" 开始模型生产 ")])),_:1},8,["disabled"])):p("",!0),l.value.task_status!=5?(i(),g(s(S),{key:1,disabled:!!_.value||l.value.task_status==0||l.value.task_status==1,type:"primary",size:"large",class:"w-28",onClick:e[1]||(e[1]=a=>se())},{default:d(()=>e[8]||(e[8]=[C(" 下一步 ")])),_:1},8,["disabled"])):p("",!0)])]),_.value?(i(),g(s(De),{key:0,type:"error",class:"mb-4"},{message:d(()=>[n("div",null,[C(R(_.value)+" ",1),l.value.task_status==1||l.value.task_status==3?(i(),g(s(S),{key:0,onClick:e[2]||(e[2]=a=>le()),type:"link",size:"small",class:"ml-2"},{default:d(()=>e[9]||(e[9]=[C(" 查询最新状态 ")])),_:1})):p("",!0)])]),_:1})):p("",!0),l.value.task_status==0?(i(),b("div",We,[e[15]||(e[15]=n("div",{class:"mb-4 font-bold text-base"},"可用模型",-1)),c(s(Oe),{gutter:[16,16],class:"mb-4"},{default:d(()=>[(i(!0),b(ge,null,ke(E.value,(a,h)=>(i(),g(s(Fe),{key:h,span:6},{default:d(()=>[c(s(Ke),{hoverable:!0,class:"w-full h-48 model-card"},{default:d(()=>[n("div",He,[e[10]||(e[10]=n("img",{class:"w-8 h-8 mr-2",src:he,alt:""},null,-1)),n("div",{title:a.name,class:"flex-1 font-bold text-blue-700 text-base h-9 leading-9 truncate ..."},R(a.name),9,Xe),n("div",Ye,"版本号："+R(a.version),1)]),n("div",null,[n("div",Ze,[e[11]||(e[11]=n("div",{class:"font-bold mr-2 w-16"},"模型能力",-1)),n("div",Je,R(a.function),1)]),n("div",et,[e[12]||(e[12]=n("div",{class:"font-bold mr-2 w-16"},"模型描述",-1)),n("div",{class:"flex-1 truncate2 ...",title:a.desc},R(a.desc),9,tt)]),n("div",at,[e[14]||(e[14]=n("div",{class:"font-bold mr-2 w-16"},"启用模型",-1)),n("div",st,[c(s(j),{checked:x.value==a.id,onChange:z=>ne(a)},{checkedChildren:d(()=>e[13]||(e[13]=[C("启用")])),_:2},1032,["checked","onChange"])])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),E.value.length>0?(i(),b("div",lt,[c(s(Le),{class:"mt-4 mb-4",current:T.value.page,"onUpdate:current":e[3]||(e[3]=a=>T.value.page=a),"page-size":T.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>T.value.pageSize=a),pageSizeOptions:["12","48","100"],total:N.value,"show-total":a=>`共 ${a} 个`,showSizeChanger:"",onChange:t.handlePaginationChange},null,8,["current","page-size","total","show-total","onChange"])])):(i(),b("div",ot,[c(s(G),{image:s(G).PRESENTED_IMAGE_SIMPLE},null,8,["image"])]))])):p("",!0),l.value.task_status==3||l.value.task_status==4&&!w.value?(i(),g(s(Q),{key:2,class:"similar-table",onRegister:s(X),expandedRowKeys:y.value,"onUpdate:expandedRowKeys":e[5]||(e[5]=a=>y.value=a),striped:!1,pagination:!1,title:`相似比对结果${B.value>0?"（共 "+B.value+" 条）":""}`},{expandedRowRender:d(({record:a})=>[c(s(Ne),{dataSource:a.simqas,showIndexColumn:"",columns:s(Be),pagination:!1,bordered:"",size:"small"},{bodyCell:d(({column:h,record:z})=>[h.dataIndex=="operation"?(i(),g(s(j),{key:0,checked:a.replaceId==z.id,onChange:ct=>ie(a,z)},{checkedChildren:d(()=>[c(s(qe))]),unCheckedChildren:d(()=>[c(s(Ae))]),_:2},1032,["checked","onChange"])):p("",!0)]),_:2},1032,["dataSource","columns"])]),expandIcon:d(({record:a,expanded:h})=>[a.simqas.length>0?(i(),b("div",{key:0,class:"text-center cursor-pointer text-gray-700",onClick:_e(z=>oe(a),["stop"])},[h?p("",!0):(i(),g(s(Ue),{key:0})),h?(i(),g(s(Ve),{key:1})):p("",!0)],8,it)):p("",!0)]),_:1},8,["onRegister","expandedRowKeys","title"])):p("",!0),l.value.task_status==4&&w.value?(i(),g(s(Q),{key:3,onRegister:s(J),striped:!1},null,8,["onRegister"])):p("",!0),l.value.task_status==5?(i(),b("div",nt,[c(s(L),{status:"success",title:"生产完成",subTitle:"任务已完成，请前往查看结果。"},{extra:d(()=>[c(s(S),{onClick:e[6]||(e[6]=a=>s(P).push("/kg-product/auto"))},{default:d(()=>e[16]||(e[16]=[C("返回任务列表")])),_:1})]),_:1})])):p("",!0),l.value.task_status==1?(i(),b("div",rt,[c(s(L),{status:"info",title:"模型生产任务执行中...",subTitle:"模型生产任务执行中，请耐心等待。"})])):p("",!0),l.value.task_status==2?(i(),b("div",ut,[c(s(L),{status:"success",title:"模型生产任务执行完成",subTitle:"模型生产任务执行完成，请执行下一步操作。"})])):p("",!0)]),c(s(r))]),_:1},8,["title","content"]))}}),Ot=be(dt,[["__scopeId","data-v-1874316e"]]);export{Ot as default};
