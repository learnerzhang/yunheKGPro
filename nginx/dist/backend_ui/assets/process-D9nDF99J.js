var Y=Object.defineProperty,Z=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var E=(c,i,u)=>i in c?Y(c,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):c[i]=u,I=(c,i)=>{for(var u in i||(i={}))J.call(i,u)&&E(c,u,i[u]);if(D)for(var u of D(i))Q.call(i,u)&&E(c,u,i[u]);return c},z=(c,i)=>Z(c,H(i));var _=(c,i,u)=>new Promise((g,e)=>{var r=d=>{try{v(u.next(d))}catch(y){e(y)}},h=d=>{try{v(u.throw(d))}catch(y){e(y)}},v=d=>d.done?g(d.value):Promise.resolve(d.value).then(r,h);v((u=u.apply(c,i)).next())});import{_ as tt}from"./model-title-bg-Bo7fDO4t.js";import{P as et}from"./index-C7IcOeO2.js";import{an as T,X as st}from"./entry/index-B-McypeI-1739345778478.js";import{u as F,_ as $}from"./useTable-BldcMn6n.js";import"./TableImg.vue_vue_type_style_index_0_lang-2oS39uGR.js";import"./BasicForm.vue_vue_type_style_index_0_lang-qpF-DMKT.js";import{j as at,k as lt,f as ot,l as it,m as ut}from"./task-BVRZM_E3.js";import{g as rt}from"./model-DTGFrej-.js";import{i as nt,d as dt,a as ct}from"./fulltext.data-DFqo9yUk.js";import{d as vt,Y as pt,f as k,o as mt,Z as n,a4 as b,a5 as p,$ as l,k as m,u as a,G as x,a8 as f,a3 as S,_ as w,F as ft,a7 as gt,y as kt}from"./vue-7EN2lk9e.js";import{bh as _t,aE as bt,V as ht,U as yt,ad as wt,ah as xt,aR as St,ac as L,W as R,j as N}from"./antd-DuSlDOy9.js";import"./useContentViewHeight-B3Yt78Z4.js";import"./useWindowSizeFn-B30U4ulB.js";import"./onMountedOrActivated-8STL9zTa.js";import"./useForm-Hn6EoxrV.js";import"./FormBorder-BUeDstEP.js";import"./index-dXxTZxnK.js";import"./sortable.esm-BEDva30o.js";import"./index-BlCAdtVI.js";import"./useSortable-BZ0xEDrO.js";import"./download-CCBYjG8C.js";import"./index-Czo0YvQK.js";import"./copyTextToClipboard-CeRVlT3D.js";const Ct={class:"bg-light-50 p-4 mb-4 flex"},Tt={class:"flex-1 text-right pt-2"},Pt={key:2,class:"bg-light-50 p-4 pb-1 flex flex-col"},It={class:"flex align-center justify-center mb-4"},zt=["title"],Rt={class:"version"},Mt={class:"flex"},Bt={class:"flex-1"},Dt={class:"flex mt-1"},Et=["title"],Ft={class:"flex mt-1"},$t={class:"flex-1"},Lt={key:0,class:"text-right"},Nt={key:1,class:"mb-12"},Vt={key:4,class:"bg-light-50 p-20"},Ut={key:5,class:"bg-light-50 p-20"},jt={key:6,class:"bg-light-50 p-20"},Ot=vt({name:"KgProductImportProcessComponent",__name:"process",setup(c){const i=pt(),{currentRoute:u}=i,g=k(0),e=k({}),r=k(nt),h=k(""),v=k(""),d=k(!1),y=k([]),C=k({page:1,pageSize:12,activate:1}),M=k(0),V=()=>_(this,null,function*(){const s=yield rt(a(C));y.value=s.data||[],M.value=s.total||0}),[U,{reload:j}]=F({title:"关联数据列表",api:at,columns:dt,beforeFetch:s=>z(I({},s),{pageSize:99999,taskid:e.value.id}),fetchSetting:{listField:"data"},useSearchForm:!1,showTableSetting:!0,bordered:!0,showIndexColumn:!0,immediate:!1}),[O,{reload:q}]=F({title:"最终入库数据",api:lt,columns:ct,beforeFetch:s=>z(I({},s),{taskId:e.value.id}),fetchSetting:{listField:"data"},useSearchForm:!1,showTableSetting:!0,bordered:!0,showIndexColumn:!0,immediate:!1,rowKey:"id"}),P=()=>_(this,null,function*(){const s=yield ot({taskid:u.value.query.id});e.value=s||{},kt(()=>_(this,null,function*(){h.value="",g.value=-1,r.value.map(t=>(t.status="",t)),(s==null?void 0:s.task_status)==0&&(g.value=0,r.value[0].status="process",j()),(s==null?void 0:s.task_status)==1&&(g.value=1,r.value[0].status="finish",r.value[1].status="process",h.value="模型生产任务执行中，请耐心等待。"),(s==null?void 0:s.task_status)==4&&(g.value=2,r.value[0].status="finish",r.value[1].status="finish",r.value[2].status="process",yield q()),(s==null?void 0:s.task_status)==5&&(g.value=2,r.value[0].status="finish",r.value[1].status="finish",r.value[2].status="finish")}))});mt(()=>{P()});const A=()=>_(this,null,function*(){if(!v.value){N.error("请选择模型");return}yield it({task_id:e.value.id,model_id:v.value,force:0}),P()}),G=()=>_(this,null,function*(){e.value.task_status==0&&!d.value&&(d.value=!0,g.value=1,r.value[0].status="finish",r.value[1].status="process",yield V()),e.value.task_status==4&&(yield ut({task_id:e.value.id}),B())}),B=()=>_(this,null,function*(){yield P()}),K=()=>_(this,null,function*(){yield B(),N.success("获取最新状态成功")}),W=s=>{s.id===v.value?v.value="":v.value=s.id};return(s,t)=>(n(),b(a(et),{title:e.value.name,content:e.value.desc},{default:p(()=>[l("div",null,[l("div",Ct,[m(a(_t),{current:g.value,type:"navigation",class:"w-1/2",responsive:!1,items:r.value},null,8,["current","items"]),l("div",Tt,[e.value.task_status==0&&d.value?(n(),b(a(T),{key:0,disabled:!v.value,type:"primary",size:"large",class:"w-32 mr-4",onClick:t[0]||(t[0]=o=>A())},{default:p(()=>t[6]||(t[6]=[x(" 开始模型生产 ")])),_:1},8,["disabled"])):f("",!0),e.value.task_status!=5?(n(),b(a(T),{key:1,disabled:!!h.value||e.value.task_status==1||e.value.task_status==0&&d.value,type:"primary",size:"large",class:"w-28",onClick:t[1]||(t[1]=o=>G())},{default:p(()=>[x(S(e.value.task_status==4?"确认入库":"下一步"),1)]),_:1},8,["disabled"])):f("",!0)])]),h.value?(n(),b(a(bt),{key:0,type:"error",class:"mb-4"},{message:p(()=>[l("div",null,[x(S(h.value)+" ",1),e.value.task_status==1||e.value.task_status==3?(n(),b(a(T),{key:0,onClick:t[2]||(t[2]=o=>K()),type:"link",size:"small",class:"ml-2"},{default:p(()=>t[7]||(t[7]=[x(" 查询最新状态 ")])),_:1})):f("",!0)])]),_:1})):f("",!0),e.value.task_status==0&&!d.value?(n(),b(a($),{key:1,onRegister:a(U),striped:!1},null,8,["onRegister"])):f("",!0),e.value.task_status==0&&d.value?(n(),w("div",Pt,[t[13]||(t[13]=l("div",{class:"mb-4 font-bold text-base"},"可用模型",-1)),m(a(ht),{gutter:[16,16],class:"mb-4"},{default:p(()=>[(n(!0),w(ft,null,gt(y.value,(o,X)=>(n(),b(a(yt),{key:X,span:6},{default:p(()=>[m(a(wt),{hoverable:!0,class:"w-full h-48 model-card"},{default:p(()=>[l("div",It,[t[8]||(t[8]=l("img",{class:"w-8 h-8 mr-2",src:tt,alt:""},null,-1)),l("div",{title:o.name,class:"flex-1 font-bold text-blue-700 text-base h-9 leading-9 truncate ..."},S(o.name),9,zt),l("div",Rt,"版本号："+S(o.version),1)]),l("div",null,[l("div",Mt,[t[9]||(t[9]=l("div",{class:"font-bold mr-2 w-16"},"模型能力",-1)),l("div",Bt,S(o.function),1)]),l("div",Dt,[t[10]||(t[10]=l("div",{class:"font-bold mr-2 w-16"},"模型描述",-1)),l("div",{class:"flex-1 truncate2 ...",title:o.desc},S(o.desc),9,Et)]),l("div",Ft,[t[12]||(t[12]=l("div",{class:"font-bold mr-2 w-16"},"启用模型",-1)),l("div",$t,[m(a(xt),{checked:v.value==o.id,onChange:qt=>W(o)},{checkedChildren:p(()=>t[11]||(t[11]=[x("启用")])),_:2},1032,["checked","onChange"])])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),y.value.length>0?(n(),w("div",Lt,[m(a(St),{class:"mt-4 mb-4",current:C.value.page,"onUpdate:current":t[3]||(t[3]=o=>C.value.page=o),"page-size":C.value.pageSize,"onUpdate:pageSize":t[4]||(t[4]=o=>C.value.pageSize=o),pageSizeOptions:["12","48","100"],total:M.value,"show-total":o=>`共 ${o} 个`,showSizeChanger:"",onChange:s.handlePaginationChange},null,8,["current","page-size","total","show-total","onChange"])])):(n(),w("div",Nt,[m(a(L),{image:a(L).PRESENTED_IMAGE_SIMPLE},null,8,["image"])]))])):f("",!0),e.value.task_status==4?(n(),b(a($),{key:3,onRegister:a(O),striped:!1},null,8,["onRegister"])):f("",!0),e.value.task_status==5?(n(),w("div",Vt,[m(a(R),{status:"success",title:"生产完成",subTitle:"任务已完成，请前往查看结果。"},{extra:p(()=>[m(a(T),{onClick:t[5]||(t[5]=o=>a(i).push("/kg-product/fulltext"))},{default:p(()=>t[14]||(t[14]=[x("返回任务列表")])),_:1})]),_:1})])):f("",!0),e.value.task_status==1?(n(),w("div",Ut,[m(a(R),{status:"info",title:"模型生产任务执行中...",subTitle:"模型生产任务执行中，请耐心等待。"})])):f("",!0),e.value.task_status==2?(n(),w("div",jt,[m(a(R),{status:"success",title:"模型生产任务执行完成",subTitle:"模型生产任务执行完成，请执行下一步操作。"})])):f("",!0)])]),_:1},8,["title","content"]))}}),me=st(Ot,[["__scopeId","data-v-059d1940"]]);export{me as default};
