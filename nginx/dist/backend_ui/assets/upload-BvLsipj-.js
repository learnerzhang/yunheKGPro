var y=(N,w,p)=>new Promise((k,L)=>{var b=r=>{try{n(p.next(r))}catch(h){L(h)}},U=r=>{try{n(p.throw(r))}catch(h){L(h)}},n=r=>r.done?k(r.value):Promise.resolve(r.value).then(b,U);n((p=p.apply(N,w)).next())});import{n as M,o as Q,p as X,q as Y,j as Z}from"./temp-BXVrim_O.js";import{P as J}from"./index-C7IcOeO2.js";import{c as K,ah as ee,an as R,X as te}from"./entry/index-B-McypeI-1739345778478.js";import{F as c}from"./FormBorder-BUeDstEP.js";import{d as le,f as I,Y as ae,u as e,o as se,Z as _,a4 as D,a5 as s,$ as d,k as l,a3 as F,_ as C,F as ne,a7 as oe,a8 as B,G as j}from"./vue-7EN2lk9e.js";import{ae as de,af as f,ao as P,an as ie,a9 as S,V as H,U as x,A as T,Q as re,ag as ue,aq as fe,ar as me,j as v}from"./antd-DuSlDOy9.js";import"./useContentViewHeight-B3Yt78Z4.js";import"./useWindowSizeFn-B30U4ulB.js";import"./onMountedOrActivated-8STL9zTa.js";const pe={class:"bg-light-50 p-12 pl-20 pr-20 flex-1"},ce={class:"flex"},_e={class:"flex"},ve={class:"flex"},ge={class:"flex-1"},xe={class:"flex -mt-6"},be={class:"flex-1"},he={class:"flex items-center justify-between p-2 bg-gray-100"},ye={key:0,src:"#",class:"h-6 mr-2",alt:""},we={key:1,src:"#",class:"h-6 mr-2",alt:""},ke={key:2,src:"#",class:"h-6 mr-2",alt:""},Le={class:"flex-1 text-gray-900"},Ue=["onClick"],Ce={class:"text-right"},O=1,Be=le({name:"TempUploadComponent",__name:"upload",setup(N){const w=K(),p=ee(),k=I([]),{currentRoute:L}=ae(),b=e(L),U=I([]);let n=I({fileList:[],cid:b.query.cid||void 0,user_id:p.getUserInfo.userId,user_name:p.getUserInfo.realName,version:"V1.0",name:"",bus_id:"",desc:""});const r=o=>{if(n.value.fileList.length+1>O)return v.error({key:"upload-limit",content:`最多上传 ${O} 个文件`}),!1;const a=[...n.value.fileList,o];return n.value.fileList=a,!1},h=o=>{n.value.fileList.splice(o,1)},$=()=>{w("/temp-manage/page")},A=()=>y(this,null,function*(){const{cid:o,name:t,bus_id:a,user_id:u,version:i,desc:g,fileList:m,temp_id:q}=n.value;if(!o){v.error("请选择保存路径");return}if(!t){v.error("请输入模板名称");return}if(!a){v.error("请选择业务类型");return}if(!i){v.error("请输入版本号");return}if(!g){v.error("请输入模板描述");return}if(m.length===0){v.error("请选择文件");return}if(q){const E=m[0];yield M({file:E.id?void 0:m[0],cid:o,user_id:u,version:i,name:t,bus_id:a,desc:g,temp_id:q})}else yield Q({file:m[0],cid:o,user_id:u,version:i,name:t,bus_id:a,desc:g});w("/temp-manage/page")}),G=()=>y(this,null,function*(){const o=(yield X())||{};U.value=(o==null?void 0:o.map(t=>({label:t.name,value:t.id})))||[]}),W=()=>y(this,null,function*(){const{id:o}=b.query,t=(yield Y({tmpid:o}))||{};n.value={fileList:t.filepath?[{name:t.name+"."+t.filepath.substring(t.filepath.lastIndexOf(".")+1),filepath:t.filepath,id:"1"}]:[],cid:t.kg_cct_id,user_id:t.kg_user_id,user_name:t.kg_user,version:t.version,name:t.name,bus_id:t.kg_business_id,desc:t.desc,temp_id:t.id}}),z=()=>y(this,null,function*(){const o=(yield Z())||{};k.value=V((o==null?void 0:o.tabctt)||[],null)}),V=(o,t)=>{const a=[];for(let u=0;u<o.length;u++){const i=o[u],{name:g,children:m}=i;i.id=String(i.id),i.ids=t?[...t.ids,i.id]:[i.id],i.names=t?[...t.names,g]:[g],i.fullName=i.names.join("/"),m&&m.length>0&&(i.children=V(m,i)),a.push(i)}return a};return se(()=>{z(),G(),b.query.id&&W()}),(o,t)=>(_(),D(e(J),{dense:"",contentFullHeight:"",contentClass:"flex p-4"},{default:s(()=>[d("div",pe,[l(e(de),{layout:"vertical"},{default:s(()=>[l(e(f),null,{default:s(()=>[d("div",ce,[t[6]||(t[6]=d("div",{class:"w-1/6 font-bold text-lg label-name"},"保存路径",-1)),l(e(c),null,{default:s(()=>[l(e(P),{class:"!w-80",value:e(n).cid,"onUpdate:value":t[0]||(t[0]=a=>e(n).cid=a),showCheckedStrategy:e(P).SHOW_ALL,"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择保存路径","tree-default-expand-all":"","tree-data":k.value,"field-names":{label:"name",value:"id"}},{title:s(({name:a})=>[l(e(ie),{class:"mr-2"}),d("span",null,F(a),1)]),_:1},8,["value","showCheckedStrategy","tree-data"])]),_:1})]),t[7]||(t[7]=d("div",null,null,-1))]),_:1}),l(e(S),{class:"mt-10 mb-10"}),l(e(f),null,{default:s(()=>[d("div",_e,[t[8]||(t[8]=d("div",{class:"w-1/6 font-bold text-lg label-name"},"模板信息",-1)),l(e(H),{gutter:20},{default:s(()=>[l(e(x),{span:6},{default:s(()=>[l(e(f),{label:"模板名称"},{default:s(()=>[l(e(c),null,{default:s(()=>[l(e(T),{value:e(n).name,"onUpdate:value":t[1]||(t[1]=a=>e(n).name=a),placeholder:"请输入模板名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(e(x),{span:6},{default:s(()=>[l(e(f),{label:"业务类型"},{default:s(()=>[l(e(c),null,{default:s(()=>[l(e(re),{value:e(n).bus_id,"onUpdate:value":t[2]||(t[2]=a=>e(n).bus_id=a),options:U.value,placeholder:"请选择业务类型"},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),l(e(x),{span:6},{default:s(()=>[l(e(f),{label:"版本号"},{default:s(()=>[l(e(c),null,{default:s(()=>[l(e(T),{value:e(n).version,"onUpdate:value":t[3]||(t[3]=a=>e(n).version=a),placeholder:"请输入版本号"},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(e(x),{span:6},{default:s(()=>[l(e(f),{label:"创建人"},{default:s(()=>[l(e(c),null,{default:s(()=>[l(e(T),{value:e(n).user_name,"onUpdate:value":t[4]||(t[4]=a=>e(n).user_name=a),disabled:"",placeholder:"请输入创建人"},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(e(x),{span:24},{default:s(()=>[l(e(f),{label:"模板描述"},{default:s(()=>[l(e(c),null,{default:s(()=>[l(e(ue),{value:e(n).desc,"onUpdate:value":t[5]||(t[5]=a=>e(n).desc=a),"auto-size":{minRows:3,maxRows:5},placeholder:"请输入模板描述"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),l(e(S),{class:"mt-10 mb-10"}),l(e(f),null,{default:s(()=>[d("div",ve,[t[10]||(t[10]=d("div",{class:"w-1/6 font-bold text-lg label-name"},"文件上传",-1)),d("div",ge,[l(e(c),null,{default:s(()=>[l(e(fe),{multiple:"",name:"file",beforeUpload:r,accept:".doc,.docx,.pdf,.xls,.xlsx",maxCount:10,showUploadList:!1},{default:s(()=>[t[9]||(t[9]=d("p",{class:"ant-upload-text pt-6 pb-6"},"点击上传文档或将文档拖拽到此处",-1)),d("p",{class:"ant-upload-hint"}," 最多上传 "+F(O)+" 个文件，仅支持.doc、.docx、.pdf、.xls、.xlsx格式的文件 ")]),_:1})]),_:1})])])]),_:1}),e(n).fileList.length>0?(_(),D(e(f),{key:0},{default:s(()=>[d("div",xe,[t[11]||(t[11]=d("div",{class:"w-1/6 font-bold text-lg"},null,-1)),d("div",be,[l(e(H),{gutter:[15,15],class:"mt-4"},{default:s(()=>[(_(!0),C(ne,null,oe(e(n).fileList,(a,u)=>(_(),D(e(x),{key:u,span:8},{default:s(()=>[d("div",he,[["doc","docx"].includes(a.name.substring(a.name.lastIndexOf(".")+1))?(_(),C("img",ye)):B("",!0),["pdf"].includes(a.name.substring(a.name.lastIndexOf(".")+1))?(_(),C("img",we)):B("",!0),["xls","xlsx"].includes(a.name.substring(a.name.lastIndexOf(".")+1))?(_(),C("img",ke)):B("",!0),d("div",Le,F(a.name),1),d("div",{class:"text-gray-500 hover:text-red-500 cursor-pointer",title:"删除",onClick:i=>h(u)},[l(e(me))],8,Ue)])]),_:2},1024))),128))]),_:1})])])]),_:1})):B("",!0)]),_:1}),l(e(S),{class:"mt-10 mb-10"}),d("div",Ce,[l(e(R),{type:"default",class:"mr-4 w-30",onClick:$},{default:s(()=>t[12]||(t[12]=[j("取消")])),_:1}),l(e(R),{type:"primary",class:"w-30",onClick:A},{default:s(()=>t[13]||(t[13]=[j("确认上传")])),_:1})])])]),_:1}))}}),je=te(Be,[["__scopeId","data-v-d0740085"]]);export{je as default};
