var Q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var R=(f,r,i)=>r in f?Q(f,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[r]=i,V=(f,r)=>{for(var i in r||(r={}))Z.call(r,i)&&R(f,i,r[i]);if(T)for(var i of T(r))J.call(r,i)&&R(f,i,r[i]);return f},j=(f,r)=>X(f,Y(r));var h=(f,r,i)=>new Promise((_,b)=>{var L=l=>{try{m(i.next(l))}catch(v){b(v)}},C=l=>{try{m(i.throw(l))}catch(v){b(v)}},m=l=>l.done?_(l.value):Promise.resolve(l.value).then(L,C);m((i=i.apply(f,r)).next())});import{f as K,a as ee}from"./file-ahny2sb3.js";import{g as te}from"./tag-t-ySJcDI.js";import{P as le}from"./index-Fa5FDUAc.js";import{c as se,ah as ae,an as P,X as oe}from"./entry/index-gwXb_KLU-1735894345864.js";import{F}from"./FormBorder-B3cKGDVh.js";import{d as ne,f as U,Y as $,u as t,o as ie,Z as c,a4 as O,a5 as d,$ as a,k as o,a3 as S,_ as w,F as de,a7 as re,a8 as y,G}from"./vue-7EN2lk9e.js";import{ae as ue,af as g,ao as H,an as fe,a9 as x,ap as ce,Q as me,am as pe,aq as ge,V as ve,U as xe,ar as _e,j as B}from"./antd-DuSlDOy9.js";import"./useContentViewHeight-DsKchgvx.js";import"./useWindowSizeFn-CiLeeFbn.js";import"./onMountedOrActivated-8STL9zTa.js";const be={class:"bg-light-50 p-12 pl-20 pr-20 flex-1"},he={class:"flex"},we={class:"flex"},ye={class:"flex"},Le={class:"flex-1"},Ce={class:"flex"},ke={class:"flex"},Fe={class:"flex-1"},Ue={class:"flex -mt-6"},Oe={class:"flex-1"},Se={class:"flex items-center justify-between p-2 bg-gray-100"},Be={key:0,src:"#",class:"h-6 mr-2",alt:""},De={key:1,src:"#",class:"h-6 mr-2",alt:""},Ie={key:2,src:"#",class:"h-6 mr-2",alt:""},Ne={class:"flex-1 text-gray-900"},Te=["onClick"],Re={class:"text-right"},D=10,Ve=ne({name:"FileUploadComponent",__name:"upload",setup(f){const r=se(),i=ae(),_=U([]),b=$(),{currentRoute:L}=$(),C=t(L),m=U([]);let l=U({fileList:[],tagids:[],cid:C.query.cid||void 0,user_id:i.getUserInfo.userId,dflag:0,star:0});const v=n=>{if(l.value.fileList.length+1>D)return B.error({key:"upload-limit",content:`最多上传 ${D} 个文件`}),!1;const s=[...l.value.fileList,n];return l.value.fileList=s,!1},q=n=>{l.value.fileList.splice(n,1)},z=()=>{r("/file-manage/page")},A=()=>h(this,null,function*(){if(!l.value.cid){B.error("请选择保存路径");return}if(l.value.fileList.length===0){B.error("请选择文件");return}let n={};for(let e=0;e<l.value.fileList.length;e++){const s=l.value.fileList[e];n[`file${e}`]=s}yield K(j(V({},n),{filenum:l.value.fileList.length,cid:l.value.cid,dflag:l.value.dflag,user_id:l.value.user_id,tagids:l.value.tagids.join(","),star:l.value.star})),b.push("/file-manage/page")}),W=()=>h(this,null,function*(){const n=(yield ee())||{};_.value=I((n==null?void 0:n.tabctt)||[],null)}),E=()=>h(this,null,function*(){const n=(yield te({pageSize:1e4}))||{};m.value=n.data||[]}),M=(n,e)=>e?e.name.toLowerCase().indexOf(n.toLowerCase())>=0:!0,I=(n,e)=>{const s=[];for(let p=0;p<n.length;p++){const u=n[p],{name:N,children:k}=u;u.id=String(u.id),u.ids=e?[...e.ids,u.id]:[u.id],u.names=e?[...e.names,N]:[N],u.fullName=u.names.join("/"),k&&k.length>0&&(u.children=I(k,u)),s.push(u)}return s};return ie(()=>{W(),E()}),(n,e)=>(c(),O(t(le),{dense:"",contentFullHeight:"",contentClass:"flex p-4"},{default:d(()=>[a("div",be,[o(t(ue),null,{default:d(()=>[o(t(g),null,{default:d(()=>[a("div",he,[e[4]||(e[4]=a("div",{class:"w-1/6 font-bold text-lg label-name"},"所属目录",-1)),o(t(F),null,{default:d(()=>[o(t(H),{class:"!w-80",value:t(l).cid,"onUpdate:value":e[0]||(e[0]=s=>t(l).cid=s),showCheckedStrategy:t(H).SHOW_ALL,"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择所属目录","tree-default-expand-all":"","tree-data":_.value,"field-names":{label:"name",value:"id"}},{title:d(({name:s})=>[o(t(fe),{class:"mr-2"}),a("span",null,S(s),1)]),_:1},8,["value","showCheckedStrategy","tree-data"])]),_:1})]),e[5]||(e[5]=a("div",null,null,-1))]),_:1}),o(t(x),{class:"mt-10 mb-10"}),o(t(g),null,{default:d(()=>[a("div",we,[e[6]||(e[6]=a("div",{class:"w-1/6 font-bold text-lg label-name"},"同名文档处理方式",-1)),o(t(ce),{value:t(l).dflag,"onUpdate:value":e[1]||(e[1]=s=>t(l).dflag=s),options:[{label:"覆盖该目录下已有同名文档",value:0}]},null,8,["value"])])]),_:1}),o(t(x),{class:"mt-10 mb-10"}),o(t(g),null,{default:d(()=>[a("div",ye,[e[7]||(e[7]=a("div",{class:"w-1/6 font-bold text-lg label-name"},"文档标签",-1)),a("div",Le,[o(t(F),null,{default:d(()=>[o(t(me),{value:t(l).tagids,"onUpdate:value":e[2]||(e[2]=s=>t(l).tagids=s),mode:"multiple",options:m.value,fieldNames:{label:"name",value:"id"},filterOption:M,allowClear:"",showArrow:""},null,8,["value","options"])]),_:1})])])]),_:1}),o(t(x),{class:"mt-10 mb-10"}),o(t(g),null,{default:d(()=>[a("div",Ce,[e[8]||(e[8]=a("div",{class:"w-1/6 font-bold text-lg label-name"},"推荐指数",-1)),o(t(pe),{value:t(l).star,"onUpdate:value":e[3]||(e[3]=s=>t(l).star=s),size:"large"},null,8,["value"])])]),_:1}),o(t(x),{class:"mt-10 mb-10"}),o(t(g),null,{default:d(()=>[a("div",ke,[e[10]||(e[10]=a("div",{class:"w-1/6 font-bold text-lg label-name"},"文件上传",-1)),a("div",Fe,[o(t(F),null,{default:d(()=>[o(t(ge),{multiple:"",name:"file",beforeUpload:v,accept:".doc,.docx,.pdf,.xls,.xlsx,.txt,.csv",maxCount:10,showUploadList:!1},{default:d(()=>[e[9]||(e[9]=a("p",{class:"ant-upload-text pt-6 pb-6"},"点击上传文档或将文档拖拽到此处",-1)),a("p",{class:"ant-upload-hint"}," 最多上传 "+S(D)+" 个文件，仅支持.doc、.docx、.pdf、.xls、.xlsx、.txt、.csv格式的文件 ")]),_:1})]),_:1})])])]),_:1}),t(l).fileList.length>0?(c(),O(t(g),{key:0},{default:d(()=>[a("div",Ue,[e[11]||(e[11]=a("div",{class:"w-1/6 font-bold text-lg"},null,-1)),a("div",Oe,[o(t(ve),{gutter:[15,15],class:"mt-4"},{default:d(()=>[(c(!0),w(de,null,re(t(l).fileList,(s,p)=>(c(),O(t(xe),{key:p,span:8},{default:d(()=>[a("div",Se,[["doc","docx"].includes(s.name.substring(s.name.lastIndexOf(".")+1))?(c(),w("img",Be)):y("",!0),["pdf"].includes(s.name.substring(s.name.lastIndexOf(".")+1))?(c(),w("img",De)):y("",!0),["xls","xlsx"].includes(s.name.substring(s.name.lastIndexOf(".")+1))?(c(),w("img",Ie)):y("",!0),a("div",Ne,S(s.name),1),a("div",{class:"text-gray-500 hover:text-red-500 cursor-pointer",title:"删除",onClick:u=>q(p)},[o(t(_e))],8,Te)])]),_:2},1024))),128))]),_:1})])])]),_:1})):y("",!0)]),_:1}),o(t(x),{class:"mt-10 mb-10"}),a("div",Re,[o(t(P),{type:"default",class:"mr-4 w-30",onClick:z},{default:d(()=>e[12]||(e[12]=[G("取消")])),_:1}),o(t(P),{type:"primary",class:"w-30",onClick:A},{default:d(()=>e[13]||(e[13]=[G("确认上传")])),_:1})])])]),_:1}))}}),Qe=oe(Ve,[["__scopeId","data-v-524f8f80"]]);export{Qe as default};
