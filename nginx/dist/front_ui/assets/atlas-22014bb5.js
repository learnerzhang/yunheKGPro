import{i as E}from"./index-20c3ceee.js";import{r as p}from"./index-37139fa3.js";import{_ as v,b as g,c as d,d as c,e as r,f as m,n as b,p as S,t as h,g as L,l as u,F as y,h as w}from"./index-e43f0123.js";import"./tslib.es6-7c8db84e.js";const x=async t=>await p.getData({url:"kgapp/graphExpand",params:t}),_=async t=>await p.getData({url:"kgapp/graph",params:t}),I=async t=>await p.get({url:"kgapp/graphEntity/detailByNameType",params:t}),k=async t=>await p.getData({url:"kgapp/graphEntityScheme",params:t}),z=""+new URL("tit-4415a57d.png",import.meta.url).href;const F={data(){return{atlasChart:null,EchartsData:{nodes:[],links:[],categories:[]},showNode:[],windowsSizeTimer:null,nowNodeInfo:null,nodeDetailsShow:!1,nodeDetailsData:null,searchList:null,searchQuery:"",showList:!1,taskKeyId:277}},computed:{filteredItems(){if(!this.searchQuery)return this.searchList;const t=this.searchQuery.toLowerCase();return this.showList=!0,this.searchList.filter(e=>e.name.toLowerCase().includes(t))}},watch:{nodeDetailsShow(){this.$nextTick(()=>{setTimeout(()=>{this.atlasChart.resize()},100)})}},mounted(){this.nodesHandle("乌海市取水许可知识图谱"),this.getGraphEntityScheme(),this.EchartsInit(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{handleSelect(t){console.log(t,"itemitme"),this.changeGraph(t.name)},querySearch(t,e){var s=this.searchList,i=t?s.filter(this.createFilter(t)):s;e(i)},createFilter(t){return e=>e.value.toLowerCase().indexOf(t.toLowerCase())===0},getGraphEntityScheme(){const t={page:1,pageSize:1e3,taskId:this.taskKeyId};k(t).then(e=>{this.searchList=e.data,this.searchList.map(s=>{s.value=s.name})})},handleResize(){this.windowsSizeTimer&&clearTimeout(this.windowsSizeTimer),this.windowsSizeTimer=setTimeout(()=>{this.atlasChart.resize()},300)},changeGraph(t){const e=this.atlasChart.getOption();let s=e.series[0].nodes.map(o=>o.category);console.log(s.includes(t),"datadata");let i=null;if(s.includes(t))i=e.series[0].nodes.map(o=>o.category===t?{...o,itemStyle:{}}:{...o,itemStyle:{opacity:.2}});else return;const a={...e,series:[{...e.series[0],nodes:i}]};this.atlasChart.setOption(a)},EchartsInit(){function t(s){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function e(s,i){if(console.log(s,"colorclorcloroo"),s.startsWith("#")){var a=t(s);return`rgba(${a.r}, ${a.g}, ${a.b}, ${i})`}else if(s.startsWith("rgb(")){var o=s.match(/\d+/g);return`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${i})`}else return s}this.atlasChart=E(this.$refs.atlasChart),this.atlasChart.setOption({series:[{type:"graph",roam:!0,scaleLimit:{min:.6},animation:!1,animationDuration:0,draggable:!0,layout:"force",force:{repulsion:1e3,edgeLength:200,friction:.3},itemStyle:{borderColor:"transparent",borderWidth:1},label:{fontSize:12,color:"#000",fontFamily:"PingFang SC",normal:{show:!0,formatter:function(s){return s.data.name.length>4?s.data.name.substr(0,4)+"...":s.data.name}},emphasis:{show:!0,formatter:"{b}",overflow:"break",lineHeight:15,itemStyle:{borderColor:function(s){var i=s.color;return console.log(i,"colrorcoelo"),e(i,.5)},borderWidth:10}}},edgeLabel:{show:!0,fontSize:12,fontWeight:900,lineHeight:15,fontFamily:"PingFang SC",color:"#adadadeb",formatter:s=>s.value},lineStyle:{opacity:1,width:2,color:"#adadadeb"},edgeSymbol:["none","arrow"],edgeSymbolSize:8,nodes:[],links:[]}]}),this.atlasChart.on("click",s=>{event.stopPropagation(),s.dataType=="node"&&(this.nowNodeInfo={type:s.data.category,name:s.data.name,id:s.data.nodeid,x:s.event.offsetX,y:s.event.offsetY})}),this.atlasChart.getZr().on("click",s=>{if(event.stopPropagation(),!s.target){this.nowNodeInfo=null,this.searchQuery="";const i=this.atlasChart.getOption(),a=i.series[0].nodes.map(n=>({...n,itemStyle:{opacity:1}})),o={...i,series:[{...i.series[0],nodes:a}]};this.atlasChart.setOption(o)}})},dataItemStyle(t,e,s){return{color:{type:"radial",x:.5,y:.5,r:.4,globalCoord:!1,colorStops:[{offset:0,color:t},{offset:1,color:e}]},borderColor:s,borderWidth:6,borderType:"solid"}},indexColorGET(t,e){let s=[["#EA8C82","#E46A5E","#D3C8DA"],["#E2B0AA","#EA9E8C","#D4D4E4"],["#EACD92","#F3C263","#D9DCDC"],["#AECCD7","#A4C6CB","#C2D7EF"],["#C48ABB","#C46FA5","#C9C7E9"],["#E3CFCD","#EDCABE","#CDD7EF"],["#B7D8F7","#B2D7F5","#D0E3FB"],["#A8DEE8","#9CDCE2","#BFDCF6"]],i=[{level:0,size:110},{level:1,size:70}],a=e>1?["#8CC5FF","#66B1FF","#B3D8FF"]:s[t],o=e>1?76:i.filter(n=>n.level==e)[0].size;return{color:a,size:o}},update(){this.EchartsData.nodes.forEach((e,s)=>{let i=this.indexColorGET(s,e.level);e.symbolSize=i.size,e.label={width:i.size-10}});let t=this.atlasChart.getOption();t.series[0].nodes=this.EchartsData.nodes,t.series[0].links=this.EchartsData.links,t.series[0].categories=this.EchartsData.categories,this.atlasChart.setOption(t)},sonNodesGET(t,e){let s=[];return t.forEach(i=>{i.source==e&&(s.push(i.target),s=s.concat(this.sonNodesGET(t,i.target)))}),s},nodesHandle(t,e){this.showNode.findIndex(s=>s==t),this.nodesGET(t,e)},nodesGET(t,e){if(console.log(e,"extend"),this.$refs.Load.showLoad(!0,"获取数据..."),e){let i={name:e.name,type:e.type,taskId:this.taskKeyId};x(i).then(a=>{this.EchartsData.categories=a.categories,this.$refs.Load.showLoad(!1),a.nodes.length>0?this.showNode.push(t):this.$refs.Hint.showHint(t+"没有其他子节点了"),a.nodes.forEach(o=>{t=="乌海市取水许可知识图谱"?o.level=1:o.level=this.EchartsData.nodes.filter(n=>n.name==t)[0].level+1,o.name=="乌海市取水许可知识图谱"&&(o.level=0),this.EchartsData.nodes.some(n=>n.name===o.name)||this.EchartsData.nodes.push(o)}),a.links.forEach(o=>{this.EchartsData.links.some(n=>n.target===o.target)||this.EchartsData.links.push(o),a.nodes.forEach(function(n){o.target==n.nodeid&&(o.target=n.name),o.source==n.nodeid&&(o.source=n.name)})}),this.update()});return}const s={taskId:this.taskKeyId,total:1e3};_(s).then(i=>{this.EchartsData.categories=i.categories,this.$refs.Load.showLoad(!1),i.nodes.length>0?this.showNode.push(t):this.$refs.Hint.showHint(t+"没有其他子节点了"),i.nodes.forEach(a=>{t=="乌海市取水许可知识图谱"?a.level=1:a.level=this.EchartsData.nodes.filter(o=>o.name==t)[0].level+1,a.name=="乌海市取水许可知识图谱"&&(a.level=0),this.EchartsData.nodes.some(o=>o.name===a.name)||this.EchartsData.nodes.push(a)}),i.links.forEach(a=>{this.EchartsData.links.some(o=>o.target===a.target)||this.EchartsData.links.push(a),i.nodes.forEach(function(o){a.target==o.nodeid&&(a.target=o.name),a.source==o.nodeid&&(a.source=o.name)})}),this.update()}).catch(i=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取数据失败")})},nodeDetails(t){this.$refs.Load.showLoad(!0,"获取数据...");let e={taskId:this.taskKeyId,name:t.name,type:t.type};I(e).then(s=>{this.$refs.Load.showLoad(!1),this.nodeDetailsData=s,this.nodeDetailsShow=!0}).catch(s=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取实体详情失败")})}}},T={class:"search-box w-20% h-200px position-absolute"},N={class:"title"},B={class:"type"},H={class:"handle"},A={key:1,class:"nodeDetails"},O={class:"typeText"},G={class:"list"},R={class:"flex items-baseline mb-15px"},V={class:"flex-1 f-3"},$={class:"text-gray-400 mr-20px f-blue"},Q={class:"flex-1 f-3"},W={class:"text-gray-400 mr-20px f-blue"},K={class:"flex-1 f-3"};function P(t,e,s,i,a,o){const n=g("el-autocomplete"),D=g("Load"),C=g("Hint");return d(),c("div",{class:"container-atlas flex",onClick:e[4]||(e[4]=l=>a.nowNodeInfo=null)},[r("div",T,[e[5]||(e[5]=r("div",{class:"title-box"}," 图谱探索 ",-1)),m(n,{class:"inline-input",icon:"el-icon-search",modelValue:a.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=l=>a.searchQuery=l),"fetch-suggestions":o.querySearch,placeholder:"请输入内容","trigger-on-focus":!1,onSelect:o.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])]),r("div",{id:"graphId",class:b(["atlasChart w-80%",{atlasChartSize:a.nodeDetailsShow}]),ref:"atlasChart"},null,2),m(D,{ref:"Load"},null,512),m(C,{ref:"Hint"},null,512),a.nowNodeInfo?(d(),c("div",{key:0,class:"nowNodeInfo",style:S({left:a.nowNodeInfo.x+"px",top:a.nowNodeInfo.y+"px"})},[r("div",N,h(a.nowNodeInfo.name),1),r("div",B,[e[6]||(e[6]=L("类型 : ")),r("span",null,h(a.nowNodeInfo.type),1)]),r("div",H,[r("li",{onClick:e[1]||(e[1]=l=>o.nodeDetails(a.nowNodeInfo))},"实体详情"),r("li",{onClick:e[2]||(e[2]=l=>o.nodesHandle(a.nowNodeInfo.name,a.nowNodeInfo))},h("显示子节点")),e[7]||(e[7]=r("li",null,"取消",-1))])],4)):u("",!0),a.nodeDetailsShow?(d(),c("div",A,[r("div",{class:"fold",onClick:e[3]||(e[3]=l=>a.nodeDetailsShow=!1)},e[8]||(e[8]=[r("span",{class:"iconfont"},"",-1)])),r("div",O,[e[10]||(e[10]=r("div",{class:"title"},[r("img",{src:z}),r("i",null,h("节点信息"))],-1)),r("div",G,[r("div",R,[e[9]||(e[9]=r("div",{class:"text-gray-400 mr-20px f-blue"},"名称:",-1)),r("div",V,h(a.nodeDetailsData.name),1)]),String(a.nodeDetailsData.groupRelations)!="{}"?(d(!0),c(y,{key:0},w(a.nodeDetailsData.groupRelations||{},(l,f)=>(d(),c("div",{class:"flex items-baseline",key:f+"relations"},[r("div",$,h(f),1),r("div",Q,h(l),1)]))),128)):u("",!0),a.nodeDetailsData.attlist.length>0?(d(!0),c(y,{key:1},w(a.nodeDetailsData.attlist,(l,f)=>(d(),c("div",{key:f,class:"flex items-baseline mb-15px"},[r("div",W,h(l.attname)+":",1),r("div",K,h(l.atttvalue),1)]))),128)):u("",!0)])])])):u("",!0)])}const Z=v(F,[["render",P],["__scopeId","data-v-cad1bd74"]]);export{Z as default};
