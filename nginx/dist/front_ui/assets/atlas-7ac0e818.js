import{i as C}from"./index-20c3ceee.js";import{r as m}from"./index-61440c59.js";import{_ as L,b as D,c,d as f,e as r,f as y,n as S,q as k,t as d,g as b,j as p,F as E,i as v}from"./index-304f9fbc.js";import"./tslib.es6-7c8db84e.js";const x=async s=>await m.getData({url:"kgapp/graphExpand",params:s}),I=async s=>await m.getData({url:"kgapp/graph",params:s}),_=async s=>await m.get({url:"kgapp/graphEntity/detailByNameType",params:s}),N=async s=>await m.getData({url:"kgapp/graphEntityScheme",params:s}),z=""+new URL("tit-4415a57d.png",import.meta.url).href;const F={data(){return{atlasChart:null,EchartsData:{nodes:[],links:[],categories:[]},showNode:[],windowsSizeTimer:null,nowNodeInfo:null,nodeDetailsShow:!1,nodeDetailsData:null,searchList:null,searchQuery:"",showList:!1,taskKeyId:277}},computed:{filteredItems(){if(!this.searchQuery)return this.searchList;const s=this.searchQuery.toLowerCase();return this.showList=!0,this.searchList.filter(t=>t.name.toLowerCase().includes(s))}},watch:{nodeDetailsShow(){this.$nextTick(()=>{setTimeout(()=>{this.atlasChart.resize()},100)})}},mounted(){this.nodesHandle("乌海市取水许可知识图谱"),this.EchartsInit(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{handleSelect(s){console.log(s,"itemitme"),this.changeGraph(s.name)},querySearch(s,t){var a=this.searchList,o=s?a.filter(this.createFilter(s)):a;t(o)},createFilter(s){return t=>t.value.toLowerCase().indexOf(s.toLowerCase())===0},getGraphEntityScheme(){const s={page:1,pageSize:1e3,taskId:this.taskKeyId};N(s).then(t=>{this.searchList=t.data,this.searchList.map(a=>{a.value=a.name})})},handleResize(){this.windowsSizeTimer&&clearTimeout(this.windowsSizeTimer),this.windowsSizeTimer=setTimeout(()=>{this.atlasChart.resize()},300)},changeGraph(s){const t=this.atlasChart.getOption();let a=t.series[0].nodes.map(i=>i.name),o=null;if(a.includes(s))o=t.series[0].nodes.map(i=>i.name===s?{...i,itemStyle:{}}:{...i,itemStyle:{opacity:.2}});else return;const e={...t,series:[{...t.series[0],nodes:o}]};this.atlasChart.setOption(e)},EchartsInit(){function s(a){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function t(a,o){if(console.log(a,"colorclorcloroo"),a.startsWith("#")){var e=s(a);return`rgba(${e.r}, ${e.g}, ${e.b}, ${o})`}else if(a.startsWith("rgb(")){var i=a.match(/\d+/g);return`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${o})`}else return a}this.atlasChart=C(this.$refs.atlasChart),this.atlasChart.setOption({series:[{type:"graph",roam:!0,scaleLimit:{min:.6},animation:!1,animationDuration:0,draggable:!0,layout:"force",force:{repulsion:1e3,edgeLength:200,friction:.2},itemStyle:{borderColor:"transparent",borderWidth:1},label:{fontSize:12,color:"#000",fontFamily:"PingFang SC",normal:{show:!0,formatter:function(a){return a.data.name.length>4?a.data.name.substr(0,4)+"...":a.data.name}},emphasis:{show:!0,formatter:"{b}",overflow:"break",lineHeight:15,itemStyle:{borderColor:function(a){var o=a.color;return console.log(o,"colrorcoelo"),t(o,.5)},borderWidth:10}}},edgeLabel:{show:!0,fontSize:12,fontWeight:900,lineHeight:15,fontFamily:"PingFang SC",color:"#adadadeb",formatter:a=>a.value},lineStyle:{opacity:1,width:2,color:"#adadadeb"},edgeSymbol:["none","arrow"],edgeSymbolSize:8,nodes:[],links:[]}]}),this.atlasChart.on("click",a=>{event.stopPropagation(),a.dataType=="node"&&(this.nowNodeInfo={type:a.data.category,name:a.data.name,id:a.data.nodeid,x:a.event.offsetX,y:a.event.offsetY})}),this.atlasChart.getZr().on("click",a=>{if(event.stopPropagation(),!a.target){this.nowNodeInfo=null,this.searchQuery="";const o=this.atlasChart.getOption(),e=o.series[0].nodes.map(n=>({...n,itemStyle:{opacity:1}})),i={...o,series:[{...o.series[0],nodes:e}]};this.atlasChart.setOption(i)}})},dataItemStyle(s,t,a){return{color:{type:"radial",x:.5,y:.5,r:.4,globalCoord:!1,colorStops:[{offset:0,color:s},{offset:1,color:t}]},borderColor:a,borderWidth:6,borderType:"solid"}},indexColorGET(s,t){let a=[["#EA8C82","#E46A5E","#D3C8DA"],["#E2B0AA","#EA9E8C","#D4D4E4"],["#EACD92","#F3C263","#D9DCDC"],["#AECCD7","#A4C6CB","#C2D7EF"],["#C48ABB","#C46FA5","#C9C7E9"],["#E3CFCD","#EDCABE","#CDD7EF"],["#B7D8F7","#B2D7F5","#D0E3FB"],["#A8DEE8","#9CDCE2","#BFDCF6"]],o=[{level:0,size:110},{level:1,size:70}],e=t>1?["#8CC5FF","#66B1FF","#B3D8FF"]:a[s],i=t>1?76:o.filter(n=>n.level==t)[0].size;return{color:e,size:i}},update(){this.EchartsData.nodes.forEach((t,a)=>{let o=this.indexColorGET(a,t.level);t.symbolSize=o.size,t.label={width:o.size-10}});let s=this.atlasChart.getOption();s.series[0].nodes=this.EchartsData.nodes,s.series[0].links=this.EchartsData.links,s.series[0].categories=this.EchartsData.categories,this.atlasChart.setOption(s)},sonNodesGET(s,t){let a=[];return s.forEach(o=>{o.source==t&&(a.push(o.target),a=a.concat(this.sonNodesGET(s,o.target)))}),a},nodesHandle(s,t,a=!0){if(a)this.nodesGET(s,t);else{this.nodeDetailsShow=!1;let o=this.showNode.findIndex(l=>l==s);this.showNode.splice(o,1),console.log(this.EchartsData.links,"this.EchartsData.linksthis.EchartsData.links");let e=this.sonNodesGET(this.EchartsData.links,s),i=this.EchartsData.nodes.filter(l=>!e.includes(l.name)),n=this.EchartsData.links.filter(l=>!e.includes(l.target)),g=this.EchartsData.nodes.filter(l=>l.name==s)[0].level;this.showNode.forEach((l,h)=>{this.EchartsData.nodes.filter(w=>w.name==l)[0].level>g&&(this.showNode=this.showNode.filter(w=>w!=l))}),this.EchartsData.nodes=i,this.searchList=i,this.searchList.map(l=>{l.value=l.name}),this.EchartsData.links=n,this.update()}},filterBidirectionalLinks(s){const t=new Map,a=[];return s.forEach(o=>{const e=`${o.source}-${o.target}`,i=`${o.target}-${o.source}`;!t.has(e)&&!t.has(i)&&(a.push(o),t.set(e,!0))}),a},nodesGET(s,t){if(console.log(t,"extend"),this.$refs.Load.showLoad(!0,"获取数据..."),t){let o={name:t.name,type:t.type,taskId:this.taskKeyId};x(o).then(e=>{this.EchartsData.categories=e.categories,this.searchList=e.nodes,this.searchList.map(i=>{i.value=i.name}),this.$refs.Load.showLoad(!1),e.nodes.length>0?this.showNode.push(s):this.$refs.Hint.showHint(s+"没有其他子节点了"),e.nodes.forEach(i=>{s=="乌海市取水许可知识图谱"?i.level=1:i.level=this.EchartsData.nodes.filter(n=>n.name==s)[0].level+1,i.name=="乌海市取水许可知识图谱"&&(i.level=0),this.EchartsData.nodes.some(n=>n.name===i.name)||this.EchartsData.nodes.push(i)}),e.links.forEach(i=>{this.EchartsData.links.some(n=>n.target===i.target)||this.EchartsData.links.push(i),e.nodes.forEach(function(n){i.target==n.nodeid&&(i.target=n.name),i.source==n.nodeid&&(i.source=n.name)})}),this.EchartsData.links=this.filterBidirectionalLinks(this.EchartsData.links),this.update()});return}const a={taskId:this.taskKeyId,total:1e3};I(a).then(o=>{this.searchList=o.nodes,this.searchList.map(e=>{e.value=e.name}),this.EchartsData.categories=o.categories,this.$refs.Load.showLoad(!1),o.nodes.length>0?this.showNode.push(s):this.$refs.Hint.showHint(s+"没有其他子节点了"),o.nodes.forEach(e=>{s=="乌海市取水许可知识图谱"?e.level=1:e.level=this.EchartsData.nodes.filter(i=>i.name==s)[0].level+1,e.name=="乌海市取水许可知识图谱"&&(e.level=0),this.EchartsData.nodes.some(i=>i.name===e.name)||this.EchartsData.nodes.push(e)}),o.links.forEach(e=>{this.EchartsData.links.some(i=>i.target===e.target)||this.EchartsData.links.push(e),o.nodes.forEach(function(i){e.target==i.nodeid&&(e.target=i.name),e.source==i.nodeid&&(e.source=i.name)})}),this.update()}).catch(o=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取数据失败")})},nodeDetails(s){this.$refs.Load.showLoad(!0,"获取数据...");let t={taskId:this.taskKeyId,name:s.name,type:s.type};_(t).then(a=>{this.$refs.Load.showLoad(!1),this.nodeDetailsData=a,this.nodeDetailsShow=!0}).catch(a=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取实体详情失败")})}}},T={class:"search-box w-20% h-200px position-absolute"},B={class:"title"},A={class:"type"},H={class:"handle"},O={key:1,class:"nodeDetails"},G={class:"typeText"},R={class:"list"},V={class:"flex items-baseline mb-15px"},$={class:"flex-1 f-3"},Q={class:"text-gray-400 mr-20px f-blue"},W={class:"flex-1 f-3"},K={class:"text-gray-400 mr-20px f-blue"},q={class:"flex-1 f-3"};function P(s,t,a,o,e,i){const n=D("el-autocomplete"),g=D("Load"),l=D("Hint");return c(),f("div",{class:"container-atlas flex",onClick:t[4]||(t[4]=h=>e.nowNodeInfo=null)},[r("div",T,[t[5]||(t[5]=r("div",{class:"title-box"}," 图谱探索 ",-1)),y(n,{class:"inline-input",icon:"el-icon-search",modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=h=>e.searchQuery=h),"fetch-suggestions":i.querySearch,placeholder:"请输入内容","trigger-on-focus":!1,onSelect:i.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])]),r("div",{id:"graphId",class:S(["atlasChart w-80%",{atlasChartSize:e.nodeDetailsShow}]),ref:"atlasChart"},null,2),y(g,{ref:"Load"},null,512),y(l,{ref:"Hint"},null,512),e.nowNodeInfo?(c(),f("div",{key:0,class:"nowNodeInfo",style:k({left:e.nowNodeInfo.x+"px",top:e.nowNodeInfo.y+"px"})},[r("div",B,d(e.nowNodeInfo.name),1),r("div",A,[t[6]||(t[6]=b("类型 : ")),r("span",null,d(e.nowNodeInfo.type),1)]),r("div",H,[r("li",{onClick:t[1]||(t[1]=h=>i.nodeDetails(e.nowNodeInfo))},"实体详情"),r("li",{onClick:t[2]||(t[2]=h=>i.nodesHandle(e.nowNodeInfo.name,e.nowNodeInfo,!e.showNode.includes(e.nowNodeInfo.name)))},d(e.showNode.includes(e.nowNodeInfo.name)?"隐藏子节点":"显示子节点"),1),t[7]||(t[7]=r("li",null,"取消",-1))])],4)):p("",!0),e.nodeDetailsShow?(c(),f("div",O,[r("div",{class:"fold",onClick:t[3]||(t[3]=h=>e.nodeDetailsShow=!1)},t[8]||(t[8]=[r("span",{class:"iconfont"},"",-1)])),r("div",G,[t[10]||(t[10]=r("div",{class:"title"},[r("img",{src:z}),r("i",null,d("节点信息"))],-1)),r("div",R,[r("div",V,[t[9]||(t[9]=r("div",{class:"text-gray-400 mr-20px f-blue"},"名称:",-1)),r("div",$,d(e.nodeDetailsData.name),1)]),String(e.nodeDetailsData.groupRelations)!="{}"?(c(!0),f(E,{key:0},v(e.nodeDetailsData.groupRelations||{},(h,u)=>(c(),f("div",{class:"flex items-baseline",key:u+"relations"},[r("div",Q,d(u),1),r("div",W,d(h),1)]))),128)):p("",!0),e.nodeDetailsData.attlist.length>0?(c(!0),f(E,{key:1},v(e.nodeDetailsData.attlist,(h,u)=>(c(),f("div",{key:u,class:"flex items-baseline mb-15px"},[r("div",K,d(h.attname)+":",1),r("div",q,d(h.atttvalue),1)]))),128)):p("",!0)])])])):p("",!0)])}const Y=L(F,[["render",P],["__scopeId","data-v-9ee71ec7"]]);export{Y as default};
