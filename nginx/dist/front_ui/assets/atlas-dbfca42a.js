import{i as E}from"./index-20c3ceee.js";import{r as p}from"./index-8a07fa20.js";import{_ as v,b as m,c as d,d as c,e as r,f as g,n as b,q as S,t as h,g as L,m as f,F as y,i as w}from"./index-5ec8344c.js";import"./tslib.es6-7c8db84e.js";const x=async s=>await p.getData({url:"kgapp/graphExpand",params:s}),_=async s=>await p.getData({url:"kgapp/graph",params:s}),I=async s=>await p.get({url:"kgapp/graphEntity/detailByNameType",params:s}),k=async s=>await p.getData({url:"kgapp/graphEntityScheme",params:s}),z=""+new URL("tit-4415a57d.png",import.meta.url).href;const F={data(){return{atlasChart:null,EchartsData:{nodes:[],links:[],categories:[]},showNode:[],windowsSizeTimer:null,nowNodeInfo:null,nodeDetailsShow:!1,nodeDetailsData:null,searchList:null,searchQuery:"",showList:!1,taskKeyId:277}},computed:{filteredItems(){if(!this.searchQuery)return this.searchList;const s=this.searchQuery.toLowerCase();return this.showList=!0,this.searchList.filter(e=>e.name.toLowerCase().includes(s))}},watch:{nodeDetailsShow(){this.$nextTick(()=>{setTimeout(()=>{this.atlasChart.resize()},100)})}},mounted(){this.nodesHandle("乌海市取水许可知识图谱"),this.getGraphEntityScheme(),this.EchartsInit(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{handleSelect(s){this.changeGraph(s.name)},querySearch(s,e){var t=this.searchList,i=s?t.filter(this.createFilter(s)):t;e(i)},createFilter(s){return e=>e.value.toLowerCase().indexOf(s.toLowerCase())===0},getGraphEntityScheme(){const s={page:1,pageSize:1e3,taskId:this.taskKeyId};k(s).then(e=>{this.searchList=e.data,this.searchList.map(t=>{t.value=t.name})})},handleResize(){this.windowsSizeTimer&&clearTimeout(this.windowsSizeTimer),this.windowsSizeTimer=setTimeout(()=>{this.atlasChart.resize()},300)},changeGraph(s){const e=this.atlasChart.getOption();let t=e.series[0].nodes.map(o=>o.name),i=null;if(t.includes(s))i=e.series[0].nodes.map(o=>o.name===s?{...o,itemStyle:{}}:{...o,itemStyle:{opacity:.2}});else return;const a={...e,series:[{...e.series[0],nodes:i}]};this.atlasChart.setOption(a)},EchartsInit(){function s(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}function e(t,i){if(console.log(t,"colorclorcloroo"),t.startsWith("#")){var a=s(t);return`rgba(${a.r}, ${a.g}, ${a.b}, ${i})`}else if(t.startsWith("rgb(")){var o=t.match(/\d+/g);return`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${i})`}else return t}this.atlasChart=E(this.$refs.atlasChart),this.atlasChart.setOption({series:[{type:"graph",roam:!0,scaleLimit:{min:.6},animation:!1,animationDuration:0,draggable:!0,layout:"force",force:{repulsion:1e3,edgeLength:200,friction:.2},itemStyle:{borderColor:"transparent",borderWidth:1},label:{fontSize:12,color:"#000",fontFamily:"PingFang SC",normal:{show:!0,formatter:function(t){return t.data.name.length>4?t.data.name.substr(0,4)+"...":t.data.name}},emphasis:{show:!0,formatter:"{b}",overflow:"break",lineHeight:15,itemStyle:{borderColor:function(t){var i=t.color;return console.log(i,"colrorcoelo"),e(i,.5)},borderWidth:10}}},edgeLabel:{show:!0,fontSize:12,fontWeight:900,lineHeight:15,fontFamily:"PingFang SC",color:"#adadadeb",formatter:t=>t.value},lineStyle:{opacity:1,width:2,color:"#adadadeb"},edgeSymbol:["none","arrow"],edgeSymbolSize:8,nodes:[],links:[]}]}),this.atlasChart.on("click",t=>{event.stopPropagation(),t.dataType=="node"&&(this.nowNodeInfo={type:t.data.category,name:t.data.name,id:t.data.nodeid,x:t.event.offsetX,y:t.event.offsetY})}),this.atlasChart.getZr().on("click",t=>{if(event.stopPropagation(),!t.target){this.nowNodeInfo=null,this.searchQuery="";const i=this.atlasChart.getOption(),a=i.series[0].nodes.map(n=>({...n,itemStyle:{opacity:1}})),o={...i,series:[{...i.series[0],nodes:a}]};this.atlasChart.setOption(o)}})},dataItemStyle(s,e,t){return{color:{type:"radial",x:.5,y:.5,r:.4,globalCoord:!1,colorStops:[{offset:0,color:s},{offset:1,color:e}]},borderColor:t,borderWidth:6,borderType:"solid"}},indexColorGET(s,e){let t=[["#EA8C82","#E46A5E","#D3C8DA"],["#E2B0AA","#EA9E8C","#D4D4E4"],["#EACD92","#F3C263","#D9DCDC"],["#AECCD7","#A4C6CB","#C2D7EF"],["#C48ABB","#C46FA5","#C9C7E9"],["#E3CFCD","#EDCABE","#CDD7EF"],["#B7D8F7","#B2D7F5","#D0E3FB"],["#A8DEE8","#9CDCE2","#BFDCF6"]],i=[{level:0,size:110},{level:1,size:70}],a=e>1?["#8CC5FF","#66B1FF","#B3D8FF"]:t[s],o=e>1?76:i.filter(n=>n.level==e)[0].size;return{color:a,size:o}},update(){this.EchartsData.nodes.forEach((e,t)=>{let i=this.indexColorGET(t,e.level);e.symbolSize=i.size,e.label={width:i.size-10}});let s=this.atlasChart.getOption();s.series[0].nodes=this.EchartsData.nodes,s.series[0].links=this.EchartsData.links,s.series[0].categories=this.EchartsData.categories,this.atlasChart.setOption(s)},sonNodesGET(s,e){let t=[];return s.forEach(i=>{i.source==e&&(t.push(i.target),t=t.concat(this.sonNodesGET(s,i.target)))}),t},nodesHandle(s,e,t=!0){this.nodesGET(s,e)},nodesGET(s,e){if(console.log(e,"extend"),this.$refs.Load.showLoad(!0,"获取数据..."),e){let i={name:e.name,type:e.type,taskId:this.taskKeyId};x(i).then(a=>{this.EchartsData.categories=a.categories,this.$refs.Load.showLoad(!1),a.nodes.length>0?this.showNode.push(s):this.$refs.Hint.showHint(s+"没有其他子节点了"),a.nodes.forEach(o=>{s=="乌海市取水许可知识图谱"?o.level=1:o.level=this.EchartsData.nodes.filter(n=>n.name==s)[0].level+1,o.name=="乌海市取水许可知识图谱"&&(o.level=0),this.EchartsData.nodes.some(n=>n.name===o.name)||this.EchartsData.nodes.push(o)}),a.links.forEach(o=>{this.EchartsData.links.some(n=>n.target===o.target)||this.EchartsData.links.push(o),a.nodes.forEach(function(n){o.target==n.nodeid&&(o.target=n.name),o.source==n.nodeid&&(o.source=n.name)})}),this.update()});return}const t={taskId:this.taskKeyId,total:1e3};_(t).then(i=>{this.EchartsData.categories=i.categories,this.$refs.Load.showLoad(!1),i.nodes.length>0?this.showNode.push(s):this.$refs.Hint.showHint(s+"没有其他子节点了"),i.nodes.forEach(a=>{s=="乌海市取水许可知识图谱"?a.level=1:a.level=this.EchartsData.nodes.filter(o=>o.name==s)[0].level+1,a.name=="乌海市取水许可知识图谱"&&(a.level=0),this.EchartsData.nodes.some(o=>o.name===a.name)||this.EchartsData.nodes.push(a)}),i.links.forEach(a=>{this.EchartsData.links.some(o=>o.target===a.target)||this.EchartsData.links.push(a),i.nodes.forEach(function(o){a.target==o.nodeid&&(a.target=o.name),a.source==o.nodeid&&(a.source=o.name)})}),this.update()}).catch(i=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取数据失败")})},nodeDetails(s){this.$refs.Load.showLoad(!0,"获取数据...");let e={taskId:this.taskKeyId,name:s.name,type:s.type};I(e).then(t=>{this.$refs.Load.showLoad(!1),this.nodeDetailsData=t,this.nodeDetailsShow=!0}).catch(t=>{this.$refs.Load.showLoad(!1),this.$refs.Hint.showHint("获取实体详情失败")})}}},T={class:"search-box w-20% h-200px position-absolute"},N={class:"title"},B={class:"type"},H={class:"handle"},A={key:1,class:"nodeDetails"},O={class:"typeText"},G={class:"list"},R={class:"flex items-baseline mb-15px"},V={class:"flex-1 f-3"},$={class:"text-gray-400 mr-20px f-blue"},K={class:"flex-1 f-3"},Q={class:"text-gray-400 mr-20px f-blue"},W={class:"flex-1 f-3"};function q(s,e,t,i,a,o){const n=m("el-autocomplete"),D=m("Load"),C=m("Hint");return d(),c("div",{class:"container-atlas flex",onClick:e[4]||(e[4]=l=>a.nowNodeInfo=null)},[r("div",T,[e[5]||(e[5]=r("div",{class:"title-box"}," 图谱探索 ",-1)),g(n,{class:"inline-input",icon:"el-icon-search",modelValue:a.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=l=>a.searchQuery=l),"fetch-suggestions":o.querySearch,placeholder:"请输入内容","trigger-on-focus":!1,onSelect:o.handleSelect},null,8,["modelValue","fetch-suggestions","onSelect"])]),r("div",{id:"graphId",class:b(["atlasChart w-80%",{atlasChartSize:a.nodeDetailsShow}]),ref:"atlasChart"},null,2),g(D,{ref:"Load"},null,512),g(C,{ref:"Hint"},null,512),a.nowNodeInfo?(d(),c("div",{key:0,class:"nowNodeInfo",style:S({left:a.nowNodeInfo.x+"px",top:a.nowNodeInfo.y+"px"})},[r("div",N,h(a.nowNodeInfo.name),1),r("div",B,[e[6]||(e[6]=L("类型 : ")),r("span",null,h(a.nowNodeInfo.type),1)]),r("div",H,[r("li",{onClick:e[1]||(e[1]=l=>o.nodeDetails(a.nowNodeInfo))},"实体详情"),r("li",{onClick:e[2]||(e[2]=l=>o.nodesHandle(a.nowNodeInfo.name,a.nowNodeInfo,!0))},h("显示子节点")),e[7]||(e[7]=r("li",null,"取消",-1))])],4)):f("",!0),a.nodeDetailsShow?(d(),c("div",A,[r("div",{class:"fold",onClick:e[3]||(e[3]=l=>a.nodeDetailsShow=!1)},e[8]||(e[8]=[r("span",{class:"iconfont"},"",-1)])),r("div",O,[e[10]||(e[10]=r("div",{class:"title"},[r("img",{src:z}),r("i",null,h("节点信息"))],-1)),r("div",G,[r("div",R,[e[9]||(e[9]=r("div",{class:"text-gray-400 mr-20px f-blue"},"名称:",-1)),r("div",V,h(a.nodeDetailsData.name),1)]),String(a.nodeDetailsData.groupRelations)!="{}"?(d(!0),c(y,{key:0},w(a.nodeDetailsData.groupRelations||{},(l,u)=>(d(),c("div",{class:"flex items-baseline",key:u+"relations"},[r("div",$,h(u),1),r("div",K,h(l),1)]))),128)):f("",!0),a.nodeDetailsData.attlist.length>0?(d(!0),c(y,{key:1},w(a.nodeDetailsData.attlist,(l,u)=>(d(),c("div",{key:u,class:"flex items-baseline mb-15px"},[r("div",Q,h(l.attname)+":",1),r("div",W,h(l.atttvalue),1)]))),128)):f("",!0)])])])):f("",!0)])}const Z=v(F,[["render",q],["__scopeId","data-v-d33d13bc"]]);export{Z as default};
