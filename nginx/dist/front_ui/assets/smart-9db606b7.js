import{s as L,_ as R}from"./photo3-680b74aa.js";import"./index-37139fa3.js";import{_ as V,b as N,c as d,d as h,f as b,e,g as p,F as f,h as v,i as g,v as c,j as I,k as S,n as A,l as H,t as u,m as w}from"./index-e43f0123.js";const D="data:image/png;base64,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",G=""+new URL("photo2-1e6f5b5e.png",import.meta.url).href,B=""+new URL("smartPhoto-c2eb5907.jpg",import.meta.url).href;const F={data(){return{sessionLogList:[],logListIndex:localStorage.getItem("logListIndex")||0,pitchDelete:null,pitchEdit:null,editValue:"",suggestList:[],continueList:[],sendValue:"",loadReply:!1,messageLoading:!1,continueIssue:!1,remoteSearch:!1,remoteList:[],linkPath:""}},watch:{async logListIndex(o){this.suggestList=await L(6),this.continueList=await L(3),this.messageScrollTo("auto"),localStorage.setItem("logListIndex",o)}},mounted(){this.firstGetList(),this.sessionLogRead(),this.$refs.sendTextarea.focus(),this.messageScrollTo("auto")},methods:{async firstGetList(){this.suggestList=await L(6),this.continueList=await L(3)},logListClick(o){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.logListIndex=o},editLogName(o,s){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.pitchEdit=o,this.editValue=s.title,this.$nextTick(()=>this.$refs.editInput.focus())},messageScrollTo(o){this.$nextTick(()=>{this.$refs.messageList.scrollTo({top:this.$refs.messageList.scrollHeight,behavior:o})})},nowTime(){function o(a){return(a<10?"0":"")+a}var s=new Date,l=s.getFullYear(),C=o(s.getMonth()+1),i=o(s.getDate()),n=o(s.getHours()),m=o(s.getMinutes()),t=o(s.getSeconds());return l+"-"+C+"-"+i+" "+n+":"+m+":"+t},saveSessionLog(){localStorage.setItem("sessionLog",JSON.stringify(this.sessionLogList))},sessionLogRead(){let o=JSON.parse(localStorage.getItem("sessionLog"));!o||o.length==0?(this.logListIndex=0,this.sessionLogList=[{id:0,title:"知识库智能问答",time:this.nowTime(),start:!1,list:[]}]):this.sessionLogList=o},sessionLogAdd(){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}let o=()=>{let s=this.sessionLogList[0].id;for(let l=1;l<this.sessionLogList.length;l++)this.sessionLogList[l].id>s&&(s=this.sessionLogList[l].id);return s+1};this.sessionLogList.unshift({id:o(),title:"新对话",time:this.nowTime(),start:!1,list:[]}),this.logListIndex=0,this.saveSessionLog()},sessionLogAmend(){this.editValue&&(this.sessionLogList[this.pitchEdit].title=this.editValue,this.pitchEdit=null,this.saveSessionLog())},sessionLogDelete(o,s){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕"),this.pitchDelete=null;return}this.sessionLogList.splice(s,1),this.saveSessionLog(),this.pitchDelete=null,s==this.logListIndex&&(this.logListIndex=0),s<this.logListIndex&&(this.logListIndex-=1),this.messageScrollTo("auto")},messageAdd(o,s){this.sessionLogList[this.logListIndex].start=!0,this.sessionLogList[this.logListIndex].list.push({oneself:o,message:s}),this.saveSessionLog()},searchHandle(o){this.sendValue=o,this.remoteSearch=!1,this.remoteList=[]},watchInput(){if(console.log(this.sendValue==""),this.remoteList=[],this.$refs.sendTextarea.style.height="auto",this.$refs.sendTextarea.style.height=this.$refs.sendTextarea.scrollHeight+"px",this.sendValue==""){this.remoteSearch=!1;return}let o={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:this.sendValue})};fetch("kgapp/prodqalist/autoQA",o).then(s=>s.json()).then(s=>{s.data.length>0?(s.data.map(l=>{this.remoteList.push(l.question)}),this.remoteSearch=!0):this.remoteSearch=!1})},async suggestListGet(){this.suggestList=await L(6)},baiduChat(o){let s={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:o})};return new Promise((l,C)=>{fetch("kgapp/prodqalist/autoQA",s).then(i=>i.json()).then(i=>{let n=i.data[0].answer;this.linkPath=i.data[0].doc;const m=JSON.stringify(n),a=new TextEncoder().encode(m),r=new ReadableStream({start(x){x.enqueue(a),x.close()}});let y="",_=r.getReader(),T=new TextDecoder;function k(){return _.read().then(({done:x,value:M})=>{if(x){l(y);return}return y+=T.decode(M,{stream:!0}),k()})}return k()}).catch(i=>{l("回答出错了..."),console.error("error : "+i)})})},chatReply(o){let s=this.sessionLogList[this.logListIndex].list;s.push({oneself:!1,message:""}),this.messageLoading=!0,this.loadReply=!0,this.baiduChat(o).then(l=>{this.messageLoading=!1,(async()=>{for(let i=0;i<l.length;i++)s[s.length-1].message+=l[i],s[s.length-1].linkPath=this.linkPath,await new Promise(n=>setTimeout(n,20))})().then(()=>{this.loadReply=!1,this.saveSessionLog(),this.messageScrollTo("smooth")})})},async sendMessage(o){if(o.preventDefault(),!this.sendValue){this.$refs.Hint.showHint("你不能发送空的内容");return}if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.messageAdd(!0,this.sendValue),this.chatReply(this.sendValue),this.sendValue="",this.continueList=await L(3),this.messageScrollTo("smooth")},setInputValue(o){this.remoteSearch=!1,this.remoteList=[],this.sendValue=o,this.$refs.sendTextarea.focus()},rebuildMessage(o,s){let l=this.sessionLogList[this.logListIndex].list;l.splice(l.length-1,1),this.chatReply(l[l.length-1].message)},copyMessage(o,s){let l=document.createElement("textarea");l.value=o.message,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),this.$refs.Hint.showHint("已复制回答")},praiseMessage(o,s){this.$refs.Hint.showHint("已点赞回答")},treadMessage(o,s){this.$refs.Hint.showHint("已点踩回答")},shareMessage(o,s){this.$refs.Hint.showHint("已分享, 不知道分享给谁了")}}},E={class:"container-smart"},P={class:"sessionLog"},O={class:"list"},J=["onClick"],q={class:"flex items-center"},j={class:"title"},Q={class:"time"},Y={class:"handle"},Z=["onClick"],K=["onClick"],U={class:"deleteDiaLog"},z={class:"buttonList"},W=["onClick"],X={class:"pageMaskLayer"},$={class:"dialog"},ss={class:"buttonList"},es={class:"messageList"},ts={class:"item"},is={class:"message_call"},os={class:"hint"},ns={class:"list"},ls=["onClick"],as={class:"profile"},rs={src:G},ds={src:B},hs={class:"message_text"},gs={class:"text"},cs={class:"messageLoading"},us=["onClick"],Ls={class:"handle"},ms={class:"rebuild"},ps={class:"else"},fs=["onClick"],vs=["onClick"],As=["onClick"],Cs=["onClick"],xs={class:"continueIssue"},ws={class:"list"},ys=["onClick"],ks={class:"send position-relative"},Is={key:0,class:"w-30% position-absolute search-remote overflow-auto"},Ss=["onClick"];function Hs(o,s,l,C,i,n){const m=N("Hint");return d(),h("div",E,[b(m,{ref:"Hint"},null,512),e("div",P,[e("div",{class:"newDialog",onClick:s[0]||(s[0]=(...t)=>n.sessionLogAdd&&n.sessionLogAdd(...t))},s[11]||(s[11]=[e("span",{class:"iconfont"},"",-1),p(" 新建对话 ")])),e("div",O,[(d(!0),h(f,null,v(i.sessionLogList,(t,a)=>(d(),h("li",{key:a,onClick:r=>n.logListClick(a),class:A({pitch:a==i.logListIndex})},[e("div",q,[s[12]||(s[12]=e("img",{class:"w-27px h-24px mr-10px",src:D,alt:""},null,-1)),e("div",null,[e("div",j,u(t.title),1),e("div",Q,u(t.time),1)])]),g(e("div",Y,[e("span",{class:"iconfont edit",onClick:w(r=>n.editLogName(a,t),["stop"])},"",8,Z),e("span",{class:"iconfont delete",onClick:w(r=>i.pitchDelete=a,["stop"])},"",8,K)],512),[[c,t.id!=0]]),g(e("div",U,[s[13]||(s[13]=e("div",{class:"info"}," 删除后无法恢复，请确认 ",-1)),e("div",z,[e("div",{class:"left",onClick:s[1]||(s[1]=w(r=>i.pitchDelete=null,["stop"]))},"取消"),e("div",{class:"right",onClick:w(r=>n.sessionLogDelete(t,a),["stop"])},"确认",8,W)])],512),[[c,t.id!=0&&i.pitchDelete==a]])],10,J))),128))])]),g(e("div",X,[e("div",$,[s[14]||(s[14]=e("div",{class:"tit"},"编辑对话名称",-1)),g(e("input",{type:"text",placeholder:"新的对话名称",ref:"editInput","onUpdate:modelValue":s[2]||(s[2]=t=>i.editValue=t),onKeydown:s[3]||(s[3]=I((...t)=>n.sessionLogAmend&&n.sessionLogAmend(...t),["enter"]))},null,544),[[S,i.editValue]]),e("div",ss,[e("div",{class:"left",onClick:s[4]||(s[4]=t=>i.pitchEdit=null)},"取消"),e("div",{class:A(["right",{isValue:i.editValue}]),onClick:s[5]||(s[5]=(...t)=>n.sessionLogAmend&&n.sessionLogAmend(...t))},"确认",2)])])],512),[[c,i.pitchEdit!=null]]),e("div",es,[i.sessionLogList[i.logListIndex]?(d(),h("div",{key:0,class:A(["list",{"list-qs":i.sessionLogList[i.logListIndex].start==!0}]),ref:"messageList"},[g(e("li",ts,[e("div",is,[s[17]||(s[17]=e("div",{class:"flex ml-45px"},[e("div",{class:"profile mr-5px"},[e("img",{class:"img-user",src:R})]),e("div",{class:"tit"}," 您好，我是乌海水利智能问答助手 ")],-1)),e("div",os,[s[16]||(s[16]=e("div",{class:"ml-75px"}," 您可以试着问我 : ",-1)),e("div",{class:"refresh",onClick:s[6]||(s[6]=(...t)=>n.suggestListGet&&n.suggestListGet(...t))},s[15]||(s[15]=[e("span",{class:"iconfont"},"",-1),p(" 换一换 ")]))]),e("div",ns,[(d(!0),h(f,null,v(i.suggestList,(t,a)=>(d(),h("li",{key:a,onClick:r=>n.setInputValue(t)},u(t),9,ls))),128))])])],512),[[c,i.sessionLogList[i.logListIndex].start!=!0]]),(d(!0),h(f,null,v(i.sessionLogList[i.logListIndex].list,(t,a)=>(d(),h("li",{key:a,class:A(["item",{oneself:t.oneself}])},[e("div",as,[g(e("img",rs,null,512),[[c,!t.oneself]]),g(e("img",ds,null,512),[[c,t.oneself]])]),e("div",hs,[e("span",gs,[p(u(t.message)+" ",1),g(e("div",cs,s[18]||(s[18]=[e("li",{class:"li1"},null,-1),e("li",{class:"li2"},null,-1),e("li",{class:"li3"},null,-1)]),512),[[c,i.messageLoading&&a==i.sessionLogList[i.logListIndex].list.length-1]])]),e("span",{class:"iconfont edit",onClick:r=>n.setInputValue(t.message)},"",8,us),s[24]||(s[24]=e("div",{class:"handleTop",style:{height:"26px"}},null,-1)),e("div",Ls,[e("div",null,[s[19]||(s[19]=p(" 来源：")),e("span",ms,u(t.linkPath),1)]),e("div",ps,[e("li",{class:"copy",onClick:r=>n.copyMessage(t,a)},s[20]||(s[20]=[e("span",{class:"iconfont"},"",-1)]),8,fs),e("li",{class:"praise",onClick:r=>n.praiseMessage(t,a)},s[21]||(s[21]=[e("span",{class:"iconfont"},"",-1)]),8,vs),e("li",{class:"tread",onClick:r=>n.treadMessage(t,a)},s[22]||(s[22]=[e("span",{class:"iconfont"},"",-1)]),8,As),e("li",{class:"share",onClick:r=>n.shareMessage(t,a)},s[23]||(s[23]=[e("span",{class:"iconfont"},"",-1)]),8,Cs)])])])],2))),128)),g(e("div",xs,[s[25]||(s[25]=e("div",{class:"hint"}," 您可以继续问我 ",-1)),e("div",ws,[(d(!0),h(f,null,v(i.continueList,(t,a)=>(d(),h("li",{key:a,onClick:r=>n.setInputValue(t)},u(t),9,ys))),128))])],512),[[c,!i.loadReply&&i.sessionLogList[i.logListIndex].start]])],2)):H("",!0),e("div",ks,[g(e("textarea",{placeholder:"输入您的问题...",rows:"1",ref:"sendTextarea",onInput:s[7]||(s[7]=(...t)=>n.watchInput&&n.watchInput(...t)),"onUpdate:modelValue":s[8]||(s[8]=t=>i.sendValue=t),onKeydown:s[9]||(s[9]=I((...t)=>n.sendMessage&&n.sendMessage(...t),["enter"]))},null,544),[[S,i.sendValue]]),e("div",{class:A(["sendButton",{closeButton:i.loadReply||!i.sendValue}]),onClick:s[10]||(s[10]=(...t)=>n.sendMessage&&n.sendMessage(...t))},s[26]||(s[26]=[e("span",{class:"iconfont"},"",-1),p(" 发送 ")]),2),i.remoteSearch?(d(),h("ul",Is,[(d(!0),h(f,null,v(i.remoteList,(t,a)=>(d(),h("li",{key:a,onClick:r=>n.searchHandle(t)},u(t),9,Ss))),128))])):H("",!0)])])])}const Rs=V(F,[["render",Hs],["__scopeId","data-v-e77e15f5"]]);export{Rs as default};
