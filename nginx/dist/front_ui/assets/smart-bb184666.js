import{s as p,_ as R}from"./photo3-f69b6dd9.js";import"./index-3f65e8d4.js";import{g as V}from"./base64-ae67ffac.js";import{_ as b,b as N,c as d,d as h,f as D,e,g as f,F as v,i as k,j as g,v as u,k as I,l as S,n as C,m as H,t as c,p as y}from"./index-259776b5.js";const P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAYCAYAAAALQIb7AAAAAXNSR0IArs4c6QAABd1JREFUSEutlW1sllcZx///c+7nfto+payUl610doXgCCisa4Hsi8o22AszOl0dQ4dgoQGj0RkM2xfjB5fFZdHIiDpoCxGNS5qwGfXLYImZWcJb10HUBKFrG17GQGBr+/A893Of+/z17kMH7CHLlnh/uZNzruv6nXOu6/pfxE2+1vUnZgQ2/BGAzQCyN7P5pGsCEgp9CfU8P+p0x7qhqukBOwk+DcnJcAgeMYgK248FCiJhBMwmMAvC6xUBFq89PjvMVL0K4jZvsDryVSdMNCbkaj/pZcp2+XEAtcjaQqMCdkOcXwFbumG4ReDrEJyhvfdgd9PpT0e50frza0bqq6rVDfLhClhr59lmy3g/BTkkKwZ65oyU3cW2rncbrC9NUeKcz9Rc7N/ReOX60Au+e752Smk85wYuXervb4/Tvbaus9Pp424CKytgS9afuR023i/RJMjcP9DTOIIO2bba0+20fguBuwWNU2YPY7Pr0O+aLqZBFz15NJcNp24G+QUp+dmRnpbDAHW12HoA3F+GdcguCy/losyoCaxtAvVKuuycX/H27jtGlmwcXgyZHYCaIbwr4haAGQrb86PVL/6rb+b4xCFN/GeR8wA8X4qyLxzbc2v+Blhb1+BUJJnlRlouqpZgDtBDIN6JEHw58uMf1NnqZyBuFPSsSm4vM+GtpH8JUI035uH+xtuH2s+ceoTSTgANEAYM7aNpvm+ALe0c2SqgS0AVKAcwIDBTwoFEfLxEFmugF0F90Xm7aqC36Wg56XhJ1FIZPWiLmQs+TH5L4F6AxwQ/xxM/fGt2859aR042BDYsP+OSzpH/iMpDZqu8/7cCNFtxG4RRH7uHwkJ4Ia5zm0g+LZi9SvxOGvNZQM8SGosTfdWS04zlqwCOwuNXMvgNgCE6v9aHWWd83FuGbRiJJLxZZPLEP7rnvNe2dvAzJszsE2TKOWsZbu18p9nSPEfwPgAlAIGEKQRGKLvGm+RRAl3w+rFT9rXAll4GcCe9OpIgOmGS6h5QK1JYAdCBAvzqFJYGDhi8BokOmRUT1Qhx8abTjZnYfzMtYZHDFC4L3kCZHaD7CoiFiTI/GavJn6svhB0CHjBevy7DqnpATMJwCM4/fnh3y7m0zwK4fSDk5FZe6zPgnqdOVY+NxXW8Yks1LCVRZrqx4WA+KTXkbJgN+htvu4Sf0qeS1xBmay+WovH0T++6Ca28erNrsA8VBIoNgvv+PwqCnSBWVcCWbTjdlMD9lWK9k/uaCXAiyHsB0ypUq2Di5NieWVfS5p3cbOs6kilcrs5OCUOT+rjMaKOx7AXZehXGQ3DJxDMu6Dhfm5tafAry3wd5EtIAwFiE+ZAmETAg/Pvwdn/I/Ftv9s4fS0FwM5aB+hJTEhkYYK6AewAMVBRIWgxL1g3PQsAtEL4OGgPJpzm8Cpv8p+oTCkwA/3t69uSrxs/notwmEFtQnklFn04a8Q2n5AW2dw5H/yvpvztfemJg17wLk6e/a93QLYFNmmiCOpeYUmBVcA6i1QTMyFhSd0n6HmnmSn4Q1HMAP0dwM8BfSjrgEp8n3Zk0dnqz9wG+l8Bv9s6eCowxxhaVRCj2F/rPoO8byaInz+Uy1T5VfCtPRkbKmGiscNmN1uWmNca2uJ403yYQlAcEvPe+o39Xy8HrE832jcO/oMxjgNKp6gim00WpNgax/04ceo/EdBpydSq+E86kk3yfLcQ/P/iHeaPpYYLslbuN7A9ILEfaNeC3jnQ377sBNiGUzK4C9QiIeoApdCGlROR2QqneLRL0AYCLBL3gI4F74yjbkyr75LxbtuH8zASFx9JcG5hthwYH/4K/LXeTwIkRs6Djn2F1fX1d5Is2a4JaejxDaA2AIsAxSH/01u8GmAJhStKoifLHe+8cv77s0720oWcY0wjF8eHxuWfRlxZQ+asYngs7T02rZrKd4IMC3vDQtrwvHj7eO3+sotE+diFtj2v9d1NYOsZNUtqa5iV2pvft3U0nP+r06aDXrP8LekYHjkv8d1cAAAAASUVORK5CYII=",B=""+new URL("photo2-1e6f5b5e.png",import.meta.url).href,F=""+new URL("smartPhoto-c2eb5907.jpg",import.meta.url).href;const G={data(){return{sessionLogList:[],logListIndex:localStorage.getItem("logListIndex")||0,pitchDelete:null,pitchEdit:null,editValue:"",suggestList:[],continueList:[],sendValue:"",loadReply:!1,messageLoading:!1,continueIssue:!1,remoteSearch:!1,remoteList:[],linkPath:"",pushLinkPath:"",pushLinkId:""}},watch:{async logListIndex(i){this.suggestList=await p(6),this.continueList=await p(3),this.messageScrollTo("auto"),localStorage.setItem("logListIndex",i)}},mounted(){this.firstGetList(),this.sessionLogRead(),this.$refs.sendTextarea.focus(),this.messageScrollTo("auto")},methods:{pushLink(i,s){let l=`http://192.168.2.182:8000${i}`;if(i){localStorage.getItem("artile")&&localStorage.removeItem("artile"),localStorage.getItem("smartKey")&&localStorage.removeItem("smartKey");let L={id:s,url:"http://192.168.2.182:8012/onlinePreview?url="+encodeURIComponent(V.encode(l))};localStorage.setItem("artile",JSON.stringify(L)),localStorage.setItem("smartKey",!0),this.$router.push("/pdfView")}},async firstGetList(){this.suggestList=await p(6),this.continueList=await p(3)},logListClick(i){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.logListIndex=i},editLogName(i,s){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.pitchEdit=i,this.editValue=s.title,this.$nextTick(()=>this.$refs.editInput.focus())},messageScrollTo(i){this.$nextTick(()=>{this.$refs.messageList.scrollTo({top:this.$refs.messageList.scrollHeight,behavior:i})})},nowTime(){function i(a){return(a<10?"0":"")+a}var s=new Date,l=s.getFullYear(),L=i(s.getMonth()+1),n=i(s.getDate()),o=i(s.getHours()),m=i(s.getMinutes()),t=i(s.getSeconds());return l+"-"+L+"-"+n+" "+o+":"+m+":"+t},saveSessionLog(){localStorage.setItem("sessionLog",JSON.stringify(this.sessionLogList))},sessionLogRead(){let i=JSON.parse(localStorage.getItem("sessionLog"));!i||i.length==0?(this.logListIndex=0,this.sessionLogList=[{id:0,title:"知识库智能问答",time:this.nowTime(),start:!1,list:[]}]):this.sessionLogList=i},sessionLogAdd(){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}let i=()=>{let s=this.sessionLogList[0].id;for(let l=1;l<this.sessionLogList.length;l++)this.sessionLogList[l].id>s&&(s=this.sessionLogList[l].id);return s+1};this.sessionLogList.unshift({id:i(),title:"新对话",time:this.nowTime(),start:!1,list:[]}),this.logListIndex=0,this.saveSessionLog()},sessionLogAmend(){this.editValue&&(this.sessionLogList[this.pitchEdit].title=this.editValue,this.pitchEdit=null,this.saveSessionLog())},sessionLogDelete(i,s){if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕"),this.pitchDelete=null;return}this.sessionLogList.splice(s,1),this.saveSessionLog(),this.pitchDelete=null,s==this.logListIndex&&(this.logListIndex=0),s<this.logListIndex&&(this.logListIndex-=1),this.messageScrollTo("auto")},messageAdd(i,s){this.sessionLogList[this.logListIndex].start=!0,this.sessionLogList[this.logListIndex].list.push({oneself:i,message:s}),this.saveSessionLog()},searchHandle(i){this.sendValue=i,this.remoteSearch=!1,this.remoteList=[]},watchInput(){if(console.log(this.sendValue==""),this.remoteList=[],this.$refs.sendTextarea.style.height="auto",this.$refs.sendTextarea.style.height=this.$refs.sendTextarea.scrollHeight+"px",this.sendValue==""){this.remoteSearch=!1;return}let i={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:this.sendValue})};fetch("kgapp/prodqalist/autoQA",i).then(s=>s.json()).then(s=>{s.data.length>0?(s.data.map(l=>{this.remoteList.push(l.question)}),this.remoteSearch=!0):this.remoteSearch=!1})},async suggestListGet(){this.suggestList=await p(6)},baiduChat(i){let s={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:i})};return new Promise((l,L)=>{fetch("kgapp/prodqalist/autoQA",s).then(n=>n.json()).then(n=>{let o=n.data[0].answer;this.linkPath=n.data[0].doc,this.pushLinkPath=n.data[0].docpath,this.pushLinkId=n.data[0].id;const m=JSON.stringify(o),a=new TextEncoder().encode(m),r=new ReadableStream({start(A){A.enqueue(a),A.close()}});let w="",_=r.getReader(),T=new TextDecoder;function x(){return _.read().then(({done:A,value:M})=>{if(A){l(w);return}return w+=T.decode(M,{stream:!0}),x()})}return x()}).catch(n=>{l("回答出错了..."),console.error("error : "+n)})})},removeFirstAndLastChar(i){return i.length<=2?"":i.substring(1,i.length-1)},chatReply(i){let s=this.sessionLogList[this.logListIndex].list;s.push({oneself:!1,message:""}),this.messageLoading=!0,this.loadReply=!0,this.baiduChat(i).then(l=>{this.messageLoading=!1,(async()=>{for(let n=0;n<l.length;n++)s[s.length-1].message+=l[n],s[s.length-1].linkPath=this.linkPath,s[s.length-1].pushLinkPath=this.pushLinkPath,s[s.length-1].pushLinkId=this.pushLinkId,await new Promise(o=>setTimeout(o,20))})().then(()=>{this.loadReply=!1,this.saveSessionLog(),this.messageScrollTo("smooth")})})},async sendMessage(i){if(i.preventDefault(),!this.sendValue){this.$refs.Hint.showHint("你不能发送空的内容");return}if(this.loadReply){this.$refs.Hint.showHint("请等待消息接收完毕");return}this.messageAdd(!0,this.sendValue),this.chatReply(this.sendValue),this.sendValue="",this.continueList=await p(3),this.messageScrollTo("smooth")},setInputValue(i){this.remoteSearch=!1,this.remoteList=[],this.sendValue=i,this.$refs.sendTextarea.focus()},rebuildMessage(i,s){let l=this.sessionLogList[this.logListIndex].list;l.splice(l.length-1,1),this.chatReply(l[l.length-1].message)},copyMessage(i,s){let l=document.createElement("textarea");l.value=i.message,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),this.$refs.Hint.showHint("已复制回答")},praiseMessage(i,s){this.$refs.Hint.showHint("已点赞回答")},treadMessage(i,s){this.$refs.Hint.showHint("已点踩回答")},shareMessage(i,s){this.$refs.Hint.showHint("已分享, 不知道分享给谁了")}}},E={class:"container-smart"},O={class:"sessionLog"},J={class:"list"},j=["onClick"],q={class:"flex items-center"},Q={class:"title"},K={class:"time"},Y={class:"handle"},Z=["onClick"],U=["onClick"],z={class:"deleteDiaLog"},W={class:"buttonList"},X=["onClick"],$={class:"pageMaskLayer"},ss={class:"dialog"},es={class:"buttonList"},ts={class:"messageList"},is={class:"item"},ns={class:"message_call"},os={class:"hint"},ls={class:"list"},as=["onClick"],rs={class:"profile"},ds={src:B},hs={src:F},gs={class:"message_text"},us={class:"text"},cs={class:"messageLoading"},Ls=["onClick"],ps={class:"handle"},ms=["onClick"],fs={class:"else"},vs=["onClick"],ks=["onClick"],Cs=["onClick"],As=["onClick"],ys={class:"continueIssue"},ws={class:"list"},xs=["onClick"],Is={class:"send position-relative"},Ss={key:0,class:"w-30% position-absolute search-remote overflow-auto"},Hs=["onClick"];function _s(i,s,l,L,n,o){const m=N("Hint");return d(),h("div",E,[D(m,{ref:"Hint"},null,512),e("div",O,[e("div",{class:"newDialog",onClick:s[0]||(s[0]=(...t)=>o.sessionLogAdd&&o.sessionLogAdd(...t))},s[11]||(s[11]=[e("span",{class:"iconfont"},"",-1),f(" 新建对话 ")])),e("div",J,[(d(!0),h(v,null,k(n.sessionLogList,(t,a)=>(d(),h("li",{key:a,onClick:r=>o.logListClick(a),class:C({pitch:a==n.logListIndex})},[e("div",q,[s[12]||(s[12]=e("img",{class:"w-27px h-24px mr-10px",src:P,alt:""},null,-1)),e("div",null,[e("div",Q,c(t.title),1),e("div",K,c(t.time),1)])]),g(e("div",Y,[e("span",{class:"iconfont edit",onClick:y(r=>o.editLogName(a,t),["stop"])},"",8,Z),e("span",{class:"iconfont delete",onClick:y(r=>n.pitchDelete=a,["stop"])},"",8,U)],512),[[u,t.id!=0]]),g(e("div",z,[s[13]||(s[13]=e("div",{class:"info"}," 删除后无法恢复，请确认 ",-1)),e("div",W,[e("div",{class:"left",onClick:s[1]||(s[1]=y(r=>n.pitchDelete=null,["stop"]))},"取消"),e("div",{class:"right",onClick:y(r=>o.sessionLogDelete(t,a),["stop"])},"确认",8,X)])],512),[[u,t.id!=0&&n.pitchDelete==a]])],10,j))),128))])]),g(e("div",$,[e("div",ss,[s[14]||(s[14]=e("div",{class:"tit"},"编辑对话名称",-1)),g(e("input",{type:"text",placeholder:"新的对话名称",ref:"editInput","onUpdate:modelValue":s[2]||(s[2]=t=>n.editValue=t),onKeydown:s[3]||(s[3]=I((...t)=>o.sessionLogAmend&&o.sessionLogAmend(...t),["enter"]))},null,544),[[S,n.editValue]]),e("div",es,[e("div",{class:"left",onClick:s[4]||(s[4]=t=>n.pitchEdit=null)},"取消"),e("div",{class:C(["right",{isValue:n.editValue}]),onClick:s[5]||(s[5]=(...t)=>o.sessionLogAmend&&o.sessionLogAmend(...t))},"确认",2)])])],512),[[u,n.pitchEdit!=null]]),e("div",ts,[n.sessionLogList[n.logListIndex]?(d(),h("div",{key:0,class:C(["list",{"list-qs":n.sessionLogList[n.logListIndex].start==!0}]),ref:"messageList"},[g(e("li",is,[e("div",ns,[s[17]||(s[17]=e("div",{class:"flex ml-45px"},[e("div",{class:"profile mr-5px"},[e("img",{class:"img-user",src:R})]),e("div",{class:"tit"}," 您好，我是乌海水利智能问答助手 ")],-1)),e("div",os,[s[16]||(s[16]=e("div",{class:"ml-75px"}," 您可以试着问我 : ",-1)),e("div",{class:"refresh",onClick:s[6]||(s[6]=(...t)=>o.suggestListGet&&o.suggestListGet(...t))},s[15]||(s[15]=[e("span",{class:"iconfont"},"",-1),f(" 换一换 ")]))]),e("div",ls,[(d(!0),h(v,null,k(n.suggestList,(t,a)=>(d(),h("li",{key:a,onClick:r=>o.setInputValue(t)},c(t),9,as))),128))])])],512),[[u,n.sessionLogList[n.logListIndex].start!=!0]]),(d(!0),h(v,null,k(n.sessionLogList[n.logListIndex].list,(t,a)=>(d(),h("li",{key:a,class:C(["item",{oneself:t.oneself}])},[e("div",rs,[g(e("img",ds,null,512),[[u,!t.oneself]]),g(e("img",hs,null,512),[[u,t.oneself]])]),e("div",gs,[e("span",us,[f(c(o.removeFirstAndLastChar(t.message))+" ",1),g(e("div",cs,s[18]||(s[18]=[e("li",{class:"li1"},null,-1),e("li",{class:"li2"},null,-1),e("li",{class:"li3"},null,-1)]),512),[[u,n.messageLoading&&a==n.sessionLogList[n.logListIndex].list.length-1]])]),e("span",{class:"iconfont edit",onClick:r=>o.setInputValue(t.message)},"",8,Ls),s[24]||(s[24]=e("div",{class:"handleTop",style:{height:"26px"}},null,-1)),e("div",ps,[e("div",null,[s[19]||(s[19]=f(" 来源：")),e("span",{class:"rebuild",onClick:r=>o.pushLink(t.pushLinkPath,t.pushLinkId)},c(t.linkPath),9,ms)]),e("div",fs,[e("li",{class:"copy",onClick:r=>o.copyMessage(t,a)},s[20]||(s[20]=[e("span",{class:"iconfont"},"",-1)]),8,vs),e("li",{class:"praise",onClick:r=>o.praiseMessage(t,a)},s[21]||(s[21]=[e("span",{class:"iconfont"},"",-1)]),8,ks),e("li",{class:"tread",onClick:r=>o.treadMessage(t,a)},s[22]||(s[22]=[e("span",{class:"iconfont"},"",-1)]),8,Cs),e("li",{class:"share",onClick:r=>o.shareMessage(t,a)},s[23]||(s[23]=[e("span",{class:"iconfont"},"",-1)]),8,As)])])])],2))),128)),g(e("div",ys,[s[25]||(s[25]=e("div",{class:"hint"}," 您可以继续问我 ",-1)),e("div",ws,[(d(!0),h(v,null,k(n.continueList,(t,a)=>(d(),h("li",{key:a,onClick:r=>o.setInputValue(t)},c(t),9,xs))),128))])],512),[[u,!n.loadReply&&n.sessionLogList[n.logListIndex].start]])],2)):H("",!0),e("div",Is,[g(e("textarea",{placeholder:"输入您的问题...",rows:"1",ref:"sendTextarea",onInput:s[7]||(s[7]=(...t)=>o.watchInput&&o.watchInput(...t)),"onUpdate:modelValue":s[8]||(s[8]=t=>n.sendValue=t),onKeydown:s[9]||(s[9]=I((...t)=>o.sendMessage&&o.sendMessage(...t),["enter"]))},null,544),[[S,n.sendValue]]),e("div",{class:C(["sendButton",{closeButton:n.loadReply||!n.sendValue}]),onClick:s[10]||(s[10]=(...t)=>o.sendMessage&&o.sendMessage(...t))},s[26]||(s[26]=[e("span",{class:"iconfont"},"",-1),f(" 发送 ")]),2),n.remoteSearch?(d(),h("ul",Ss,[(d(!0),h(v,null,k(n.remoteList,(t,a)=>(d(),h("li",{key:a,onClick:r=>o.searchHandle(t)},c(t),9,Hs))),128))])):H("",!0)])])])}const bs=b(G,[["render",_s],["__scopeId","data-v-ad000576"]]);export{bs as default};
